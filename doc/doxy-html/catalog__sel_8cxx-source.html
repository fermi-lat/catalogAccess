<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>catalogAccess: catalog_sel.cxx Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>catalog_sel.cxx</h1><a href="catalog__sel_8cxx.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00013 <span class="preprocessor">#include "<a class="code" href="catalog_8h.html">catalog.h</a>"</span>
00014 
00015 <span class="keyword">namespace </span>catalogAccess {
00016 
00017 <span class="comment">/**********************************************************************/</span>
00018 <span class="comment">/*  METHOD for SELECTING QUANTITY (BEFORE IMPORT)                     */</span>
00019 <span class="comment">/**********************************************************************/</span>
00020 <span class="comment">// importSelected() will actually load selected quantities</span>
<a name="l00021"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a49">00021</a> <span class="keywordtype">int</span> Catalog::selectQuantity(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">bool</span> toBeLoaded) {
00022 
00023   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(<span class="stringliteral">"selectQuantity"</span>, <span class="keyword">true</span>);
00024   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00025   <span class="keywordtype">int</span> num=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(<span class="stringliteral">"selectQuantity"</span>, name);
00026   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
00027 
00028   <span class="keywordtype">int</span> maxSize=<a class="code" href="classcatalog_access_1_1_catalog.html#r11">m_loadQuantity</a>.size();
00029   <span class="keywordflow">if</span> (quantSize != maxSize) {
00030     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"selectQuantity"</span>,
00031              <span class="stringliteral">"cannot get all initial quantities once importSelected() done"</span>);
00032     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a33">BAD_SEL_QUANT</a>;
00033   }
00034   <a class="code" href="classcatalog_access_1_1_catalog.html#r11">m_loadQuantity</a>.at(num)=toBeLoaded;
00035   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00036 }
00037 <span class="comment">/**********************************************************************/</span>
<a name="l00038"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a50">00038</a> <span class="keywordtype">int</span> Catalog::selectAllQuantities(<span class="keyword">const</span> <span class="keywordtype">bool</span> toBeLoaded) {
00039 
00040   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(<span class="stringliteral">"selectAllQuantities"</span>, <span class="keyword">true</span>);
00041   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00042 
00043   <span class="comment">// beware m_loadQuantity has always the initial size</span>
00044   <span class="comment">// whereas m_quantities size can decrease</span>
00045   <span class="keywordtype">int</span> maxSize=<a class="code" href="classcatalog_access_1_1_catalog.html#r11">m_loadQuantity</a>.size();
00046   <span class="keywordflow">if</span> (quantSize != maxSize) {
00047     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"selectAllQuantities"</span>,
00048              <span class="stringliteral">"cannot get all initial quantities once importSelected() done"</span>);
00049     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a33">BAD_SEL_QUANT</a>;
00050   }
00051   <span class="keywordflow">if</span> (toBeLoaded) <span class="comment">// vectors with same size</span>
00052        <a class="code" href="classcatalog_access_1_1_catalog.html#r11">m_loadQuantity</a>.assign(maxSize, <span class="keyword">true</span>);
00053   <span class="keywordflow">else</span> <a class="code" href="classcatalog_access_1_1_catalog.html#r11">m_loadQuantity</a>.assign(maxSize, <span class="keyword">false</span>);
00054   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00055 }
00056 
00057 
00058 <span class="comment">/**********************************************************************/</span>
00059 <span class="comment">/*  METHODS for SELECTING DATA (BEFORE or AFTER IMPORT)               */</span>
00060 <span class="comment">/**********************************************************************/</span>
00061 <span class="comment">// check if given row is inside the elliptical region (private method)</span>
<a name="l00062"></a><a class="code" href="classcatalog_access_1_1_catalog.html#d3">00062</a> <span class="keywordtype">bool</span> Catalog::checkRegion(<span class="keyword">const</span> <span class="keywordtype">long</span> row, <span class="keyword">const</span> <span class="keywordtype">int</span> nRA, <span class="keyword">const</span> <span class="keywordtype">int</span> nDEC) {
00063 
00064   <span class="comment">/* for the moment, only circle</span>
00065 <span class="comment">    if angle phi=RA and t=PI/2 - DEC then:</span>
00066 <span class="comment">    OM postion is x= (sin t &lt;=&gt; cos DEC) * cos phi</span>
00067 <span class="comment">                  y= (sin t &lt;=&gt; cos DEC) * sin phi</span>
00068 <span class="comment">                  z= (cos t &lt;=&gt; sin DEC)</span>
00069 <span class="comment">   and the circular region around OA is defined by</span>
00070 <span class="comment">   its scalar product with OM &gt; cos desired_angle</span>
00071 <span class="comment">  */</span>
00072   <span class="keywordtype">double</span> myRA=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[nRA].at(row);
00073   <span class="keywordtype">double</span> myDEC=m_numericals[nDEC].at(row);
00074 <span class="preprocessor">#ifdef WIN32</span>
00075 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (_isnan(myRA))  <span class="keywordflow">return</span> !(<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[<a class="code" href="classcatalog_access_1_1_catalog.html#r27">m_indexRA</a>].m_rejectNaN);
00076    <span class="keywordflow">if</span> (_isnan(myDEC)) <span class="keywordflow">return</span> !(<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[<a class="code" href="classcatalog_access_1_1_catalog.html#r28">m_indexDEC</a>].m_rejectNaN);
00077 <span class="preprocessor">#else</span>
00078 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (std::isnan(myRA))  <span class="keywordflow">return</span> !(<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[<a class="code" href="classcatalog_access_1_1_catalog.html#r27">m_indexRA</a>].m_rejectNaN);
00079   <span class="keywordflow">if</span> (std::isnan(myDEC)) <span class="keywordflow">return</span> !(<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[<a class="code" href="classcatalog_access_1_1_catalog.html#r28">m_indexDEC</a>].m_rejectNaN);
00080 <span class="preprocessor">#endif</span>
00081 <span class="preprocessor"></span>  <span class="keywordtype">double</span> obj_cosP=cos(myRA * Angle_Conv);
00082   <span class="keywordtype">double</span> obj_sinP=sin(myRA * Angle_Conv);
00083   <span class="keywordtype">double</span> obj_sinT=cos(myDEC * Angle_Conv);
00084   <span class="keywordtype">double</span> obj_cosT=sin(myDEC * Angle_Conv);
00085   <span class="keywordtype">double</span> myAngle=obj_sinT*obj_cosP*<a class="code" href="classcatalog_access_1_1_catalog.html#r29">m_selEllipse</a>.at(2)*<a class="code" href="classcatalog_access_1_1_catalog.html#r29">m_selEllipse</a>.at(0)
00086                 +obj_sinT*obj_sinP*<a class="code" href="classcatalog_access_1_1_catalog.html#r29">m_selEllipse</a>.at(2)*<a class="code" href="classcatalog_access_1_1_catalog.html#r29">m_selEllipse</a>.at(1)
00087                 +obj_cosT*<a class="code" href="classcatalog_access_1_1_catalog.html#r29">m_selEllipse</a>.at(3);
00088 <span class="comment">/*std::cout &lt;&lt; "cos(angle)*1E6 = " &lt;&lt; myAngle*1E6 &lt;&lt; " ? "</span>
00089 <span class="comment">            &lt;&lt;  m_selEllipse.at(4)*1E6 &lt;&lt; std::endl;*/</span>
00090   <span class="keywordflow">if</span> (myAngle &gt;= <a class="code" href="classcatalog_access_1_1_catalog.html#r29">m_selEllipse</a>.at(4)) <span class="keywordflow">return</span> <span class="keyword">true</span>;
00091   <span class="keywordflow">return</span> <span class="keyword">false</span>;
00092 }
00093 
00094 <span class="comment">/**********************************************************************/</span>
00095 <span class="comment">// check if value pass criteria for given quantity index (cut AND list)</span>
00096 <span class="comment">// private method called by useOnlyN, excludeN</span>
<a name="l00097"></a><a class="code" href="classcatalog_access_1_1_catalog.html#d4">00097</a> <span class="keywordtype">bool</span> Catalog::checkNUM(<span class="keyword">const</span> <span class="keywordtype">double</span> r, <span class="keyword">const</span> <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">bool</span> miss,
00098                        <span class="keyword">const</span> <span class="keywordtype">bool</span> reject, <span class="keyword">const</span> <span class="keywordtype">double</span> precis) {
00099 
00100   <span class="comment">// since we test the NaN only once at the beginning</span>
00101   <span class="comment">// this methods MUST NOT be called if no criteria is applied</span>
00102 <span class="preprocessor">#ifdef WIN32</span>
00103 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (_isnan(r)) <span class="keywordflow">return</span> !reject;
00104 <span class="preprocessor">#else</span>
00105 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (std::isnan(r)) <span class="keywordflow">return</span> !reject;
00106 <span class="preprocessor">#endif</span>
00107 <span class="preprocessor"></span>  <span class="keywordtype">double</span> myLimit;
00108   myLimit=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_lowerCut;
00109   <span class="keywordflow">if</span> (myLimit &lt; <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) {
00110     <span class="keywordflow">if</span> (r &lt; myLimit) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00111   }
00112   myLimit=m_quantities[index].m_upperCut;
00113   <span class="keywordflow">if</span> (myLimit &lt; <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) {
00114     <span class="keywordflow">if</span> (r &gt; myLimit) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00115   }
00116 
00117   <span class="keywordtype">int</span> vecSize=m_quantities[index].m_listValN.size();
00118   <span class="keywordflow">if</span> (vecSize &gt; 0) {
00119     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;vecSize; i++) {
00120       myLimit=m_quantities[index].m_listValN[i];
00121       <span class="keywordflow">if</span> (fabs(myLimit) &gt; NearZero) {
00122         <span class="keywordflow">if</span> (fabs(r/myLimit-1.0) &lt;= precis) <span class="keywordflow">return</span> !miss;
00123       }
00124       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fabs(r) &lt;= precis) <span class="keywordflow">return</span> !miss;
00125       <span class="comment">// returns TRUE for inclusion (equality found)</span>
00126       <span class="comment">// returns FALSE for exclusion (difference found)</span>
00127     }
00128     <span class="keywordflow">return</span> miss;
00129     <span class="comment">// not in list: returns FALSE for inclusion, TRUE for exclusion</span>
00130   }
00131 
00132   <span class="comment">// empty list (interval exist): within interval</span>
00133   <span class="keywordflow">return</span> <span class="keyword">true</span>;
00134 }
00135 
00136 <span class="comment">/**********************************************************************/</span>
00137 <span class="comment">// check if value pass criteria for given quantity index (cut OR list)</span>
00138 <span class="comment">// private method called by includeN</span>
<a name="l00139"></a><a class="code" href="classcatalog_access_1_1_catalog.html#d5">00139</a> <span class="keywordtype">bool</span> Catalog::checkNUMor(<span class="keyword">const</span> <span class="keywordtype">double</span> r, <span class="keyword">const</span> <span class="keywordtype">int</span> index,
00140                          <span class="keyword">const</span> <span class="keywordtype">bool</span> reject, <span class="keyword">const</span> <span class="keywordtype">double</span> precis) {
00141 
00142   <span class="comment">// since we test the NaN only once at the beginning</span>
00143   <span class="comment">// this methods MUST NOT be called if no criteria is applied</span>
00144 <span class="preprocessor">#ifdef WIN32</span>
00145 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (_isnan(r)) <span class="keywordflow">return</span> !reject;
00146 <span class="preprocessor">#else</span>
00147 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (std::isnan(r)) <span class="keywordflow">return</span> !reject;
00148 <span class="preprocessor">#endif</span>
00149 <span class="preprocessor"></span>
00150   <span class="keywordtype">bool</span> check=<span class="keyword">true</span>;
00151   <span class="keywordtype">double</span> myLimit;
00152   <span class="keywordtype">int</span> vecSize=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_listValN.size();
00153   <span class="keywordflow">if</span> (vecSize &gt; 0) {
00154     <span class="keywordtype">int</span> i;
00155     check=<span class="keyword">false</span>;
00156     <span class="keywordflow">for</span> (i=0; i&lt;vecSize; i++) {
00157       myLimit=m_quantities[index].m_listValN[i];
00158       <span class="keywordflow">if</span> (fabs(myLimit) &gt; NearZero) {
00159         <span class="keywordflow">if</span> (fabs(r/myLimit-1.0) &lt;= precis) <span class="keywordflow">return</span> <span class="keyword">true</span>;
00160       }
00161       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fabs(r) &lt;= precis) <span class="keywordflow">return</span> <span class="keyword">true</span>;
00162       <span class="comment">// returns TRUE for inclusion (equality found)</span>
00163       <span class="comment">// needn't check for upper/lower cut (OR condition)</span>
00164     }
00165   }
00166 
00167   myLimit=m_quantities[index].m_lowerCut;
00168   <span class="keywordflow">if</span> (myLimit &lt; <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) {
00169     check=<span class="keyword">true</span>; <span class="comment">// used with list</span>
00170     <span class="keywordflow">if</span> (r &lt; myLimit) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00171   }
00172 
00173   myLimit=m_quantities[index].m_upperCut;
00174   <span class="keywordflow">if</span> (myLimit &lt; <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) {
00175     check=<span class="keyword">true</span>; <span class="comment">// used with list</span>
00176     <span class="keywordflow">if</span> (r &gt; myLimit) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00177   }
00178 
00179   <span class="comment">// empty list  + within interval = TRUE</span>
00180   <span class="comment">// not in list + within interval = TRUE</span>
00181   <span class="comment">// not in list +   no  interval = FALSE</span>
00182   <span class="keywordflow">return</span> check;
00183 
00184 }
00185 
00186 <span class="comment">/**********************************************************************/</span>
00187 <span class="comment">// compute the global bit selection at existing row,</span>
00188 <span class="comment">// suppose that m_rowIsSelected is correctly set (private method)</span>
<a name="l00189"></a><a class="code" href="classcatalog_access_1_1_catalog.html#d6">00189</a> <span class="keywordtype">bool</span> Catalog::rowSelect(<span class="keyword">const</span> <span class="keywordtype">long</span> row, <span class="keyword">const</span> std::vector&lt;bool&gt; &amp;quantSel) {
00190 
00191   <span class="keywordtype">int</span>  numBit=<span class="keyword">sizeof</span>(<span class="keywordtype">long</span>)*8,
00192        vecSize=quantSel.size();
00193   <span class="keywordtype">bool</span> check=<span class="keyword">true</span>;
00194   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r18">m_criteriaORed</a>) check=<span class="keyword">false</span>;
00195   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> currSel, test=2ul; <span class="comment">// bit0 reserved for check</span>
00196 <span class="preprocessor">  #ifdef DEBUG_CAT</span>
00197 <span class="preprocessor"></span>  std::cout &lt;&lt; <a class="code" href="classcatalog_access_1_1_catalog.html#r18">m_criteriaORed</a> &lt;&lt; <span class="stringliteral">"quantSize = "</span> &lt;&lt; vecSize;
00198 <span class="preprocessor">  #endif</span>
00199 <span class="preprocessor"></span>  <span class="keywordtype">int</span> j=0;
00200   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;=vecSize; ) {
00201 
00202     currSel=<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[j].at(row);
00203     <span class="keywordflow">if</span> (quantSel[i-1]) {
00204 <span class="preprocessor">      #ifdef DEBUG_CAT</span>
00205 <span class="preprocessor"></span>      std::cout &lt;&lt; <span class="stringliteral">" (AND with "</span> &lt;&lt; currSel &lt;&lt;<span class="stringliteral">" &amp; "</span>&lt;&lt; test
00206                 &lt;&lt; <span class="stringliteral">", pos["</span> &lt;&lt; j &lt;&lt;<span class="stringliteral">"] )"</span> &lt;&lt; std::endl;
00207 <span class="preprocessor">      #endif</span>
00208 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r18">m_criteriaORed</a>) {
00209         <span class="comment">// OR  of bits, true --&gt; useless to continue</span>
00210         <span class="keywordflow">if</span> ((currSel &amp; test) == test) {check=<span class="keyword">true</span>; <span class="keywordflow">break</span>;}
00211       }
00212       <span class="keywordflow">else</span> {
00213         <span class="comment">// AND of bits, false--&gt; useless to continue</span>
00214         <span class="keywordflow">if</span> ((currSel &amp; test) == 0ul) {check=<span class="keyword">false</span>; <span class="keywordflow">break</span>;}
00215       }
00216     }
00217     <span class="keywordflow">if</span> ((++i % numBit) == 0) {
00218       test=1ul; <span class="comment">// first bit</span>
00219       j++;      <span class="comment">// of next vector index.</span>
00220     }
00221     <span class="keywordflow">else</span> test*=2ul;
00222 
00223   }
00224   <span class="keywordflow">if</span> (check) <span class="comment">// setting bit0 to 1</span>
00225     <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(row)|= 1ul;
00226   <span class="keywordflow">else</span>       <span class="comment">// setting bit0 to 0</span>
00227     <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(row)&amp;= (Max_Test-1ul);
00228 
00229   <span class="keywordflow">return</span> check;
00230 }
00231 
00232 
00233 <span class="comment">/**********************************************************************/</span>
00234 <span class="comment">// unset cut on quantity found by its existing index (private method)</span>
<a name="l00235"></a><a class="code" href="classcatalog_access_1_1_catalog.html#d7">00235</a> <span class="keywordtype">void</span> Catalog::unsetCuts(<span class="keyword">const</span> <span class="keywordtype">int</span> index) {
00236 
00237   <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_listValS.clear();
00238   <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_lowerCut=<a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>;
00239   <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_upperCut=<a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>;
00240   <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_listValN.clear();
00241   <span class="comment">/* if no data: exit */</span>
00242   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> == 0) <span class="keywordflow">return</span>;
00243 
00244   <span class="comment">// now, must check criteria on region and other quantities</span>
00245   <span class="keywordtype">int</span> k;
00246   std::vector&lt;bool&gt; isSelected;
00247   <span class="keywordtype">bool</span> oneCriteria=<a class="code" href="classcatalog_access_1_1_catalog.html#d2">existCriteria</a>(&amp;isSelected);
00248   <span class="keywordflow">if</span> (oneCriteria) {
00249 
00250     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> test=<a class="code" href="classcatalog_access_1_1_catalog.html#d29">bitPosition</a>(index, &amp;k);
00251     <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00252     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
00253       <span class="comment">// setting required bit to 0</span>
00254       <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00255       <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#d6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>++;
00256     }<span class="comment">// loop on rows</span>
00257 
00258   }
00259   <span class="keywordflow">else</span> {
00260     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a> &gt; 0) {
00261       <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>.size(); <span class="comment">// to avoid compiler Warning</span>
00262       <span class="keywordflow">for</span> (k=0; k&lt;quantSize; k++)
00263         <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>, 0);
00264     }
00265     <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00266     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, <span class="stringliteral">"All rows unselected"</span>);
00267   }
00268 
00269 }
00270 <span class="comment">/**********************************************************************/</span>
00271 <span class="comment">// unset all selection criteria relating to quantity "name"</span>
<a name="l00272"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a51">00272</a> <span class="keywordtype">int</span> Catalog::unsetCuts(<span class="keyword">const</span> std::string name) {
00273 
00274   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(<span class="stringliteral">"unsetCuts"</span>, <span class="keyword">true</span>);
00275   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00276   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(<span class="stringliteral">"unsetCuts"</span>, name);
00277   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
00278 
00279   <a class="code" href="classcatalog_access_1_1_catalog.html#a52">unsetCuts</a>(index);
00280   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00281 }
00282 
00283 <span class="comment">/**********************************************************************/</span>
00284 <span class="comment">// unset all cuts on all quantities except the selection ellipse;</span>
00285 <span class="comment">// this also deletes the selection string</span>
<a name="l00286"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a52">00286</a> <span class="keywordtype">int</span> Catalog::unsetCuts() {
00287 
00288   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(<span class="stringliteral">"unsetCuts"</span>, <span class="keyword">true</span>);
00289   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00290   <span class="keywordtype">int</span> j;
00291   <span class="comment">/*for (j=0; j&lt;quantSize; j++) unsetCuts(m_quantities.at(j).m_name);*/</span>
00292   <span class="comment">//quicker to just check for selection ellipse</span>
00293   <span class="keywordflow">for</span> (j=0; j&lt;quantSize; j++) {
00294     <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(j).m_listValS.clear();
00295     <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(j).m_lowerCut=<a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>;
00296     <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(j).m_upperCut=<a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>;
00297     <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(j).m_listValN.clear();
00298   }
00299   <a class="code" href="classcatalog_access_1_1_catalog.html#r17">m_selection</a>=<span class="stringliteral">""</span>;
00300   <span class="comment">/* if no data: exit */</span>
00301   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00302 
00303   <span class="comment">// now, must check criteria on region</span>
00304   quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>.size();
00305   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r19">m_selRegion</a>) {
00306 
00307     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> currSel;
00308     <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00309     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
00310       currSel=<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(i);
00311       <span class="keywordflow">if</span> (currSel &amp; 2ul) {
00312         m_rowIsSelected[0].at(i)=3ul;
00313         <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>++;
00314       }
00315       <span class="keywordflow">else</span> m_rowIsSelected[0].at(i)=0ul;
00316       <span class="comment">// setting all bits to 0 except first two</span>
00317       <span class="keywordflow">for</span> (j=1; j&lt;quantSize; j++) m_rowIsSelected[j].at(i)=0ul;
00318     }<span class="comment">// loop on rows</span>
00319 
00320   }
00321   <span class="keywordflow">else</span> {
00322     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a> &gt; 0)
00323       <span class="keywordflow">for</span> (j=0; j&lt;quantSize; j++) <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[j].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>, 0);
00324     <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00325     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, <span class="stringliteral">"All rows unselected"</span>);
00326   }
00327   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00328 }
00329 
00330 <span class="comment">/**********************************************************************/</span>
00331 <span class="comment">// if true, criteria between quantities are ORed instead of ANDed</span>
<a name="l00332"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a53">00332</a> <span class="keywordtype">int</span> Catalog::setCriteriaORed(<span class="keyword">const</span> <span class="keywordtype">bool</span> bitOR) {
00333 
00334   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"setCriteriaORed"</span>;
00335   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(origin, <span class="keyword">true</span>);
00336   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00337 
00338   <span class="comment">// if boolean is the same: do nothing</span>
00339   <span class="keywordflow">if</span> (bitOR == <a class="code" href="classcatalog_access_1_1_catalog.html#r18">m_criteriaORed</a>) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00340   <a class="code" href="classcatalog_access_1_1_catalog.html#r18">m_criteriaORed</a>=bitOR;
00341 
00342   <span class="comment">/* if no data: exit */</span>
00343   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00344   <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00345   std::vector&lt;bool&gt; isSelected;
00346   <span class="keywordflow">if</span> ( <a class="code" href="classcatalog_access_1_1_catalog.html#d2">existCriteria</a>(&amp;isSelected) ) {
00347     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
00348       <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#d6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>++;
00349     }
00350   }
00351   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00352 }
00353       
00354 
00355 <span class="comment">/**********************************************************************/</span>
00356 <span class="comment">// set and apply an elliptical selection region</span>
<a name="l00357"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a54">00357</a> <span class="keywordtype">int</span> Catalog::setSelEllipse(<span class="keyword">const</span> <span class="keywordtype">double</span> centRA_deg, <span class="keyword">const</span> <span class="keywordtype">double</span> centDEC_deg,
00358                            <span class="keyword">const</span> <span class="keywordtype">double</span> majAxis_deg, <span class="keyword">const</span> <span class="keywordtype">double</span> minAxis_deg,
00359                            <span class="keyword">const</span> <span class="keywordtype">double</span> rot_deg) {
00360 
00361   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"setSelEllipse"</span>;
00362   std::string text;
00363   std::ostringstream sortie;
00364 
00365   <span class="comment">// first check that selection is possible</span>
00366   <span class="keywordtype">int</span> numPb=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(origin, <span class="keyword">true</span>);
00367   <span class="keywordflow">if</span> (numPb &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> numPb;
00368   <span class="keywordflow">if</span> ((<a class="code" href="classcatalog_access_1_1_catalog.html#r27">m_indexRA</a> &lt; 0) || (<a class="code" href="classcatalog_access_1_1_catalog.html#r28">m_indexDEC</a> &lt; 0)) {
00369     text=<span class="stringliteral">"missing generic position quantities (RA and DEC)"</span>; 
00370     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, text);
00371     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a23">NO_RA_DEC</a>;
00372   }
00373   numPb=0;
00374   <span class="comment">//const std::_Ios_Fmtflags outDouble=std::ios::right | std::ios::scientific;</span>
00375   <span class="keywordflow">if</span> ((centRA_deg &lt; 0.) || (centRA_deg &gt;= 360.)) numPb=<a class="code" href="namespacecatalog_access.html#a37a28">BAD_RA</a>;
00376   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((centDEC_deg &lt; -90.) || (centDEC_deg &gt; 90.)) numPb=<a class="code" href="namespacecatalog_access.html#a37a29">BAD_DEC</a>;
00377   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((rot_deg &lt; 0.) || (rot_deg &gt;= 180.)) numPb=<a class="code" href="namespacecatalog_access.html#a37a30">BAD_ROT</a>;
00378   <span class="keywordflow">if</span> (numPb &lt; 0) {
00379     text=<span class="stringliteral">"bad ellipse position (impossible RA, DEC or rotation)"</span>; 
00380     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, text);
00381     <span class="keywordflow">return</span> numPb;
00382   }
00383   <span class="keywordflow">if</span> ((majAxis_deg &lt; Min_Axis) || (majAxis_deg &gt; 90.)) numPb=<a class="code" href="namespacecatalog_access.html#a37a31">BAD_AXIS</a>;
00384   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((minAxis_deg &lt; Min_Axis) || (minAxis_deg &gt; 90.)) numPb=<a class="code" href="namespacecatalog_access.html#a37a31">BAD_AXIS</a>;
00385   <span class="comment">// size limited to one hemisphere</span>
00386   <span class="keywordflow">if</span> (numPb &lt; 0) {
00387     sortie &lt;&lt; <span class="stringliteral">"bad ellipse size, radius from "</span> &lt;&lt; std::setprecision(2)
00388            &lt;&lt; Min_Axis*1000 &lt;&lt; <span class="stringliteral">"E-3 to 90 (in RA or DEC)"</span>;
00389     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, sortie.str());
00390     <span class="keywordflow">return</span> numPb;
00391   }
00392   <span class="keywordflow">if</span> (rot_deg &gt; 0.)
00393     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"whatever orientation, using 0"</span>); 
00394   <span class="keywordflow">if</span> (fabs(majAxis_deg/minAxis_deg - 1.) &gt; 10*Min_Prec)
00395     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"axis sizes differ, taking only major axis"</span>);
00396   <a class="code" href="classcatalog_access_1_1_catalog.html#r19">m_selRegion</a>=<span class="keyword">true</span>;
00397   <a class="code" href="classcatalog_access_1_1_catalog.html#r20">m_selEllipseCentRA_deg</a>=centRA_deg;
00398   <a class="code" href="classcatalog_access_1_1_catalog.html#r21">m_selEllipseCentDEC_deg</a>=centDEC_deg;
00399   <a class="code" href="classcatalog_access_1_1_catalog.html#r23">m_selEllipseMajAxis_deg</a>=majAxis_deg;
00400   <a class="code" href="classcatalog_access_1_1_catalog.html#r22">m_selEllipseMinAxis_deg</a>=majAxis_deg; <span class="comment">//minAxis_deg;</span>
00401   <a class="code" href="classcatalog_access_1_1_catalog.html#r24">m_selEllipseRot_deg</a>=0.; <span class="comment">//rot_deg;</span>
00402   <span class="comment">// angles are phi=RA and theta=PI/2-DEC</span>
00403   <a class="code" href="classcatalog_access_1_1_catalog.html#r29">m_selEllipse</a>.at(0)=cos(<a class="code" href="classcatalog_access_1_1_catalog.html#r20">m_selEllipseCentRA_deg</a> * Angle_Conv);
00404   <a class="code" href="classcatalog_access_1_1_catalog.html#r29">m_selEllipse</a>.at(1)=sin(<a class="code" href="classcatalog_access_1_1_catalog.html#r20">m_selEllipseCentRA_deg</a> * Angle_Conv);
00405   <a class="code" href="classcatalog_access_1_1_catalog.html#r29">m_selEllipse</a>.at(2)=cos(<a class="code" href="classcatalog_access_1_1_catalog.html#r21">m_selEllipseCentDEC_deg</a>* Angle_Conv);
00406   <a class="code" href="classcatalog_access_1_1_catalog.html#r29">m_selEllipse</a>.at(3)=sin(<a class="code" href="classcatalog_access_1_1_catalog.html#r21">m_selEllipseCentDEC_deg</a>* Angle_Conv);
00407   <a class="code" href="classcatalog_access_1_1_catalog.html#r29">m_selEllipse</a>.at(4)=cos(majAxis_deg * Angle_Conv);
00408 
00409   sortie &lt;&lt; <span class="stringliteral">"selection ellipse center RA="</span> &lt;&lt; std::setprecision(4)
00410          &lt;&lt; <a class="code" href="classcatalog_access_1_1_catalog.html#r20">m_selEllipseCentRA_deg</a> &lt;&lt; <span class="stringliteral">" , DEC="</span>
00411          &lt;&lt; <a class="code" href="classcatalog_access_1_1_catalog.html#r21">m_selEllipseCentDEC_deg</a> &lt;&lt; <span class="stringliteral">" with radius "</span>
00412          &lt;&lt; <a class="code" href="classcatalog_access_1_1_catalog.html#r23">m_selEllipseMajAxis_deg</a> &lt;&lt; <span class="stringliteral">" * "</span>
00413          &lt;&lt; <a class="code" href="classcatalog_access_1_1_catalog.html#r22">m_selEllipseMinAxis_deg</a> &lt;&lt; <span class="stringliteral">" (degrees) orientated at "</span>
00414          &lt;&lt; <a class="code" href="classcatalog_access_1_1_catalog.html#r24">m_selEllipseRot_deg</a> &lt;&lt; <span class="stringliteral">" (with respect to North pole)"</span>;
00415   <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, sortie.str());
00416   <span class="comment">/* if no data: exit */</span>
00417   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00418 
00419   <span class="comment">// now, apply the selection ellipse</span>
00420   std::vector&lt;bool&gt; isSelected;
00421   <a class="code" href="classcatalog_access_1_1_catalog.html#d2">existCriteria</a>(&amp;isSelected); <span class="comment">// returns true (m_selRegion is true)</span>
00422   <span class="keywordtype">bool</span> check;
00423   <span class="keywordtype">int</span> nRA =<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[<a class="code" href="classcatalog_access_1_1_catalog.html#r27">m_indexRA</a>].m_index,
00424       nDEC=m_quantities[<a class="code" href="classcatalog_access_1_1_catalog.html#r28">m_indexDEC</a>].m_index;
00425   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> currSel;
00426   <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00427   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
00428 
00429     check=<a class="code" href="classcatalog_access_1_1_catalog.html#d3">checkRegion</a>(i, nRA, nDEC);
00430     currSel=<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(i);
00431     <span class="keywordflow">if</span> (check) <span class="comment">// setting 2nd bit to 1</span>
00432       m_rowIsSelected[0].at(i)=currSel | 2ul;
00433     <span class="keywordflow">else</span>       <span class="comment">// setting 2nd bit to 0</span>
00434       m_rowIsSelected[0].at(i)=currSel &amp; (Max_Test-2ul);
00435     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#d6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>++;
00436 
00437   }<span class="comment">// loop on all rows</span>
00438   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00439 }
00440 <span class="comment">/**********************************************************************/</span>
00441 <span class="comment">// remove the effects of the ellipse selection</span>
<a name="l00442"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a55">00442</a> <span class="keywordtype">int</span> Catalog::unsetSelEllipse() {
00443 
00444   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(<span class="stringliteral">"unsetSelEllipse"</span>, <span class="keyword">true</span>);
00445   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00446 
00447   <span class="comment">// if region was already unset: do nothing</span>
00448   <span class="keywordflow">if</span> (!<a class="code" href="classcatalog_access_1_1_catalog.html#r19">m_selRegion</a>) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00449   <a class="code" href="classcatalog_access_1_1_catalog.html#r19">m_selRegion</a>=<span class="keyword">false</span>;
00450   <span class="comment">/* if no data: exit */</span>
00451   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00452 
00453   <span class="comment">// now, must check criteria on other quantities</span>
00454   std::vector&lt;bool&gt; isSelected;
00455   <span class="keywordtype">bool</span> oneCriteria=<a class="code" href="classcatalog_access_1_1_catalog.html#d2">existCriteria</a>(&amp;isSelected);
00456   <span class="keywordflow">if</span> (oneCriteria) {
00457     <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00458     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
00459 
00460       <span class="comment">// setting 2nd bit to 0</span>
00461       <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(i)&amp;= (Max_Test-2ul);
00462       <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#d6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>++;
00463  
00464     }<span class="comment">// loop on rows</span>
00465   }
00466   <span class="keywordflow">else</span> {
00467     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a> &gt; 0) {
00468       quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>.size();
00469       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;quantSize; j++) <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[j].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>, 0);
00470     }
00471     <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00472     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, <span class="stringliteral">"All rows unselected"</span>);
00473   }
00474   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00475 }
00476 
00477 
00478 <span class="comment">/**********************************************************************/</span>
00479 <span class="comment">// set and apply a cut on given quantity such that all values &gt;= cutVal pass</span>
00480 <span class="comment">// double is not const because it can be locally modified to NO_SEL_CUT</span>
<a name="l00481"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a56">00481</a> <span class="keywordtype">int</span> Catalog::setLowerCut(<span class="keyword">const</span> std::string name, <span class="keywordtype">double</span> cutVal) {
00482 
00483   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"setLowerCut"</span>;
00484   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(origin, <span class="keyword">true</span>);
00485   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00486 
00487   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
00488   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
00489   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_type != Quantity::NUM) {  
00490     std::string errText;
00491     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00492     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
00493     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00494   }
00495 
00496   <span class="comment">// if cut is the same: do nothing</span>
00497   <span class="keywordflow">if</span> (cutVal &gt;= <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) cutVal=<a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>;
00498   <span class="keywordflow">if</span> (cutVal == <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_lowerCut) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00499   <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_lowerCut=cutVal;
00500 
00501   <span class="comment">/* if no data: exit */</span>
00502   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00503 
00504   std::vector&lt;bool&gt; isSelected;
00505   <span class="keywordtype">bool</span> oneCriteria=<a class="code" href="classcatalog_access_1_1_catalog.html#d2">existCriteria</a>(&amp;isSelected);
00506   <span class="keywordtype">bool</span> check=<span class="keyword">true</span>;
00507   <span class="keywordflow">if</span> (cutVal &gt;= <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) {
00508     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, <span class="stringliteral">"Disabling lower cut (on "</span>+name+<span class="stringliteral">")"</span>);
00509     <span class="keywordflow">if</span> (!oneCriteria) {
00510       <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a> &gt; 0) {
00511         quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>.size();
00512         <span class="keywordflow">for</span> (index=0; index&lt;quantSize; index++)
00513           <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[index].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>, 0);
00514       }
00515       <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00516       check=<span class="keyword">false</span>;
00517       <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, <span class="stringliteral">"All rows unselected"</span>);
00518     }
00519   }
00520   <span class="keywordflow">else</span> {
00521     std::ostringstream sortie;
00522     sortie &lt;&lt; <span class="stringliteral">"Enabling lower cut ("</span> &lt;&lt;cutVal&lt;&lt;<span class="stringliteral">" on "</span>&lt;&lt;name&lt;&lt; <span class="stringliteral">")"</span>;
00523     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, sortie.str());  
00524   }
00525   
00526   <span class="keywordflow">if</span> (check) {
00527     <span class="keywordtype">bool</span> reject=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_rejectNaN,
00528          cutOR=m_quantities[index].m_cutORed,
00529          miss=m_quantities[index].m_excludeList;
00530     <span class="keywordtype">double</span> precis=m_quantities[index].m_precision;
00531     <span class="keywordtype">int</span>  k,
00532          pos=m_quantities[index].m_index;
00533     <span class="keywordtype">long</span> i;
00534     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> test=<a class="code" href="classcatalog_access_1_1_catalog.html#d29">bitPosition</a>(index, &amp;k);
00535     <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00536     <span class="comment">// true if given quantity is selected (list or lower/upper cut)</span>
00537     oneCriteria=isSelected.at(index+1);
00538     <span class="keywordflow">if</span> (oneCriteria) {
00539 
00540       <span class="comment">// due to NaN test, call checkNUM only if selection exists</span>
00541       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
00542         <span class="keywordflow">if</span> (!cutOR) <span class="comment">// usual case</span>
00543           check=<a class="code" href="classcatalog_access_1_1_catalog.html#d4">checkNUM</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[pos].at(i), index, miss, reject, precis);
00544         <span class="keywordflow">else</span>
00545           check=<a class="code" href="classcatalog_access_1_1_catalog.html#d5">checkNUMor</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[pos].at(i), index, reject, precis);
00546         <span class="comment">// setting required bit</span>
00547         <span class="keywordflow">if</span> (check)
00548           <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)|= test;
00549         <span class="keywordflow">else</span>
00550           <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00551         <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#d6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>++;
00552       }<span class="comment">// loop on rows</span>
00553 
00554     }
00555     <span class="keywordflow">else</span> {
00556 
00557       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
00558         <span class="comment">// required bit set to FALSE</span>
00559         <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00560         <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#d6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>++;
00561       }<span class="comment">// loop on rows</span>
00562 
00563     }
00564   }
00565   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00566 }
00567 <span class="comment">/**********************************************************************/</span>
00568 <span class="comment">// set and apply a cut on given quantity such that all values &lt;= cutVal pass</span>
00569 <span class="comment">// double is not const because it can be locally modified to NO_SEL_CUT</span>
<a name="l00570"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a57">00570</a> <span class="keywordtype">int</span> Catalog::setUpperCut(<span class="keyword">const</span> std::string name, <span class="keywordtype">double</span> cutVal) {
00571 
00572   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"setUpperCut"</span>;
00573   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(origin, <span class="keyword">true</span>);
00574   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00575 
00576   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
00577   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
00578   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_type != Quantity::NUM) {  
00579     std::string errText;
00580     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00581     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
00582     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00583   }
00584   <span class="comment">// if cut is the same: do nothing</span>
00585   <span class="keywordflow">if</span> (cutVal &gt;= <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) cutVal=<a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>;
00586   <span class="keywordflow">if</span> (cutVal == <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_upperCut) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00587   <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_upperCut=cutVal;
00588 
00589   <span class="comment">/* if no data: exit */</span>
00590   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00591 
00592   std::vector&lt;bool&gt; isSelected;
00593   <span class="keywordtype">bool</span> oneCriteria=<a class="code" href="classcatalog_access_1_1_catalog.html#d2">existCriteria</a>(&amp;isSelected);
00594   <span class="keywordtype">bool</span> check=<span class="keyword">true</span>;
00595   <span class="keywordflow">if</span> (cutVal &gt;= <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) {
00596     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, <span class="stringliteral">"Disabling upper cut (on "</span>+name+<span class="stringliteral">")"</span>);
00597     <span class="keywordflow">if</span> (!oneCriteria) {
00598       <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a> &gt; 0) {
00599         quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>.size();
00600         <span class="keywordflow">for</span> (index=0; index&lt;quantSize; index++)
00601           <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[index].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>, 0);
00602       }
00603       <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00604       check=<span class="keyword">false</span>;
00605       <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, <span class="stringliteral">"All rows unselected"</span>);
00606     }
00607   }
00608   <span class="keywordflow">else</span> {
00609     std::ostringstream sortie;
00610     sortie &lt;&lt; <span class="stringliteral">"Enabling upper cut ("</span> &lt;&lt;cutVal&lt;&lt;<span class="stringliteral">" on "</span>&lt;&lt;name&lt;&lt; <span class="stringliteral">")"</span>;
00611     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, sortie.str());  
00612   }
00613   
00614   <span class="keywordflow">if</span> (check) {
00615     <span class="keywordtype">bool</span> reject=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_rejectNaN,
00616          cutOR=m_quantities[index].m_cutORed,
00617          miss=m_quantities[index].m_excludeList;
00618     <span class="keywordtype">double</span> precis=m_quantities[index].m_precision;
00619     <span class="keywordtype">int</span>  k,
00620          pos=m_quantities[index].m_index;
00621     <span class="keywordtype">long</span> i;
00622     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> test=<a class="code" href="classcatalog_access_1_1_catalog.html#d29">bitPosition</a>(index, &amp;k);
00623     <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00624     <span class="comment">// true if given quantity is selected (list or lower/upper cut)</span>
00625     oneCriteria=isSelected.at(index+1);
00626     <span class="keywordflow">if</span> (oneCriteria) {
00627 
00628       <span class="comment">// due to NaN test, call checkNUM only if selection exists</span>
00629       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
00630         <span class="keywordflow">if</span> (!cutOR) <span class="comment">// usual case</span>
00631           check=<a class="code" href="classcatalog_access_1_1_catalog.html#d4">checkNUM</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[pos].at(i), index, miss, reject, precis);
00632         <span class="keywordflow">else</span>
00633           check=<a class="code" href="classcatalog_access_1_1_catalog.html#d5">checkNUMor</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[pos].at(i), index, reject, precis);
00634         <span class="comment">// setting required bit</span>
00635         <span class="keywordflow">if</span> (check)
00636           <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)|= test;
00637         <span class="keywordflow">else</span>
00638           <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00639         <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#d6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>++;
00640       }<span class="comment">// loop on rows</span>
00641 
00642     }
00643     <span class="keywordflow">else</span> {
00644 
00645       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
00646         <span class="comment">// required bit set to FALSE</span>
00647         <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00648         <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#d6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>++;
00649       }<span class="comment">// loop on rows</span>
00650 
00651     }
00652   }
00653   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00654 }
00655 
00656 <span class="comment">/**********************************************************************/</span>
00657 <span class="comment">// set and apply a cut on quantities in VECTOR type quantity "name"</span>
00658 <span class="comment">// such that all values &gt;= cutValues[i] pass</span>
00659  
00660 <span class="comment">/**********************************************************************/</span>
00661 <span class="comment">// set and apply a cut on quantities in VECTOR type quantity "name"</span>
00662 <span class="comment">// such that all values &lt;= cutValues[i] pass</span>
00663  
00664 
00665 <span class="comment">/**********************************************************************/</span>
00666 <span class="comment">// select rows depending on the given numerical list for existing index</span>
<a name="l00667"></a><a class="code" href="classcatalog_access_1_1_catalog.html#d9">00667</a> <span class="keywordtype">int</span> Catalog::doSelN(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">int</span> code,
00668                     <span class="keyword">const</span> std::vector&lt;double&gt; &amp;listVal) {
00669 
00670   std::ostringstream sortie;
00671   <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_cutORed=<span class="keyword">false</span>;
00672   <span class="keywordtype">bool</span> miss;
00673   <span class="comment">// take only first 7 char to match possible generic functions</span>
00674   <span class="keywordflow">if</span> (code &amp; 1) {
00675     <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_excludeList=<span class="keyword">false</span>;
00676     miss=<span class="keyword">false</span>;
00677     sortie &lt;&lt; <span class="stringliteral">"Include rows"</span>;
00678   }
00679   <span class="keywordflow">else</span> {
00680     <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_excludeList=<span class="keyword">true</span>;
00681     miss=<span class="keyword">true</span>;
00682     sortie &lt;&lt; <span class="stringliteral">"Exclude rows"</span>;
00683   }
00684   <span class="keywordtype">int</span> listSize=listVal.size();
00685   <span class="comment">/* if empty list as before: exit */</span>
00686   <span class="keywordflow">if</span> (listSize == 0) {
00687     <span class="comment">// if NO list, m_cutORed has no effect (false method quicker)</span>
00688     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_listValN.size() == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00689   }
00690   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (code &gt; 1)
00691     <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_cutORed=<span class="keyword">true</span>;
00692 
00693   <span class="keywordtype">int</span> j;
00694   <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_listValN.clear();
00695   <span class="keywordflow">for</span> (j=0; j&lt;listSize; j++)
00696      <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_listValN.push_back(listVal.at(j));
00697 
00698   <span class="comment">/* if no data: exit */</span>
00699   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00700 
00701   std::vector&lt;bool&gt; isSelected;
00702   <span class="keywordtype">bool</span> oneCriteria=<a class="code" href="classcatalog_access_1_1_catalog.html#d2">existCriteria</a>(&amp;isSelected);
00703   <span class="keywordtype">bool</span> check=<span class="keyword">true</span>;
00704   <span class="keywordflow">if</span> (listSize == 0) {
00705     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, <span class="stringliteral">"Disabling list selection (on "</span>+name+<span class="stringliteral">")"</span>);
00706     <span class="keywordflow">if</span> (!oneCriteria) {
00707       <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a> &gt; 0) {
00708         listSize=<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>.size(); <span class="comment">// to avoid compiler Warning</span>
00709         <span class="keywordflow">for</span> (j=0; j&lt;listSize; j++)
00710           <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[j].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>, 0);
00711       }
00712       <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00713       check=<span class="keyword">false</span>;
00714       <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, <span class="stringliteral">"All rows unselected"</span>);
00715     }
00716   }
00717   <span class="keywordflow">else</span> {
00718     sortie &lt;&lt; <span class="stringliteral">" with \""</span> &lt;&lt; name &lt;&lt;<span class="stringliteral">"\" around value in list ("</span>
00719            &lt;&lt; listSize &lt;&lt; <span class="stringliteral">" elements, "</span>;
00720     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_cutORed)
00721       sortie &lt;&lt; <span class="stringliteral">"ORed with cut)"</span>;
00722     <span class="keywordflow">else</span>
00723       sortie &lt;&lt; <span class="stringliteral">"ANDed with cut)"</span>;
00724     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, sortie.str());
00725   }
00726   
00727   <span class="keywordflow">if</span> (check) {
00728     <span class="keywordtype">bool</span> reject=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_rejectNaN,
00729          cutOR=m_quantities[index].m_cutORed;
00730     <span class="keywordtype">double</span> precis=m_quantities[index].m_precision;
00731     <span class="keywordtype">int</span>  k,
00732          pos=m_quantities[index].m_index;
00733     <span class="keywordtype">long</span> i;
00734     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> test=<a class="code" href="classcatalog_access_1_1_catalog.html#d29">bitPosition</a>(index, &amp;k);
00735     <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00736     <span class="comment">// true if given quantity is selected (list or lower/upper cut)</span>
00737     oneCriteria=isSelected.at(index+1);
00738     <span class="keywordflow">if</span> (oneCriteria) {
00739 
00740       <span class="comment">// due to NaN test, call checkNUM only if selection exists</span>
00741       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
00742         <span class="keywordflow">if</span> (!cutOR) <span class="comment">// usual case</span>
00743           check=<a class="code" href="classcatalog_access_1_1_catalog.html#d4">checkNUM</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[pos].at(i), index, miss, reject, precis);
00744         <span class="keywordflow">else</span>
00745           check=<a class="code" href="classcatalog_access_1_1_catalog.html#d5">checkNUMor</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[pos].at(i), index, reject, precis);
00746         <span class="comment">// setting required bit</span>
00747         <span class="keywordflow">if</span> (check)
00748           <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)|= test;
00749         <span class="keywordflow">else</span>
00750           <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00751         <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#d6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>++;
00752       }<span class="comment">// loop on rows</span>
00753 
00754     }
00755     <span class="keywordflow">else</span> {
00756 
00757       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
00758         <span class="comment">// required bit set to FALSE</span>
00759         <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00760         <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#d6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>++;
00761       }<span class="comment">// loop on rows</span>
00762 
00763     }
00764   }
00765   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;  
00766 }
00767 <span class="comment">/**********************************************************************/</span>
00768 <span class="comment">// include rows which value is NOT in the given list AND value within cut</span>
<a name="l00769"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a60">00769</a> <span class="keywordtype">int</span> Catalog::excludeN(<span class="keyword">const</span> std::string name,
00770                       <span class="keyword">const</span> std::vector&lt;double&gt; &amp;listVal) {
00771 
00772   <span class="keywordtype">int</span> done=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(<span class="stringliteral">"excludeN"</span>, <span class="keyword">true</span>);
00773   <span class="keywordflow">if</span> (done &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> done;
00774   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(<span class="stringliteral">"excludeN"</span>, name);
00775   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
00776 
00777   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_type != Quantity::NUM) {  
00778     std::string errText;
00779     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00780     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"excludeN"</span>, errText);
00781     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00782   }
00783   done=<a class="code" href="classcatalog_access_1_1_catalog.html#d9">doSelN</a>(name, index, 0, listVal);
00784   <span class="keywordflow">return</span> done;
00785 }
00786 <span class="comment">/**********************************************************************/</span>
00787 <span class="comment">// only include rows which have numerical value in the given list AND cut</span>
<a name="l00788"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a61">00788</a> <span class="keywordtype">int</span> Catalog::useOnlyN(<span class="keyword">const</span> std::string name,
00789                       <span class="keyword">const</span> std::vector&lt;double&gt; &amp;listVal) {
00790 
00791   <span class="keywordtype">int</span> done=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(<span class="stringliteral">"useOnlyN"</span>, <span class="keyword">true</span>);
00792   <span class="keywordflow">if</span> (done &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> done;
00793   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(<span class="stringliteral">"useOnlyN"</span>, name);
00794   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
00795 
00796   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_type != Quantity::NUM) {  
00797     std::string errText;
00798     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00799     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"useOnlyN"</span>, errText);
00800     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00801   }
00802   done=<a class="code" href="classcatalog_access_1_1_catalog.html#d9">doSelN</a>(name, index, 1, listVal);
00803   <span class="keywordflow">return</span> done;
00804 }
00805 <span class="comment">/**********************************************************************/</span>
00806 <span class="comment">// only include rows which have numerical value in the given list OR cut</span>
<a name="l00807"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a62">00807</a> <span class="keywordtype">int</span> Catalog::includeN(<span class="keyword">const</span> std::string name,
00808                       <span class="keyword">const</span> std::vector&lt;double&gt; &amp;listVal) {
00809 
00810   <span class="keywordtype">int</span> done=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(<span class="stringliteral">"includeN"</span>, <span class="keyword">true</span>);
00811   <span class="keywordflow">if</span> (done &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> done;
00812   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(<span class="stringliteral">"includeN"</span>, name);
00813   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
00814 
00815   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_type != Quantity::NUM) {  
00816     std::string errText;
00817     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00818     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"includeN"</span>, errText);
00819     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00820   }
00821   done=<a class="code" href="classcatalog_access_1_1_catalog.html#d9">doSelN</a>(name, index, 3, listVal); <span class="comment">// 3 to set bit 0 to 1.</span>
00822   <span class="keywordflow">return</span> done;
00823 }
00824 
00825 <span class="comment">/**********************************************************************/</span>
00826 <span class="comment">// set quantity member and apply (if different and quantity is selected)</span>
<a name="l00827"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a63">00827</a> <span class="keywordtype">int</span> Catalog::setRejectNaN(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">bool</span> rejectNaN) {
00828 
00829   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"setRejectNaN"</span>;
00830   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(origin, <span class="keyword">true</span>);
00831   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00832   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
00833   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
00834   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_type != Quantity::NUM) {  
00835     std::string errText;
00836     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00837     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
00838     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00839   }
00840   <span class="comment">// if same boolean: do nothing</span>
00841   <span class="keywordflow">if</span> (rejectNaN == <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_rejectNaN) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00842   <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_rejectNaN=rejectNaN;
00843 
00844   <span class="comment">/* if no data: exit */</span>
00845   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00846 
00847   std::vector&lt;bool&gt; isSelected;
00848   <a class="code" href="classcatalog_access_1_1_catalog.html#d2">existCriteria</a>(&amp;isSelected);
00849   <span class="keywordflow">if</span> (isSelected.at(index+1)) {
00850     <span class="comment">// apply the selection with new behaviour on NaN</span>
00851 
00852     std::string text=<span class="stringliteral">"NaN values are now "</span>;
00853     <span class="keywordflow">if</span> (rejectNaN) text=text+<span class="stringliteral">" rejected (on "</span>;
00854     <span class="keywordflow">else</span> text=text+<span class="stringliteral">" accepted (on "</span>;
00855     text=text+name+ <span class="stringliteral">")"</span>;
00856     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, text);
00857     <span class="keywordtype">bool</span> check,
00858          cutOR=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_cutORed,
00859          miss=m_quantities[index].m_excludeList;
00860     <span class="keywordtype">double</span> precis=m_quantities[index].m_precision;
00861     <span class="keywordtype">int</span>  k,
00862          pos=m_quantities[index].m_index;
00863     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> test=<a class="code" href="classcatalog_access_1_1_catalog.html#d29">bitPosition</a>(index, &amp;k);
00864     <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00865     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
00866 
00867       <span class="keywordflow">if</span> (!cutOR) <span class="comment">// usual case</span>
00868         check=<a class="code" href="classcatalog_access_1_1_catalog.html#d4">checkNUM</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[pos].at(i), index, miss, rejectNaN, precis);
00869       <span class="keywordflow">else</span>
00870         check=<a class="code" href="classcatalog_access_1_1_catalog.html#d5">checkNUMor</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[pos].at(i), index, rejectNaN, precis);
00871       <span class="keywordflow">if</span> (check)
00872         <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)|= test;
00873       <span class="keywordflow">else</span>
00874         <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00875       <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#d6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>++;
00876 
00877     }<span class="comment">// loop on rows</span>
00878 
00879   }
00880   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;  
00881 }
00882 <span class="comment">/**********************************************************************/</span>
00883 <span class="comment">// set quantity member and apply (if quantity has a non empty selection list)</span>
<a name="l00884"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a64">00884</a> <span class="keywordtype">int</span> Catalog::setMatchPercent(<span class="keyword">const</span> std::string name, <span class="keywordtype">double</span> percent) {
00885 
00886   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"setMatchPercent"</span>;
00887   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(origin, <span class="keyword">true</span>);
00888   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00889   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
00890   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
00891   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_type != Quantity::NUM) {  
00892     std::string errText;
00893     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00894     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
00895     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00896   }
00897   std::ostringstream sortie;
00898   <span class="keywordflow">if</span> (percent &lt;= 100.*NearZero) {
00899     sortie &lt;&lt; <span class="stringliteral">"Percentage must be &gt; "</span> &lt;&lt; 100.*NearZero;
00900     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, sortie.str());
00901     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a32">BAD_SEL_LIM</a>;
00902   }
00903   <span class="comment">// if limit is the same: do nothing</span>
00904   percent/=100.;
00905   <span class="keywordflow">if</span> (percent == <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_precision) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00906   m_quantities.at(index).m_precision=percent;
00907 
00908   <span class="comment">/* if no data: exit */</span>
00909   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00910   <span class="comment">/* if empty list: exit */</span>
00911   <span class="keywordflow">if</span> (m_quantities[index].m_listValN.size() == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00912 
00913   std::vector&lt;bool&gt; isSelected;
00914   <a class="code" href="classcatalog_access_1_1_catalog.html#d2">existCriteria</a>(&amp;isSelected);
00915   <span class="comment">// quantity is selected since list is not empty</span>
00916   sortie &lt;&lt; <span class="stringliteral">"Relative precision for values in list (for "</span>&lt;&lt;name&lt;&lt; <span class="stringliteral">")"</span>
00917          &lt;&lt; <span class="stringliteral">" is: "</span> &lt;&lt; percent &lt;&lt; <span class="stringliteral">" (absolute precision around 0)"</span>;
00918   <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, sortie.str());
00919   <span class="keywordtype">bool</span> check,
00920        cutOR=m_quantities[index].m_cutORed,
00921        reject=m_quantities[index].m_rejectNaN,
00922        miss=m_quantities[index].m_excludeList;
00923   <span class="keywordtype">int</span>  k,
00924        pos=m_quantities[index].m_index;
00925   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> test=<a class="code" href="classcatalog_access_1_1_catalog.html#d29">bitPosition</a>(index, &amp;k);
00926   <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00927   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
00928 
00929     <span class="keywordflow">if</span> (!cutOR) <span class="comment">// usual case</span>
00930       check=<a class="code" href="classcatalog_access_1_1_catalog.html#d4">checkNUM</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[pos].at(i), index, miss, reject, percent);
00931     <span class="keywordflow">else</span>
00932       check=<a class="code" href="classcatalog_access_1_1_catalog.html#d5">checkNUMor</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[pos].at(i), index, reject, percent);
00933     <span class="keywordflow">if</span> (check)
00934       <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)|= test;
00935     <span class="keywordflow">else</span>
00936       <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00937     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#d6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>++;
00938 
00939   }<span class="comment">// loop on rows</span>
00940 
00941   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;  
00942 }
00943 <span class="comment">/**********************************************************************/</span>
00944 <span class="comment">// set quantity member and apply (if quantity has a non empty selection list)</span>
<a name="l00945"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a65">00945</a> <span class="keywordtype">int</span> Catalog::setMatchEpsilon(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> step)
00946 {
00947   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"setMatchEpsilon"</span>;
00948   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(origin, <span class="keyword">true</span>);
00949   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00950   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
00951   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
00952   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_type != Quantity::NUM) {  
00953     std::string errText;
00954     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00955     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
00956     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00957   }
00958   std::ostringstream sortie;
00959   <span class="keywordflow">if</span> (step == 0ul) {
00960     sortie &lt;&lt; <span class="stringliteral">"Number of epsilon must be &gt; 0"</span>;
00961     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, sortie.str());
00962     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a32">BAD_SEL_LIM</a>;
00963   }
00964   <span class="comment">// if limit is the same: do nothing</span>
00965   <span class="keywordtype">double</span> precis=step*std::numeric_limits&lt;double&gt;::epsilon();
00966   <span class="keywordflow">if</span> (precis == <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_precision) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00967   m_quantities.at(index).m_precision=precis;
00968 
00969   <span class="comment">/* if no data: exit */</span>
00970   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00971   <span class="comment">/* if empty list: exit */</span>
00972   <span class="keywordflow">if</span> (m_quantities[index].m_listValN.size() == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00973 
00974   std::vector&lt;bool&gt; isSelected;
00975   <a class="code" href="classcatalog_access_1_1_catalog.html#d2">existCriteria</a>(&amp;isSelected);
00976   <span class="comment">// quantity is selected since list is not empty</span>
00977   sortie &lt;&lt; <span class="stringliteral">"Relative precision for values in list (for "</span>&lt;&lt;name&lt;&lt; <span class="stringliteral">")"</span>
00978          &lt;&lt; <span class="stringliteral">" is: "</span> &lt;&lt; precis &lt;&lt; <span class="stringliteral">" (absolute precision around 0)"</span>;
00979   <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, sortie.str());
00980   <span class="keywordtype">bool</span> check,
00981        cutOR=m_quantities[index].m_cutORed,
00982        reject=m_quantities[index].m_rejectNaN,
00983        miss=m_quantities[index].m_excludeList;
00984   <span class="keywordtype">int</span>  k,
00985        pos=m_quantities[index].m_index;
00986   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> test=<a class="code" href="classcatalog_access_1_1_catalog.html#d29">bitPosition</a>(index, &amp;k);
00987   <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00988   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
00989 
00990     <span class="keywordflow">if</span> (!cutOR) <span class="comment">// usual case</span>
00991       check=<a class="code" href="classcatalog_access_1_1_catalog.html#d4">checkNUM</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[pos].at(i), index, miss, reject, precis);
00992     <span class="keywordflow">else</span>
00993       check=<a class="code" href="classcatalog_access_1_1_catalog.html#d5">checkNUMor</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[pos].at(i), index, reject, precis);
00994     <span class="keywordflow">if</span> (check)
00995       <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)|= test;
00996     <span class="keywordflow">else</span>
00997       <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00998     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#d6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>++;
00999 
01000   }<span class="comment">// loop on rows</span>
01001 
01002   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;  
01003 }
01004 
01005 <span class="comment">/**********************************************************************/</span>
01006 <span class="comment">// check if given value is within interval cut</span>
<a name="l01007"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a66">01007</a> <span class="keywordtype">int</span> Catalog::checkValWithinCut(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">double</span> value,
01008                                <span class="keywordtype">bool</span> *cutLow, <span class="keywordtype">bool</span> *cutUp,<span class="keywordtype">int</span> *checkResult) {
01009 
01010   *cutLow=<span class="keyword">false</span>;
01011   *cutUp=<span class="keyword">false</span>;
01012   *checkResult=0;
01013   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"checkValWithinCut"</span>;
01014   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(origin, <span class="keyword">true</span>);
01015   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
01016   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
01017   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
01018   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_type != Quantity::NUM) {  
01019     std::string errText;
01020     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
01021     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
01022     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
01023   }  
01024 
01025   <span class="keywordtype">double</span> myLimit, r=value;
01026   myLimit=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_lowerCut;
01027   <span class="keywordflow">if</span> (fabs(value) &gt; NearZero)
01028     r+=value*m_quantities[index].m_precision;
01029   <span class="keywordflow">else</span>
01030     r+=m_quantities[index].m_precision;
01031   <span class="keywordflow">if</span> (myLimit &lt; <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) {
01032     *cutLow=<span class="keyword">true</span>;
01033     <span class="keywordflow">if</span> (r &lt; myLimit) *checkResult=-2;
01034     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value &lt; myLimit) *checkResult=-1;
01035   }
01036   r=value;
01037   myLimit=m_quantities[index].m_upperCut;
01038   <span class="keywordflow">if</span> (fabs(value) &gt; NearZero)
01039     r-=value*m_quantities[index].m_precision;
01040   <span class="keywordflow">else</span>
01041     r-=m_quantities[index].m_precision;
01042   <span class="keywordflow">if</span> (myLimit &lt; <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) {
01043     *cutUp=<span class="keyword">true</span>;
01044     <span class="keywordflow">if</span> (r &gt; myLimit) *checkResult=2;
01045     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value &gt; myLimit) *checkResult=1;
01046   }
01047 
01048   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;  
01049 }
01050 
01051 
01052 <span class="comment">/**********************************************************************/</span>
01053 <span class="comment">// select rows depending on the given string list for existing index</span>
<a name="l01054"></a><a class="code" href="classcatalog_access_1_1_catalog.html#d8">01054</a> <span class="keywordtype">int</span> Catalog::doSelS(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">int</span> code,
01055                     <span class="keyword">const</span> std::vector&lt;std::string&gt; &amp;list, <span class="keyword">const</span> <span class="keywordtype">bool</span> exact) {
01056 
01057   std::ostringstream sortie;
01058   <span class="keywordtype">bool</span> miss;
01059   <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_cutORed=!exact;
01060   <span class="keywordflow">if</span> (code &amp; 1) {
01061     <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_excludeList=<span class="keyword">false</span>;
01062     miss=<span class="keyword">false</span>;
01063     sortie &lt;&lt; <span class="stringliteral">"Include rows"</span>;
01064   }
01065   <span class="keywordflow">else</span> {
01066     <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_excludeList=<span class="keyword">true</span>;
01067     miss=<span class="keyword">true</span>;
01068     sortie &lt;&lt; <span class="stringliteral">"Exclude rows"</span>;
01069   }
01070   <span class="keywordtype">int</span> listSize=list.size();
01071   <span class="keywordflow">if</span> ((!listSize) &amp;&amp; (!<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_listValS.size())) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01072   <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_listValS.clear();
01073   <span class="keywordtype">int</span> j;
01074   int (*pfunc)(<span class="keywordtype">int</span>)=tolower; <span class="comment">// function used by transform</span>
01075   std::vector&lt;std::string&gt; myList;
01076   std::string mot;
01077   <span class="keywordflow">for</span> (j=0; j&lt;listSize; j++) {
01078     mot=list.at(j);
01079     <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_listValS.push_back(mot);
01080     <span class="keywordflow">if</span> (!exact) std::transform(mot.begin(), mot.end(), mot.begin(), pfunc);
01081     myList.push_back(mot);
01082   }
01083 <span class="preprocessor">  #ifdef DEBUG_CAT</span>
01084 <span class="preprocessor"></span>  <span class="keywordflow">for</span> (j=0; j&lt;listSize; j++) std::cout &lt;&lt; myList[j] &lt;&lt; <span class="stringliteral">"|"</span>;
01085   std::cout &lt;&lt;<span class="stringliteral">"caseless="</span>&lt;&lt; exact &lt;&lt; std::endl;
01086 <span class="preprocessor">  #endif</span>
01087 <span class="preprocessor"></span>
01088   <span class="comment">/* if no data: exit */</span>
01089   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01090 
01091   std::vector&lt;bool&gt; isSelected;
01092   <span class="keywordtype">bool</span> check=<a class="code" href="classcatalog_access_1_1_catalog.html#d2">existCriteria</a>(&amp;isSelected);
01093   <span class="keywordtype">int</span>  k;
01094   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> test=<a class="code" href="classcatalog_access_1_1_catalog.html#d29">bitPosition</a>(index, &amp;k);
01095   <span class="keywordflow">if</span> (listSize == 0) {
01096     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, <span class="stringliteral">"Disabling list selection (on "</span>+name+<span class="stringliteral">")"</span>);
01097     <span class="keywordflow">if</span> (!check) {
01098       <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a> &gt; 0) {
01099         listSize=<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>.size(); <span class="comment">// to avoid compiler Warning</span>
01100         <span class="keywordflow">for</span> (j=0; j&lt;listSize; j++) <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[j].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>, 0);
01101       }
01102       <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
01103       <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, <span class="stringliteral">"All rows unselected"</span>);
01104     }
01105     <span class="keywordflow">else</span> {
01106       <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
01107       <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
01108         <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
01109         <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#d6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>++;
01110       }
01111     }
01112     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01113   }
01114 
01115   sortie &lt;&lt; <span class="stringliteral">" with \""</span> &lt;&lt; name &lt;&lt;<span class="stringliteral">"\" string in list ("</span>
01116          &lt;&lt; listSize &lt;&lt; <span class="stringliteral">" elements, "</span>;
01117   <span class="keywordflow">if</span> (exact) sortie &lt;&lt; <span class="stringliteral">"exact match)"</span>; <span class="keywordflow">else</span> sortie &lt;&lt; <span class="stringliteral">"caseless match)"</span>; 
01118   <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, sortie.str());
01119   <span class="keywordtype">int</span>  pos=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[index].m_index;
01120   <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
01121   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
01122     mot=<a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>[pos].at(i);
01123     <span class="keywordflow">if</span> (!exact) std::transform(mot.begin(), mot.end(), mot.begin(), pfunc);
01124     check=miss;
01125     <span class="keywordflow">for</span> (j=0; j&lt;listSize; j++) {
01126       <span class="keywordflow">if</span> (mot == myList[j]) {check=!miss; <span class="keywordflow">break</span>;}
01127     }
01128     <span class="comment">// setting required bit</span>
01129     <span class="keywordflow">if</span> (check)
01130       <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)|= test;
01131     <span class="keywordflow">else</span>
01132       <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
01133     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#d6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>++;
01134   }<span class="comment">// loop on rows</span>
01135 
01136   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01137 }
01138 <span class="comment">/**********************************************************************/</span>
01139 <span class="comment">// exclude all rows which have string value in the given list</span>
<a name="l01140"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a58">01140</a> <span class="keywordtype">int</span> Catalog::excludeS(<span class="keyword">const</span> std::string name,
01141                       <span class="keyword">const</span> std::vector&lt;std::string&gt; &amp;list, <span class="keyword">const</span> <span class="keywordtype">bool</span> exact) {
01142 
01143   <span class="keywordtype">int</span> done=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(<span class="stringliteral">"excludeS"</span>, <span class="keyword">true</span>);
01144   <span class="keywordflow">if</span> (done &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> done;
01145   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(<span class="stringliteral">"excludeS"</span>, name);
01146   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
01147 
01148   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_type != Quantity::STRING) {  
01149     std::string errText;
01150     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of STRING type"</span>;
01151     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"excludeS"</span>, errText);
01152     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
01153   }
01154   done=<a class="code" href="classcatalog_access_1_1_catalog.html#d8">doSelS</a>(name, index, 0, list, exact);
01155   <span class="keywordflow">return</span> done;
01156 }
01157 <span class="comment">/**********************************************************************/</span>
01158 <span class="comment">// only include rows which have string value in the given list</span>
<a name="l01159"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a59">01159</a> <span class="keywordtype">int</span> Catalog::useOnlyS(<span class="keyword">const</span> std::string name,
01160                       <span class="keyword">const</span> std::vector&lt;std::string&gt; &amp;list, <span class="keyword">const</span> <span class="keywordtype">bool</span> exact) {
01161 
01162   <span class="keywordtype">int</span> done=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(<span class="stringliteral">"useOnlyS"</span>, <span class="keyword">true</span>);
01163   <span class="keywordflow">if</span> (done &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> done;
01164   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(<span class="stringliteral">"useOnlyS"</span>, name);
01165   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
01166 
01167   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(index).m_type != Quantity::STRING) {  
01168     std::string errText;
01169     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of STRING type"</span>;
01170     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"useOnlyS"</span>, errText);
01171     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
01172   }
01173   done=<a class="code" href="classcatalog_access_1_1_catalog.html#d8">doSelS</a>(name, index, 1, list, exact);
01174   <span class="keywordflow">return</span> done;
01175 }
01176 
01177 
01178 <span class="comment">/**********************************************************************/</span>
01179 <span class="comment">// erase all non-selected rows from memory</span>
<a name="l01180"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a67">01180</a> <span class="keywordtype">int</span> Catalog::eraseNonSelected() {
01181 
01182   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"eraseNonSelected"</span>;
01183   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> &lt;= 0) {
01184     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"catalog is empty"</span>);
01185     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>; 
01186   }
01187   <span class="comment">// test below avoid deleting NOTHING</span>
01188   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> == <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>) {
01189     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"all rows selected, nothing done"</span>);
01190     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>; 
01191   }
01192   <span class="comment">// log if ALL is deleted</span>
01193   std::string text;
01194   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a> == 0) {
01195     text=<span class="stringliteral">"no row selected, calling deleteContent()"</span>;
01196     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(2, text);
01197     <a class="code" href="classcatalog_access_1_1_catalog.html#a23">deleteContent</a>();
01198     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01199   }
01200   <span class="keywordflow">try</span> {
01201     <span class="keywordtype">long</span> i, tot=0;
01202     <span class="keywordtype">int</span> j;
01203     <span class="keywordtype">int</span> sizeS=<a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>.size();
01204     <span class="keywordtype">int</span> sizeN=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>.size();
01205     <span class="keywordtype">int</span> vecSize=<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>.size();
01206     <span class="comment">// to speed-up, will not change (avoid reading size in loop)</span>
01207 
01208     std::vector&lt;std::vector&lt;double&gt; &gt; myNum;
01209     myNum.resize(sizeN);
01210     <span class="keywordflow">for</span> (j=0; j&lt;sizeN; j++) myNum[j].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>, 0.0);
01211     std::vector&lt;std::vector&lt;std::string&gt; &gt; myStr;
01212     myStr.resize(sizeS);
01213     <span class="keywordflow">for</span> (j=0; j&lt;sizeS; j++) myStr[j].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>, <span class="stringliteral">""</span>);
01214     std::vector&lt;std::vector&lt;unsigned long&gt; &gt; myBits;
01215     myBits.resize(vecSize);
01216     <span class="keywordflow">for</span> (j=0; j&lt;vecSize; j++) myBits[j].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>, 0ul);
01217     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
01218       <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(i) &amp; 1) {
01219         <span class="keywordflow">for</span> (j=0; j&lt;sizeN; j++) myNum[j].at(tot)=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[j].at(i);
01220         <span class="keywordflow">for</span> (j=0; j&lt;sizeS; j++) myStr[j].at(tot)=<a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>[j].at(i);
01221         <span class="keywordflow">for</span> (j=0; j&lt;vecSize; j++) myBits[j].at(tot)=<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[j].at(i);
01222         <span class="keywordflow">if</span> (++tot == <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>) <span class="keywordflow">break</span>; <span class="comment">// to speed up</span>
01223       }
01224     }
01225     <span class="keywordflow">for</span> (j=0; j&lt;sizeN; j++) {
01226       <a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[j].insert(<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[j].begin(),
01227                              myNum[j].begin(), myNum[j].end());
01228       myNum[j].clear();
01229     }
01230     myNum.clear();
01231     <span class="keywordflow">for</span> (j=0; j&lt;sizeS; j++) {
01232       <a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>[j].insert(<a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>[j].begin(),
01233                           myStr[j].begin(), myStr[j].end());
01234       myStr[j].clear();
01235     }
01236     myStr.clear();
01237     <span class="keywordflow">for</span> (j=0; j&lt;vecSize; j++)  {
01238       <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[j].insert(<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[j].begin(),
01239                                 myBits[j].begin(), myBits[j].end());
01240       myBits[j].clear();
01241     }
01242     myBits.clear();
01243 <span class="comment">/* if (!keepCriteria) {</span>
01244 <span class="comment">    for (j=0; j&lt;vecSize; j++) m_rowIsSelected[j].assign(m_numSelRows, 0);</span>
01245 <span class="comment">    vecSize=m_quantities.size();</span>
01246 <span class="comment">    for (i=0; i&lt;vecSize; i++) {</span>
01247 <span class="comment">      m_quantities.at(i).m_listValS.clear();</span>
01248 <span class="comment">      m_quantities.at(i).m_lowerCut=NO_SEL_CUT;</span>
01249 <span class="comment">      m_quantities.at(i).m_upperCut=NO_SEL_CUT;</span>
01250 <span class="comment">      m_quantities.at(i).m_listValN.clear();</span>
01251 <span class="comment">    }</span>
01252 <span class="comment">    m_selRegion=false;</span>
01253 <span class="comment">*/</span>
01254 <span class="comment">/*  THIS METHOD IS VERY VERY LONG </span>
01255 <span class="comment">    std::vector&lt; std::vector&lt;std::string&gt;::iterator &gt; stringIter;</span>
01256 <span class="comment">    std::vector&lt; std::vector&lt;double&gt;::iterator &gt; doubleIter;</span>
01257 <span class="comment">    for (j=0; j&lt;sizeS; j++) stringIter.push_back(m_strings[j].begin());</span>
01258 <span class="comment">    for (j=0; j&lt;sizeN; j++) doubleIter.push_back(m_numericals[j].begin());</span>
01259 <span class="comment">    if (keepCriteria) {</span>
01260 <span class="comment"></span>
01261 <span class="comment">      std::vector&lt; std::vector&lt;unsigned long&gt;::iterator &gt; myIter;</span>
01262 <span class="comment">      for (j=0; j&lt;vecSize; j++) myIter.push_back(m_rowIsSelected[j].begin());</span>
01263 <span class="comment">      for (i=0; i&lt;m_numRows; i++) {</span>
01264 <span class="comment">        if (!(*myIter[0] &amp; 1)) {</span>
01265 <span class="comment">          for (j=0; j&lt;sizeS; j++) m_strings[j].erase(stringIter[j]);</span>
01266 <span class="comment">          for (j=0; j&lt;sizeN; j++) m_numericals[j].erase(doubleIter[j]);</span>
01267 <span class="comment">          for (j=0; j&lt;vecSize; j++) m_rowIsSelected[j].erase(myIter[j]);</span>
01268 <span class="comment">        }</span>
01269 <span class="comment">        else {</span>
01270 <span class="comment">          for (j=0; j&lt;sizeS; j++) stringIter.at(j)++;</span>
01271 <span class="comment">          for (j=0; j&lt;sizeN; j++) doubleIter.at(j)++;</span>
01272 <span class="comment">          for (j=0; j&lt;vecSize; j++) myIter.at(j)++;</span>
01273 <span class="comment">        }</span>
01274 <span class="comment">      }</span>
01275 <span class="comment">      stringIter.clear();</span>
01276 <span class="comment">      doubleIter.clear();</span>
01277 <span class="comment">      myIter.clear();</span>
01278 <span class="comment">*/</span>
01279   }
01280   <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;prob) {
01281     text=<span class="stringliteral">"EXCEPTION erasing m_strings, m_numericals or m_rowIsSelected: "</span>;
01282     text=text+prob.what();
01283     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, text);
01284     <span class="keywordflow">throw</span>;
01285   }
01286   std::ostringstream sortie;
01287   sortie &lt;&lt; <a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>-<a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a> &lt;&lt; <span class="stringliteral">" row(s) deleted"</span>;
01288   <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, sortie.str());
01289   <a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>=m_numSelRows;
01290   <span class="comment">//if (!keepCriteria) m_numSelRows=0;</span>
01291   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01292 }
01293 <span class="comment">/**********************************************************************/</span>
01294 <span class="comment">// erase all selected rows from memory</span>
<a name="l01295"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a68">01295</a> <span class="keywordtype">int</span> Catalog::eraseSelected() {
01296 
01297   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"eraseSelected"</span>;
01298   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> &lt;= 0) {
01299     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"catalog is empty"</span>);
01300     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>; 
01301   }
01302   <span class="comment">// test below avoid deleting NOTHING</span>
01303   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a> == 0) {
01304     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"no row selected, nothing done"</span>);
01305     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>; 
01306   }
01307   <span class="comment">// log if ALL is deleted</span>
01308   std::string text;
01309   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> == <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>) {
01310     text=<span class="stringliteral">"all rows selected, calling deleteContent()"</span>;
01311     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(2, text);
01312     <a class="code" href="classcatalog_access_1_1_catalog.html#a23">deleteContent</a>();
01313     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01314   }
01315   <span class="keywordflow">try</span> {
01316     <span class="keywordtype">long</span> i, tot=0,
01317          numRows=<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>-<a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>;
01318     <span class="keywordtype">int</span> j;
01319     <span class="keywordtype">int</span> sizeS=<a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>.size();
01320     <span class="keywordtype">int</span> sizeN=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>.size();
01321     <span class="keywordtype">int</span> vecSize=<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>.size();
01322     <span class="comment">// to speed-up, will not change (avoid reading size in loop)</span>
01323 
01324     std::vector&lt;std::vector&lt;double&gt; &gt; myNum;
01325     myNum.resize(sizeN);
01326     <span class="keywordflow">for</span> (j=0; j&lt;sizeN; j++) myNum[j].assign(numRows, 0.0);
01327     std::vector&lt;std::vector&lt;std::string&gt; &gt; myStr;
01328     myStr.resize(sizeS);
01329     <span class="keywordflow">for</span> (j=0; j&lt;sizeS; j++) myStr[j].assign(numRows, <span class="stringliteral">""</span>);
01330     std::vector&lt;std::vector&lt;unsigned long&gt; &gt; myBits;
01331     myBits.resize(vecSize);
01332     <span class="keywordflow">for</span> (j=0; j&lt;vecSize; j++) myBits[j].assign(numRows, 0ul);
01333     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
01334       <span class="keywordflow">if</span> (!(<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(i) &amp; 1)) {
01335         <span class="keywordflow">for</span> (j=0; j&lt;sizeN; j++) myNum[j].at(tot)=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[j].at(i);
01336         <span class="keywordflow">for</span> (j=0; j&lt;sizeS; j++) myStr[j].at(tot)=<a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>[j].at(i);
01337         <span class="keywordflow">for</span> (j=0; j&lt;vecSize; j++) myBits[j].at(tot)=<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[j].at(i);
01338         <span class="keywordflow">if</span> (++tot == numRows) <span class="keywordflow">break</span>; <span class="comment">// to speed up</span>
01339       }
01340     }
01341     <span class="keywordflow">for</span> (j=0; j&lt;sizeN; j++) {
01342       <a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[j].insert(<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[j].begin(),
01343                              myNum[j].begin(), myNum[j].end());
01344       myNum[j].clear();
01345     }
01346     myNum.clear();
01347     <span class="keywordflow">for</span> (j=0; j&lt;sizeS; j++) {
01348       <a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>[j].insert(<a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>[j].begin(),
01349                           myStr[j].begin(), myStr[j].end());
01350       myStr[j].clear();
01351     }
01352     myStr.clear();
01353     <span class="keywordflow">for</span> (j=0; j&lt;vecSize; j++)  {
01354       <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[j].insert(<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[j].begin(),
01355                                 myBits[j].begin(), myBits[j].end());
01356       myBits[j].clear();
01357     }
01358     myBits.clear();
01359 <span class="comment">/* if (!keepCriteria) {</span>
01360 <span class="comment">    for (j=0; j&lt;vecSize; j++) m_rowIsSelected[j].assign(numRows, 0);</span>
01361 <span class="comment">    vecSize=m_quantities.size();</span>
01362 <span class="comment">    for (i=0; i&lt;vecSize; i++) {</span>
01363 <span class="comment">      m_quantities.at(i).m_listValS.clear();</span>
01364 <span class="comment">      m_quantities.at(i).m_lowerCut=NO_SEL_CUT;</span>
01365 <span class="comment">      m_quantities.at(i).m_upperCut=NO_SEL_CUT;</span>
01366 <span class="comment">      m_quantities.at(i).m_listValN.clear();</span>
01367 <span class="comment">    }</span>
01368 <span class="comment">    m_selRegion=false;</span>
01369 <span class="comment">*/</span>
01370   }
01371   <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;prob) {
01372     text=<span class="stringliteral">"EXCEPTION erasing m_strings, m_numericals or m_rowIsSelected: "</span>;
01373     text=text+prob.what();
01374     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, text);
01375     <span class="keywordflow">throw</span>;
01376   }
01377   std::ostringstream sortie;
01378   sortie &lt;&lt; <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a> &lt;&lt; <span class="stringliteral">" row(s) deleted"</span>;
01379   <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, sortie.str());
01380   <a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>=<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>-m_numSelRows;
01381   m_numSelRows=0;
01382   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01383 }
01384 
01385 } <span class="comment">// namespace catalogAccess</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Wed Feb 1 14:22:19 2006 for catalogAccess by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
