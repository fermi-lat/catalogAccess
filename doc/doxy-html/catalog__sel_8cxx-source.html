<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>catalog_sel.cxx Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>catalog_sel.cxx</h1><a href="catalog__sel_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00013 <span class="preprocessor">#include "<a class="code" href="catalog_8h.html">catalog.h</a>"</span>
00014 
00015 <span class="keyword">namespace </span>catalogAccess {
00016 
00017 <span class="comment">/**********************************************************************/</span>
00018 <span class="comment">/*  METHOD for SELECTING QUANTITY (BEFORE IMPORT)                     */</span>
00019 <span class="comment">/**********************************************************************/</span>
00020 <span class="comment">// importSelected() will actually load selected quantities</span>
<a name="l00021"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a49">00021</a> <span class="keywordtype">int</span> Catalog::selectQuantity(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">bool</span> toBeLoaded) {
00022 
00023   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#c24">checkImport</a>(<span class="stringliteral">"selectQuantity"</span>, <span class="keyword">true</span>);
00024   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00025   <span class="keywordtype">int</span> num=<a class="code" href="classcatalog_access_1_1_catalog.html#c27">checkQuant_name</a>(<span class="stringliteral">"selectQuantity"</span>, name);
00026   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
00027 
00028   <span class="keywordtype">int</span> maxSize=<a class="code" href="classcatalog_access_1_1_catalog.html#o11">m_loadQuantity</a>.size();
00029   <span class="keywordflow">if</span> (quantSize != maxSize) {
00030     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"selectQuantity"</span>,
00031              <span class="stringliteral">"cannot get all initial quantities once importSelected() done"</span>);
00032     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a33">BAD_SEL_QUANT</a>;
00033   }
00034   <a class="code" href="classcatalog_access_1_1_catalog.html#o11">m_loadQuantity</a>.at(num)=toBeLoaded;
00035   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00036 }
00037 <span class="comment">/**********************************************************************/</span>
<a name="l00038"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a50">00038</a> <span class="keywordtype">int</span> Catalog::selectAllQuantities(<span class="keyword">const</span> <span class="keywordtype">bool</span> toBeLoaded) {
00039 
00040   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#c24">checkImport</a>(<span class="stringliteral">"selectAllQuantities"</span>, <span class="keyword">true</span>);
00041   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00042 
00043   <span class="comment">// beware m_loadQuantity has always the initial size</span>
00044   <span class="comment">// whereas m_quantities size can decrease</span>
00045   <span class="keywordtype">int</span> maxSize=<a class="code" href="classcatalog_access_1_1_catalog.html#o11">m_loadQuantity</a>.size();
00046   <span class="keywordflow">if</span> (quantSize != maxSize) {
00047     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"selectAllQuantities"</span>,
00048              <span class="stringliteral">"cannot get all initial quantities once importSelected() done"</span>);
00049     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a33">BAD_SEL_QUANT</a>;
00050   }
00051   <span class="keywordflow">if</span> (toBeLoaded) <span class="comment">// vectors with same size</span>
00052        <a class="code" href="classcatalog_access_1_1_catalog.html#o11">m_loadQuantity</a>.assign(maxSize, <span class="keyword">true</span>);
00053   <span class="keywordflow">else</span> <a class="code" href="classcatalog_access_1_1_catalog.html#o11">m_loadQuantity</a>.assign(maxSize, <span class="keyword">false</span>);
00054   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00055 }
00056 
00057 
00058 <span class="comment">/**********************************************************************/</span>
00059 <span class="comment">/*  METHODS for SELECTING DATA (BEFORE or AFTER IMPORT)               */</span>
00060 <span class="comment">/**********************************************************************/</span>
00061 <span class="comment">// check if given row is inside the elliptical region (private method)</span>
<a name="l00062"></a><a class="code" href="classcatalog_access_1_1_catalog.html#c3">00062</a> <span class="keywordtype">bool</span> Catalog::checkRegion(<span class="keyword">const</span> <span class="keywordtype">long</span> row, <span class="keyword">const</span> <span class="keywordtype">int</span> nRA, <span class="keyword">const</span> <span class="keywordtype">int</span> nDEC) {
00063 
00064   <span class="comment">/* for the moment, only circle</span>
00065 <span class="comment">    if angle phi=RA and t=PI/2 - DEC then:</span>
00066 <span class="comment">    OM postion is x= (sin t &lt;=&gt; cos DEC) * cos phi</span>
00067 <span class="comment">                  y= (sin t &lt;=&gt; cos DEC) * sin phi</span>
00068 <span class="comment">                  z= (cos t &lt;=&gt; sin DEC)</span>
00069 <span class="comment">   and the circular region around OA is defined by</span>
00070 <span class="comment">   its scalar product with OM &gt; cos desired_angle</span>
00071 <span class="comment">  */</span>
00072   <span class="keywordtype">double</span> myRA=<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[nRA].at(row);
00073   <span class="keywordtype">double</span> myDEC=<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[nDEC].at(row);
00074   <span class="keywordflow">if</span> (isnan(myRA))  <span class="keywordflow">return</span> !(<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[<a class="code" href="classcatalog_access_1_1_catalog.html#o27">m_indexRA</a>].m_rejectNaN);
00075   <span class="keywordflow">if</span> (isnan(myDEC)) <span class="keywordflow">return</span> !(<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[<a class="code" href="classcatalog_access_1_1_catalog.html#o28">m_indexDEC</a>].m_rejectNaN);
00076   <span class="keywordtype">double</span> obj_cosP=cos(myRA * Angle_Conv);
00077   <span class="keywordtype">double</span> obj_sinP=sin(myRA * Angle_Conv);
00078   <span class="keywordtype">double</span> obj_sinT=cos(myDEC * Angle_Conv);
00079   <span class="keywordtype">double</span> obj_cosT=sin(myDEC * Angle_Conv);
00080   <span class="keywordtype">double</span> myAngle=obj_sinT*obj_cosP*<a class="code" href="classcatalog_access_1_1_catalog.html#o29">m_selEllipse</a>.at(2)*<a class="code" href="classcatalog_access_1_1_catalog.html#o29">m_selEllipse</a>.at(0)
00081                 +obj_sinT*obj_sinP*<a class="code" href="classcatalog_access_1_1_catalog.html#o29">m_selEllipse</a>.at(2)*<a class="code" href="classcatalog_access_1_1_catalog.html#o29">m_selEllipse</a>.at(1)
00082                 +obj_cosT*<a class="code" href="classcatalog_access_1_1_catalog.html#o29">m_selEllipse</a>.at(3);
00083 <span class="comment">/*std::cout &lt;&lt; "cos(angle)*1E6 = " &lt;&lt; myAngle*1E6 &lt;&lt; " ? "</span>
00084 <span class="comment">            &lt;&lt;  m_selEllipse.at(4)*1E6 &lt;&lt; std::endl;*/</span>
00085   <span class="keywordflow">if</span> (myAngle &gt;= <a class="code" href="classcatalog_access_1_1_catalog.html#o29">m_selEllipse</a>.at(4)) <span class="keywordflow">return</span> <span class="keyword">true</span>;
00086   <span class="keywordflow">return</span> <span class="keyword">false</span>;
00087 }
00088 
00089 <span class="comment">/**********************************************************************/</span>
00090 <span class="comment">// check if value pass criteria for given quantity index (cut AND list)</span>
00091 <span class="comment">// private method called by useOnlyN, excludeN</span>
<a name="l00092"></a><a class="code" href="classcatalog_access_1_1_catalog.html#c4">00092</a> <span class="keywordtype">bool</span> Catalog::checkNUM(<span class="keyword">const</span> <span class="keywordtype">double</span> r, <span class="keyword">const</span> <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">bool</span> miss,
00093                        <span class="keyword">const</span> <span class="keywordtype">bool</span> reject, <span class="keyword">const</span> <span class="keywordtype">double</span> precis) {
00094 
00095   <span class="comment">// since we test the NaN only once at the beginning</span>
00096   <span class="comment">// this methods MUST NOT be called if no criteria is applied</span>
00097   <span class="keywordflow">if</span> (isnan(r)) <span class="keywordflow">return</span> !reject;
00098 
00099   <span class="keywordtype">double</span> myLimit;
00100   myLimit=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_lowerCut;
00101   <span class="keywordflow">if</span> (myLimit &lt; <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) {
00102     <span class="keywordflow">if</span> (r &lt; myLimit) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00103   }
00104   myLimit=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_upperCut;
00105   <span class="keywordflow">if</span> (myLimit &lt; <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) {
00106     <span class="keywordflow">if</span> (r &gt; myLimit) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00107   }
00108 
00109   <span class="keywordtype">int</span> vecSize=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_listValN.size();
00110   <span class="keywordflow">if</span> (vecSize &gt; 0) {
00111     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;vecSize; i++) {
00112       myLimit=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_listValN[i];
00113       <span class="keywordflow">if</span> (fabs(myLimit) &gt; NearZero) {
00114         <span class="keywordflow">if</span> (fabs(r/myLimit-1.0) &lt;= precis) <span class="keywordflow">return</span> !miss;
00115       }
00116       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fabs(r) &lt;= precis) <span class="keywordflow">return</span> !miss;
00117       <span class="comment">// returns TRUE for inclusion (equality found)</span>
00118       <span class="comment">// returns FALSE for exclusion (difference found)</span>
00119     }
00120     <span class="keywordflow">return</span> miss;
00121     <span class="comment">// not in list: returns FALSE for inclusion, TRUE for exclusion</span>
00122   }
00123 
00124   <span class="comment">// empty list (interval exist): within interval</span>
00125   <span class="keywordflow">return</span> <span class="keyword">true</span>;
00126 }
00127 
00128 <span class="comment">/**********************************************************************/</span>
00129 <span class="comment">// check if value pass criteria for given quantity index (cut OR list)</span>
00130 <span class="comment">// private method called by includeN</span>
<a name="l00131"></a><a class="code" href="classcatalog_access_1_1_catalog.html#c5">00131</a> <span class="keywordtype">bool</span> Catalog::checkNUMor(<span class="keyword">const</span> <span class="keywordtype">double</span> r, <span class="keyword">const</span> <span class="keywordtype">int</span> index,
00132                          <span class="keyword">const</span> <span class="keywordtype">bool</span> reject, <span class="keyword">const</span> <span class="keywordtype">double</span> precis) {
00133 
00134   <span class="comment">// since we test the NaN only once at the beginning</span>
00135   <span class="comment">// this methods MUST NOT be called if no criteria is applied</span>
00136   <span class="keywordflow">if</span> (isnan(r)) <span class="keywordflow">return</span> !reject;
00137 
00138   <span class="keywordtype">bool</span> check=<span class="keyword">true</span>;
00139   <span class="keywordtype">double</span> myLimit;
00140   <span class="keywordtype">int</span> vecSize=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_listValN.size();
00141   <span class="keywordflow">if</span> (vecSize &gt; 0) {
00142     <span class="keywordtype">int</span> i;
00143     check=<span class="keyword">false</span>;
00144     <span class="keywordflow">for</span> (i=0; i&lt;vecSize; i++) {
00145       myLimit=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_listValN[i];
00146       <span class="keywordflow">if</span> (fabs(myLimit) &gt; NearZero) {
00147         <span class="keywordflow">if</span> (fabs(r/myLimit-1.0) &lt;= precis) <span class="keywordflow">return</span> <span class="keyword">true</span>;
00148       }
00149       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fabs(r) &lt;= precis) <span class="keywordflow">return</span> <span class="keyword">true</span>;
00150       <span class="comment">// returns TRUE for inclusion (equality found)</span>
00151       <span class="comment">// needn't check for upper/lower cut (OR condition)</span>
00152     }
00153   }
00154 
00155   myLimit=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_lowerCut;
00156   <span class="keywordflow">if</span> (myLimit &lt; <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) {
00157     check=<span class="keyword">true</span>; <span class="comment">// used with list</span>
00158     <span class="keywordflow">if</span> (r &lt; myLimit) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00159   }
00160 
00161   myLimit=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_upperCut;
00162   <span class="keywordflow">if</span> (myLimit &lt; <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) {
00163     check=<span class="keyword">true</span>; <span class="comment">// used with list</span>
00164     <span class="keywordflow">if</span> (r &gt; myLimit) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00165   }
00166 
00167   <span class="comment">// empty list  + within interval = TRUE</span>
00168   <span class="comment">// not in list + within interval = TRUE</span>
00169   <span class="comment">// not in list +   no  interval = FALSE</span>
00170   <span class="keywordflow">return</span> check;
00171 
00172 }
00173 
00174 <span class="comment">/**********************************************************************/</span>
00175 <span class="comment">// compute the global bit selection at existing row,</span>
00176 <span class="comment">// suppose that m_rowIsSelected is correctly set (private method)</span>
<a name="l00177"></a><a class="code" href="classcatalog_access_1_1_catalog.html#c6">00177</a> <span class="keywordtype">bool</span> Catalog::rowSelect(<span class="keyword">const</span> <span class="keywordtype">long</span> row, <span class="keyword">const</span> std::vector&lt;bool&gt; &amp;quantSel) {
00178 
00179   <span class="keywordtype">int</span>  numBit=<span class="keyword">sizeof</span>(long)*8,
00180        vecSize=quantSel.size();
00181   <span class="keywordtype">bool</span> check=<span class="keyword">true</span>;
00182   <span class="keywordflow">if</span> (m_criteriaORed) check=<span class="keyword">false</span>;
00183   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> currSel, test=2ul; <span class="comment">// bit0 reserved for check</span>
00184 <span class="preprocessor">  #ifdef DEBUG_CAT</span>
00185 <span class="preprocessor"></span>  std::cout &lt;&lt; <a class="code" href="classcatalog_access_1_1_catalog.html#o18">m_criteriaORed</a> &lt;&lt; <span class="stringliteral">"quantSize = "</span> &lt;&lt; vecSize;
00186 <span class="preprocessor">  #endif</span>
00187 <span class="preprocessor"></span>  <span class="keywordtype">int</span> j=0;
00188   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;=vecSize; ) {
00189 
00190     currSel=<a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[j].at(row);
00191     <span class="keywordflow">if</span> (quantSel[i-1]) {
00192 <span class="preprocessor">      #ifdef DEBUG_CAT</span>
00193 <span class="preprocessor"></span>      std::cout &lt;&lt; <span class="stringliteral">" (AND with "</span> &lt;&lt; currSel &lt;&lt;<span class="stringliteral">" &amp; "</span>&lt;&lt; test
00194                 &lt;&lt; <span class="stringliteral">", pos["</span> &lt;&lt; j &lt;&lt;<span class="stringliteral">"] )"</span> &lt;&lt; std::endl;
00195 <span class="preprocessor">      #endif</span>
00196 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (m_criteriaORed) {
00197         <span class="comment">// OR  of bits, true --&gt; useless to continue</span>
00198         <span class="keywordflow">if</span> ((currSel &amp; test) == test) {check=<span class="keyword">true</span>; <span class="keywordflow">break</span>;}
00199       }
00200       <span class="keywordflow">else</span> {
00201         <span class="comment">// AND of bits, false--&gt; useless to continue</span>
00202         <span class="keywordflow">if</span> ((currSel &amp; test) == 0ul) {check=<span class="keyword">false</span>; <span class="keywordflow">break</span>;}
00203       }
00204     }
00205     <span class="keywordflow">if</span> ((++i % numBit) == 0) {
00206       test=1ul; <span class="comment">// first bit</span>
00207       j++;      <span class="comment">// of next vector index.</span>
00208     }
00209     <span class="keywordflow">else</span> test*=2ul;
00210 
00211   }
00212   <span class="keywordflow">if</span> (check) <span class="comment">// setting bit0 to 1</span>
00213     <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[0].at(row)|= 1ul;
00214   <span class="keywordflow">else</span>       <span class="comment">// setting bit0 to 0</span>
00215     <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[0].at(row)&amp;= (Max_Test-1ul);
00216 
00217   <span class="keywordflow">return</span> check;
00218 }
00219 
00220 
00221 <span class="comment">/**********************************************************************/</span>
00222 <span class="comment">// unset cut on quantity found by its existing index (private method)</span>
<a name="l00223"></a><a class="code" href="classcatalog_access_1_1_catalog.html#c7">00223</a> <span class="keywordtype">void</span> Catalog::unsetCuts(<span class="keyword">const</span> <span class="keywordtype">int</span> index) {
00224 
00225   <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_listValS.clear();
00226   <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_lowerCut=<a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>;
00227   <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_upperCut=<a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>;
00228   <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_listValN.clear();
00229   <span class="comment">/* if no data: exit */</span>
00230   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a> == 0) <span class="keywordflow">return</span>;
00231 
00232   <span class="comment">// now, must check criteria on region and other quantities</span>
00233   <span class="keywordtype">int</span> k;
00234   std::vector&lt;bool&gt; isSelected;
00235   <span class="keywordtype">bool</span> oneCriteria=<a class="code" href="classcatalog_access_1_1_catalog.html#c2">existCriteria</a>(&amp;isSelected);
00236   <span class="keywordflow">if</span> (oneCriteria) {
00237 
00238     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> test=<a class="code" href="classcatalog_access_1_1_catalog.html#c29">bitPosition</a>(index, &amp;k);
00239     <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
00240     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>; i++) {
00241       <span class="comment">// setting required bit to 0</span>
00242       <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00243       <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#c6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>++;
00244     }<span class="comment">// loop on rows</span>
00245 
00246   }
00247   <span class="keywordflow">else</span> {
00248     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a> &gt; 0) {
00249       <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>.size(); <span class="comment">// to avoid compiler Warning</span>
00250       <span class="keywordflow">for</span> (k=0; k&lt;quantSize; k++)
00251         <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>, 0);
00252     }
00253     <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
00254     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, <span class="stringliteral">"All rows unselected"</span>);
00255   }
00256 
00257 }
00258 <span class="comment">/**********************************************************************/</span>
00259 <span class="comment">// unset all selection criteria relating to quantity "name"</span>
<a name="l00260"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a51">00260</a> <span class="keywordtype">int</span> Catalog::unsetCuts(<span class="keyword">const</span> std::string name) {
00261 
00262   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#c24">checkImport</a>(<span class="stringliteral">"unsetCuts"</span>, <span class="keyword">true</span>);
00263   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00264   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#c27">checkQuant_name</a>(<span class="stringliteral">"unsetCuts"</span>, name);
00265   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
00266 
00267   <a class="code" href="classcatalog_access_1_1_catalog.html#a52">unsetCuts</a>(index);
00268   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00269 }
00270 
00271 <span class="comment">/**********************************************************************/</span>
00272 <span class="comment">// unset all cuts on all quantities except the selection ellipse;</span>
00273 <span class="comment">// this also deletes the selection string</span>
<a name="l00274"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a52">00274</a> <span class="keywordtype">int</span> Catalog::unsetCuts() {
00275 
00276   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#c24">checkImport</a>(<span class="stringliteral">"unsetCuts"</span>, <span class="keyword">true</span>);
00277   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00278   <span class="keywordtype">int</span> j;
00279   <span class="comment">/*for (j=0; j&lt;quantSize; j++) unsetCuts(m_quantities.at(j).m_name);*/</span>
00280   <span class="comment">//quicker to just check for selection ellipse</span>
00281   <span class="keywordflow">for</span> (j=0; j&lt;quantSize; j++) {
00282     <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(j).m_listValS.clear();
00283     <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(j).m_lowerCut=<a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>;
00284     <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(j).m_upperCut=<a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>;
00285     <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(j).m_listValN.clear();
00286   }
00287   <a class="code" href="classcatalog_access_1_1_catalog.html#o17">m_selection</a>=<span class="stringliteral">""</span>;
00288   <span class="comment">/* if no data: exit */</span>
00289   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00290 
00291   <span class="comment">// now, must check criteria on region</span>
00292   quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>.size();
00293   <span class="keywordflow">if</span> (m_selRegion) {
00294 
00295     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> currSel;
00296     <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
00297     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>; i++) {
00298       currSel=<a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[0].at(i);
00299       <span class="keywordflow">if</span> (currSel &amp; 2ul) {
00300         <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[0].at(i)=3ul;
00301         <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>++;
00302       }
00303       <span class="keywordflow">else</span> <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[0].at(i)=0ul;
00304       <span class="comment">// setting all bits to 0 except first two</span>
00305       <span class="keywordflow">for</span> (j=1; j&lt;quantSize; j++) <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[j].at(i)=0ul;
00306     }<span class="comment">// loop on rows</span>
00307 
00308   }
00309   <span class="keywordflow">else</span> {
00310     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a> &gt; 0)
00311       <span class="keywordflow">for</span> (j=0; j&lt;quantSize; j++) <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[j].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>, 0);
00312     <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
00313     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, <span class="stringliteral">"All rows unselected"</span>);
00314   }
00315   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00316 }
00317 
00318 <span class="comment">/**********************************************************************/</span>
00319 <span class="comment">// if true, criteria between quantities are ORed instead of ANDed</span>
<a name="l00320"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a53">00320</a> <span class="keywordtype">int</span> Catalog::setCriteriaORed(<span class="keyword">const</span> <span class="keywordtype">bool</span> bitOR) {
00321 
00322   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"setCriteriaORed"</span>;
00323   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#c24">checkImport</a>(origin, <span class="keyword">true</span>);
00324   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00325 
00326   <span class="comment">// if boolean is the same: do nothing</span>
00327   <span class="keywordflow">if</span> (bitOR == <a class="code" href="classcatalog_access_1_1_catalog.html#o18">m_criteriaORed</a>) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00328   <a class="code" href="classcatalog_access_1_1_catalog.html#o18">m_criteriaORed</a>=bitOR;
00329 
00330   <span class="comment">/* if no data: exit */</span>
00331   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00332   <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
00333   std::vector&lt;bool&gt; isSelected;
00334   <span class="keywordflow">if</span> ( <a class="code" href="classcatalog_access_1_1_catalog.html#c2">existCriteria</a>(&amp;isSelected) ) {
00335     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>; i++) {
00336       <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#c6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>++;
00337     }
00338   }
00339   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00340 }
00341       
00342 
00343 <span class="comment">/**********************************************************************/</span>
00344 <span class="comment">// set and apply an elliptical selection region</span>
<a name="l00345"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a54">00345</a> <span class="keywordtype">int</span> Catalog::setSelEllipse(<span class="keyword">const</span> <span class="keywordtype">double</span> centRA_deg, <span class="keyword">const</span> <span class="keywordtype">double</span> centDEC_deg,
00346                            <span class="keyword">const</span> <span class="keywordtype">double</span> majAxis_deg, <span class="keyword">const</span> <span class="keywordtype">double</span> minAxis_deg,
00347                            <span class="keyword">const</span> <span class="keywordtype">double</span> rot_deg) {
00348 
00349   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"setSelEllipse"</span>;
00350   std::string text;
00351   std::ostringstream sortie;
00352 
00353   <span class="comment">// first check that selection is possible</span>
00354   <span class="keywordtype">int</span> numPb=<a class="code" href="classcatalog_access_1_1_catalog.html#c24">checkImport</a>(origin, <span class="keyword">true</span>);
00355   <span class="keywordflow">if</span> (numPb &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> numPb;
00356   <span class="keywordflow">if</span> ((<a class="code" href="classcatalog_access_1_1_catalog.html#o27">m_indexRA</a> &lt; 0) || (<a class="code" href="classcatalog_access_1_1_catalog.html#o28">m_indexDEC</a> &lt; 0)) {
00357     text=<span class="stringliteral">"missing generic position quantities (RA and DEC)"</span>; 
00358     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, text);
00359     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a23">NO_RA_DEC</a>;
00360   }
00361   numPb=0;
00362   <span class="comment">//const std::_Ios_Fmtflags outDouble=std::ios::right | std::ios::scientific;</span>
00363   <span class="keywordflow">if</span> ((centRA_deg &lt; 0.) || (centRA_deg &gt;= 360.)) numPb=<a class="code" href="namespacecatalog_access.html#a37a28">BAD_RA</a>;
00364   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((centDEC_deg &lt; -90.) || (centDEC_deg &gt; 90.)) numPb=<a class="code" href="namespacecatalog_access.html#a37a29">BAD_DEC</a>;
00365   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((rot_deg &lt; 0.) || (rot_deg &gt;= 180.)) numPb=<a class="code" href="namespacecatalog_access.html#a37a30">BAD_ROT</a>;
00366   <span class="keywordflow">if</span> (numPb &lt; 0) {
00367     text=<span class="stringliteral">"bad ellipse position (impossible RA, DEC or rotation)"</span>; 
00368     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, text);
00369     <span class="keywordflow">return</span> numPb;
00370   }
00371   <span class="keywordflow">if</span> ((majAxis_deg &lt; Min_Axis) || (majAxis_deg &gt; 90.)) numPb=<a class="code" href="namespacecatalog_access.html#a37a31">BAD_AXIS</a>;
00372   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((minAxis_deg &lt; Min_Axis) || (minAxis_deg &gt; 90.)) numPb=<a class="code" href="namespacecatalog_access.html#a37a31">BAD_AXIS</a>;
00373   <span class="comment">// size limited to one hemisphere</span>
00374   <span class="keywordflow">if</span> (numPb &lt; 0) {
00375     sortie &lt;&lt; <span class="stringliteral">"bad ellipse size, radius from "</span> &lt;&lt; std::setprecision(2)
00376            &lt;&lt; Min_Axis*1000 &lt;&lt; <span class="stringliteral">"E-3 to 90 (in RA or DEC)"</span>;
00377     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, sortie.str());
00378     <span class="keywordflow">return</span> numPb;
00379   }
00380   <span class="keywordflow">if</span> (rot_deg &gt; 0.)
00381     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"whatever orientation, using 0"</span>); 
00382   <span class="keywordflow">if</span> (fabs(majAxis_deg/minAxis_deg - 1.) &gt; 10*Min_Prec)
00383     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"axis sizes differ, taking only major axis"</span>);
00384   <a class="code" href="classcatalog_access_1_1_catalog.html#o19">m_selRegion</a>=<span class="keyword">true</span>;
00385   <a class="code" href="classcatalog_access_1_1_catalog.html#o20">m_selEllipseCentRA_deg</a>=centRA_deg;
00386   <a class="code" href="classcatalog_access_1_1_catalog.html#o21">m_selEllipseCentDEC_deg</a>=centDEC_deg;
00387   <a class="code" href="classcatalog_access_1_1_catalog.html#o23">m_selEllipseMajAxis_deg</a>=majAxis_deg;
00388   <a class="code" href="classcatalog_access_1_1_catalog.html#o22">m_selEllipseMinAxis_deg</a>=majAxis_deg; <span class="comment">//minAxis_deg;</span>
00389   <a class="code" href="classcatalog_access_1_1_catalog.html#o24">m_selEllipseRot_deg</a>=0.; <span class="comment">//rot_deg;</span>
00390   <span class="comment">// angles are phi=RA and theta=PI/2-DEC</span>
00391   <a class="code" href="classcatalog_access_1_1_catalog.html#o29">m_selEllipse</a>.at(0)=cos(<a class="code" href="classcatalog_access_1_1_catalog.html#o20">m_selEllipseCentRA_deg</a> * Angle_Conv);
00392   <a class="code" href="classcatalog_access_1_1_catalog.html#o29">m_selEllipse</a>.at(1)=sin(<a class="code" href="classcatalog_access_1_1_catalog.html#o20">m_selEllipseCentRA_deg</a> * Angle_Conv);
00393   <a class="code" href="classcatalog_access_1_1_catalog.html#o29">m_selEllipse</a>.at(2)=cos(<a class="code" href="classcatalog_access_1_1_catalog.html#o21">m_selEllipseCentDEC_deg</a>* Angle_Conv);
00394   <a class="code" href="classcatalog_access_1_1_catalog.html#o29">m_selEllipse</a>.at(3)=sin(<a class="code" href="classcatalog_access_1_1_catalog.html#o21">m_selEllipseCentDEC_deg</a>* Angle_Conv);
00395   <a class="code" href="classcatalog_access_1_1_catalog.html#o29">m_selEllipse</a>.at(4)=cos(majAxis_deg * Angle_Conv);
00396 
00397   sortie &lt;&lt; <span class="stringliteral">"selection ellipse center RA="</span> &lt;&lt; std::setprecision(4)
00398          &lt;&lt; <a class="code" href="classcatalog_access_1_1_catalog.html#o20">m_selEllipseCentRA_deg</a> &lt;&lt; <span class="stringliteral">" , DEC="</span>
00399          &lt;&lt; <a class="code" href="classcatalog_access_1_1_catalog.html#o21">m_selEllipseCentDEC_deg</a> &lt;&lt; <span class="stringliteral">" with radius "</span>
00400          &lt;&lt; <a class="code" href="classcatalog_access_1_1_catalog.html#o23">m_selEllipseMajAxis_deg</a> &lt;&lt; <span class="stringliteral">" * "</span>
00401          &lt;&lt; <a class="code" href="classcatalog_access_1_1_catalog.html#o22">m_selEllipseMinAxis_deg</a> &lt;&lt; <span class="stringliteral">" (degrees) orientated at "</span>
00402          &lt;&lt; <a class="code" href="classcatalog_access_1_1_catalog.html#o24">m_selEllipseRot_deg</a> &lt;&lt; <span class="stringliteral">" (with respect to North pole)"</span>;
00403   <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, sortie.str());
00404   <span class="comment">/* if no data: exit */</span>
00405   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00406 
00407   <span class="comment">// now, apply the selection ellipse</span>
00408   std::vector&lt;bool&gt; isSelected;
00409   <a class="code" href="classcatalog_access_1_1_catalog.html#c2">existCriteria</a>(&amp;isSelected); <span class="comment">// returns true (m_selRegion is true)</span>
00410   <span class="keywordtype">bool</span> check;
00411   <span class="keywordtype">int</span> nRA =<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[<a class="code" href="classcatalog_access_1_1_catalog.html#o27">m_indexRA</a>].m_index,
00412       nDEC=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[<a class="code" href="classcatalog_access_1_1_catalog.html#o28">m_indexDEC</a>].m_index;
00413   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> currSel;
00414   <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
00415   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>; i++) {
00416 
00417     check=<a class="code" href="classcatalog_access_1_1_catalog.html#c3">checkRegion</a>(i, nRA, nDEC);
00418     currSel=<a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[0].at(i);
00419     <span class="keywordflow">if</span> (check) <span class="comment">// setting 2nd bit to 1</span>
00420       <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[0].at(i)=currSel | 2ul;
00421     <span class="keywordflow">else</span>       <span class="comment">// setting 2nd bit to 0</span>
00422       <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[0].at(i)=currSel &amp; (Max_Test-2ul);
00423     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#c6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>++;
00424 
00425   }<span class="comment">// loop on all rows</span>
00426   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00427 }
00428 <span class="comment">/**********************************************************************/</span>
00429 <span class="comment">// remove the effects of the ellipse selection</span>
<a name="l00430"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a55">00430</a> <span class="keywordtype">int</span> Catalog::unsetSelEllipse() {
00431 
00432   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#c24">checkImport</a>(<span class="stringliteral">"unsetSelEllipse"</span>, <span class="keyword">true</span>);
00433   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00434 
00435   <span class="comment">// if region was already unset: do nothing</span>
00436   <span class="keywordflow">if</span> (!<a class="code" href="classcatalog_access_1_1_catalog.html#o19">m_selRegion</a>) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00437   <a class="code" href="classcatalog_access_1_1_catalog.html#o19">m_selRegion</a>=<span class="keyword">false</span>;
00438   <span class="comment">/* if no data: exit */</span>
00439   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00440 
00441   <span class="comment">// now, must check criteria on other quantities</span>
00442   std::vector&lt;bool&gt; isSelected;
00443   <span class="keywordtype">bool</span> oneCriteria=<a class="code" href="classcatalog_access_1_1_catalog.html#c2">existCriteria</a>(&amp;isSelected);
00444   <span class="keywordflow">if</span> (oneCriteria) {
00445     <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
00446     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>; i++) {
00447 
00448       <span class="comment">// setting 2nd bit to 0</span>
00449       <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[0].at(i)&amp;= (Max_Test-2ul);
00450       <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#c6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>++;
00451  
00452     }<span class="comment">// loop on rows</span>
00453   }
00454   <span class="keywordflow">else</span> {
00455     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a> &gt; 0) {
00456       quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>.size();
00457       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;quantSize; j++) <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[j].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>, 0);
00458     }
00459     <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
00460     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, <span class="stringliteral">"All rows unselected"</span>);
00461   }
00462   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00463 }
00464 
00465 
00466 <span class="comment">/**********************************************************************/</span>
00467 <span class="comment">// set and apply a cut on given quantity such that all values &gt;= cutVal pass</span>
00468 <span class="comment">// double is not const because it can be locally modified to NO_SEL_CUT</span>
<a name="l00469"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a56">00469</a> <span class="keywordtype">int</span> Catalog::setLowerCut(<span class="keyword">const</span> std::string name, <span class="keywordtype">double</span> cutVal) {
00470 
00471   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"setLowerCut"</span>;
00472   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#c24">checkImport</a>(origin, <span class="keyword">true</span>);
00473   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00474 
00475   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#c27">checkQuant_name</a>(origin, name);
00476   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
00477   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_type != Quantity::NUM) {  
00478     std::string errText;
00479     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00480     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
00481     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00482   }
00483 
00484   <span class="comment">// if cut is the same: do nothing</span>
00485   <span class="keywordflow">if</span> (cutVal &gt;= <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) cutVal=<a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>;
00486   <span class="keywordflow">if</span> (cutVal == <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_lowerCut) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00487   <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_lowerCut=cutVal;
00488 
00489   <span class="comment">/* if no data: exit */</span>
00490   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00491 
00492   std::vector&lt;bool&gt; isSelected;
00493   <span class="keywordtype">bool</span> oneCriteria=<a class="code" href="classcatalog_access_1_1_catalog.html#c2">existCriteria</a>(&amp;isSelected);
00494   <span class="keywordtype">bool</span> check=<span class="keyword">true</span>;
00495   <span class="keywordflow">if</span> (cutVal &gt;= <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) {
00496     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, <span class="stringliteral">"Disabling lower cut (on "</span>+name+<span class="stringliteral">")"</span>);
00497     <span class="keywordflow">if</span> (!oneCriteria) {
00498       <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a> &gt; 0) {
00499         quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>.size();
00500         <span class="keywordflow">for</span> (index=0; index&lt;quantSize; index++)
00501           <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[index].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>, 0);
00502       }
00503       <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
00504       check=<span class="keyword">false</span>;
00505       <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, <span class="stringliteral">"All rows unselected"</span>);
00506     }
00507   }
00508   <span class="keywordflow">else</span> {
00509     std::ostringstream sortie;
00510     sortie &lt;&lt; <span class="stringliteral">"Enabling lower cut ("</span> &lt;&lt;cutVal&lt;&lt;<span class="stringliteral">" on "</span>&lt;&lt;name&lt;&lt; <span class="stringliteral">")"</span>;
00511     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, sortie.str());  
00512   }
00513   
00514   <span class="keywordflow">if</span> (check) {
00515     <span class="keywordtype">bool</span> reject=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_rejectNaN,
00516          cutOR=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_cutORed,
00517          miss=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_excludeList;
00518     <span class="keywordtype">double</span> precis=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_precision;
00519     <span class="keywordtype">int</span>  k,
00520          pos=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_index;
00521     <span class="keywordtype">long</span> i;
00522     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> test=<a class="code" href="classcatalog_access_1_1_catalog.html#c29">bitPosition</a>(index, &amp;k);
00523     <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
00524     <span class="comment">// true if given quantity is selected (list or lower/upper cut)</span>
00525     oneCriteria=isSelected.at(index+1);
00526     <span class="keywordflow">if</span> (oneCriteria) {
00527 
00528       <span class="comment">// due to NaN test, call checkNUM only if selection exists</span>
00529       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>; i++) {
00530         <span class="keywordflow">if</span> (!cutOR) <span class="comment">// usual case</span>
00531           check=<a class="code" href="classcatalog_access_1_1_catalog.html#c4">checkNUM</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[pos].at(i), index, miss, reject, precis);
00532         <span class="keywordflow">else</span>
00533           check=<a class="code" href="classcatalog_access_1_1_catalog.html#c5">checkNUMor</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[pos].at(i), index, reject, precis);
00534         <span class="comment">// setting required bit</span>
00535         <span class="keywordflow">if</span> (check)
00536           <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)|= test;
00537         <span class="keywordflow">else</span>
00538           <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00539         <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#c6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>++;
00540       }<span class="comment">// loop on rows</span>
00541 
00542     }
00543     <span class="keywordflow">else</span> {
00544 
00545       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>; i++) {
00546         <span class="comment">// required bit set to FALSE</span>
00547         <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00548         <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#c6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>++;
00549       }<span class="comment">// loop on rows</span>
00550 
00551     }
00552   }
00553   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00554 }
00555 <span class="comment">/**********************************************************************/</span>
00556 <span class="comment">// set and apply a cut on given quantity such that all values &lt;= cutVal pass</span>
00557 <span class="comment">// double is not const because it can be locally modified to NO_SEL_CUT</span>
<a name="l00558"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a57">00558</a> <span class="keywordtype">int</span> Catalog::setUpperCut(<span class="keyword">const</span> std::string name, <span class="keywordtype">double</span> cutVal) {
00559 
00560   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"setUpperCut"</span>;
00561   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#c24">checkImport</a>(origin, <span class="keyword">true</span>);
00562   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00563 
00564   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#c27">checkQuant_name</a>(origin, name);
00565   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
00566   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_type != Quantity::NUM) {  
00567     std::string errText;
00568     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00569     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
00570     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00571   }
00572   <span class="comment">// if cut is the same: do nothing</span>
00573   <span class="keywordflow">if</span> (cutVal &gt;= <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) cutVal=<a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>;
00574   <span class="keywordflow">if</span> (cutVal == <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_upperCut) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00575   <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_upperCut=cutVal;
00576 
00577   <span class="comment">/* if no data: exit */</span>
00578   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00579 
00580   std::vector&lt;bool&gt; isSelected;
00581   <span class="keywordtype">bool</span> oneCriteria=<a class="code" href="classcatalog_access_1_1_catalog.html#c2">existCriteria</a>(&amp;isSelected);
00582   <span class="keywordtype">bool</span> check=<span class="keyword">true</span>;
00583   <span class="keywordflow">if</span> (cutVal &gt;= <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) {
00584     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, <span class="stringliteral">"Disabling upper cut (on "</span>+name+<span class="stringliteral">")"</span>);
00585     <span class="keywordflow">if</span> (!oneCriteria) {
00586       <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a> &gt; 0) {
00587         quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>.size();
00588         <span class="keywordflow">for</span> (index=0; index&lt;quantSize; index++)
00589           <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[index].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>, 0);
00590       }
00591       <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
00592       check=<span class="keyword">false</span>;
00593       <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, <span class="stringliteral">"All rows unselected"</span>);
00594     }
00595   }
00596   <span class="keywordflow">else</span> {
00597     std::ostringstream sortie;
00598     sortie &lt;&lt; <span class="stringliteral">"Enabling upper cut ("</span> &lt;&lt;cutVal&lt;&lt;<span class="stringliteral">" on "</span>&lt;&lt;name&lt;&lt; <span class="stringliteral">")"</span>;
00599     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, sortie.str());  
00600   }
00601   
00602   <span class="keywordflow">if</span> (check) {
00603     <span class="keywordtype">bool</span> reject=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_rejectNaN,
00604          cutOR=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_cutORed,
00605          miss=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_excludeList;
00606     <span class="keywordtype">double</span> precis=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_precision;
00607     <span class="keywordtype">int</span>  k,
00608          pos=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_index;
00609     <span class="keywordtype">long</span> i;
00610     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> test=<a class="code" href="classcatalog_access_1_1_catalog.html#c29">bitPosition</a>(index, &amp;k);
00611     <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
00612     <span class="comment">// true if given quantity is selected (list or lower/upper cut)</span>
00613     oneCriteria=isSelected.at(index+1);
00614     <span class="keywordflow">if</span> (oneCriteria) {
00615 
00616       <span class="comment">// due to NaN test, call checkNUM only if selection exists</span>
00617       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>; i++) {
00618         <span class="keywordflow">if</span> (!cutOR) <span class="comment">// usual case</span>
00619           check=<a class="code" href="classcatalog_access_1_1_catalog.html#c4">checkNUM</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[pos].at(i), index, miss, reject, precis);
00620         <span class="keywordflow">else</span>
00621           check=<a class="code" href="classcatalog_access_1_1_catalog.html#c5">checkNUMor</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[pos].at(i), index, reject, precis);
00622         <span class="comment">// setting required bit</span>
00623         <span class="keywordflow">if</span> (check)
00624           <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)|= test;
00625         <span class="keywordflow">else</span>
00626           <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00627         <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#c6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>++;
00628       }<span class="comment">// loop on rows</span>
00629 
00630     }
00631     <span class="keywordflow">else</span> {
00632 
00633       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>; i++) {
00634         <span class="comment">// required bit set to FALSE</span>
00635         <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00636         <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#c6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>++;
00637       }<span class="comment">// loop on rows</span>
00638 
00639     }
00640   }
00641   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00642 }
00643 
00644 <span class="comment">/**********************************************************************/</span>
00645 <span class="comment">// set and apply a cut on quantities in VECTOR type quantity "name"</span>
00646 <span class="comment">// such that all values &gt;= cutValues[i] pass</span>
00647  
00648 <span class="comment">/**********************************************************************/</span>
00649 <span class="comment">// set and apply a cut on quantities in VECTOR type quantity "name"</span>
00650 <span class="comment">// such that all values &lt;= cutValues[i] pass</span>
00651  
00652 
00653 <span class="comment">/**********************************************************************/</span>
00654 <span class="comment">// select rows depending on the given numerical list for existing index</span>
<a name="l00655"></a><a class="code" href="classcatalog_access_1_1_catalog.html#c9">00655</a> <span class="keywordtype">int</span> Catalog::doSelN(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">int</span> code,
00656                     <span class="keyword">const</span> std::vector&lt;double&gt; &amp;listVal) {
00657 
00658   std::ostringstream sortie;
00659   <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_cutORed=<span class="keyword">false</span>;
00660   <span class="keywordtype">bool</span> miss;
00661   <span class="comment">// take only first 7 char to match possible generic functions</span>
00662   <span class="keywordflow">if</span> (code &amp; 1) {
00663     <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_excludeList=<span class="keyword">false</span>;
00664     miss=<span class="keyword">false</span>;
00665     sortie &lt;&lt; <span class="stringliteral">"Include rows"</span>;
00666   }
00667   <span class="keywordflow">else</span> {
00668     <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_excludeList=<span class="keyword">true</span>;
00669     miss=<span class="keyword">true</span>;
00670     sortie &lt;&lt; <span class="stringliteral">"Exclude rows"</span>;
00671   }
00672   <span class="keywordtype">int</span> listSize=listVal.size();
00673   <span class="comment">/* if empty list as before: exit */</span>
00674   <span class="keywordflow">if</span> (listSize == 0) {
00675     <span class="comment">// if NO list, m_cutORed has no effect (false method quicker)</span>
00676     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_listValN.size() == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00677   }
00678   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (code &gt; 1)
00679     <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_cutORed=<span class="keyword">true</span>;
00680 
00681   <span class="keywordtype">int</span> j;
00682   <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_listValN.clear();
00683   <span class="keywordflow">for</span> (j=0; j&lt;listSize; j++)
00684      <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_listValN.push_back(listVal.at(j));
00685 
00686   <span class="comment">/* if no data: exit */</span>
00687   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00688 
00689   std::vector&lt;bool&gt; isSelected;
00690   <span class="keywordtype">bool</span> oneCriteria=<a class="code" href="classcatalog_access_1_1_catalog.html#c2">existCriteria</a>(&amp;isSelected);
00691   <span class="keywordtype">bool</span> check=<span class="keyword">true</span>;
00692   <span class="keywordflow">if</span> (listSize == 0) {
00693     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, <span class="stringliteral">"Disabling list selection (on "</span>+name+<span class="stringliteral">")"</span>);
00694     <span class="keywordflow">if</span> (!oneCriteria) {
00695       <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a> &gt; 0) {
00696         listSize=<a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>.size(); <span class="comment">// to avoid compiler Warning</span>
00697         <span class="keywordflow">for</span> (j=0; j&lt;listSize; j++)
00698           <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[j].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>, 0);
00699       }
00700       <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
00701       check=<span class="keyword">false</span>;
00702       <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, <span class="stringliteral">"All rows unselected"</span>);
00703     }
00704   }
00705   <span class="keywordflow">else</span> {
00706     sortie &lt;&lt; <span class="stringliteral">" with \""</span> &lt;&lt; name &lt;&lt;<span class="stringliteral">"\" around value in list ("</span>
00707            &lt;&lt; listSize &lt;&lt; <span class="stringliteral">" elements, "</span>;
00708     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_cutORed)
00709       sortie &lt;&lt; <span class="stringliteral">"ORed with cut)"</span>;
00710     <span class="keywordflow">else</span>
00711       sortie &lt;&lt; <span class="stringliteral">"ANDed with cut)"</span>;
00712     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, sortie.str());
00713   }
00714   
00715   <span class="keywordflow">if</span> (check) {
00716     <span class="keywordtype">bool</span> reject=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_rejectNaN,
00717          cutOR=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_cutORed;
00718     <span class="keywordtype">double</span> precis=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_precision;
00719     <span class="keywordtype">int</span>  k,
00720          pos=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_index;
00721     <span class="keywordtype">long</span> i;
00722     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> test=<a class="code" href="classcatalog_access_1_1_catalog.html#c29">bitPosition</a>(index, &amp;k);
00723     <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
00724     <span class="comment">// true if given quantity is selected (list or lower/upper cut)</span>
00725     oneCriteria=isSelected.at(index+1);
00726     <span class="keywordflow">if</span> (oneCriteria) {
00727 
00728       <span class="comment">// due to NaN test, call checkNUM only if selection exists</span>
00729       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>; i++) {
00730         <span class="keywordflow">if</span> (!cutOR) <span class="comment">// usual case</span>
00731           check=<a class="code" href="classcatalog_access_1_1_catalog.html#c4">checkNUM</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[pos].at(i), index, miss, reject, precis);
00732         <span class="keywordflow">else</span>
00733           check=<a class="code" href="classcatalog_access_1_1_catalog.html#c5">checkNUMor</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[pos].at(i), index, reject, precis);
00734         <span class="comment">// setting required bit</span>
00735         <span class="keywordflow">if</span> (check)
00736           <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)|= test;
00737         <span class="keywordflow">else</span>
00738           <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00739         <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#c6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>++;
00740       }<span class="comment">// loop on rows</span>
00741 
00742     }
00743     <span class="keywordflow">else</span> {
00744 
00745       <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>; i++) {
00746         <span class="comment">// required bit set to FALSE</span>
00747         <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00748         <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#c6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>++;
00749       }<span class="comment">// loop on rows</span>
00750 
00751     }
00752   }
00753   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;  
00754 }
00755 <span class="comment">/**********************************************************************/</span>
00756 <span class="comment">// include rows which value is NOT in the given list AND value within cut</span>
<a name="l00757"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a60">00757</a> <span class="keywordtype">int</span> Catalog::excludeN(<span class="keyword">const</span> std::string name,
00758                       <span class="keyword">const</span> std::vector&lt;double&gt; &amp;listVal) {
00759 
00760   <span class="keywordtype">int</span> done=<a class="code" href="classcatalog_access_1_1_catalog.html#c24">checkImport</a>(<span class="stringliteral">"excludeN"</span>, <span class="keyword">true</span>);
00761   <span class="keywordflow">if</span> (done &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> done;
00762   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#c27">checkQuant_name</a>(<span class="stringliteral">"excludeN"</span>, name);
00763   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
00764 
00765   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_type != Quantity::NUM) {  
00766     std::string errText;
00767     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00768     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"excludeN"</span>, errText);
00769     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00770   }
00771   done=<a class="code" href="classcatalog_access_1_1_catalog.html#c9">doSelN</a>(name, index, 0, listVal);
00772   <span class="keywordflow">return</span> done;
00773 }
00774 <span class="comment">/**********************************************************************/</span>
00775 <span class="comment">// only include rows which have numerical value in the given list AND cut</span>
<a name="l00776"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a61">00776</a> <span class="keywordtype">int</span> Catalog::useOnlyN(<span class="keyword">const</span> std::string name,
00777                       <span class="keyword">const</span> std::vector&lt;double&gt; &amp;listVal) {
00778 
00779   <span class="keywordtype">int</span> done=<a class="code" href="classcatalog_access_1_1_catalog.html#c24">checkImport</a>(<span class="stringliteral">"useOnlyN"</span>, <span class="keyword">true</span>);
00780   <span class="keywordflow">if</span> (done &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> done;
00781   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#c27">checkQuant_name</a>(<span class="stringliteral">"useOnlyN"</span>, name);
00782   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
00783 
00784   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_type != Quantity::NUM) {  
00785     std::string errText;
00786     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00787     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"useOnlyN"</span>, errText);
00788     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00789   }
00790   done=<a class="code" href="classcatalog_access_1_1_catalog.html#c9">doSelN</a>(name, index, 1, listVal);
00791   <span class="keywordflow">return</span> done;
00792 }
00793 <span class="comment">/**********************************************************************/</span>
00794 <span class="comment">// only include rows which have numerical value in the given list OR cut</span>
<a name="l00795"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a62">00795</a> <span class="keywordtype">int</span> Catalog::includeN(<span class="keyword">const</span> std::string name,
00796                       <span class="keyword">const</span> std::vector&lt;double&gt; &amp;listVal) {
00797 
00798   <span class="keywordtype">int</span> done=<a class="code" href="classcatalog_access_1_1_catalog.html#c24">checkImport</a>(<span class="stringliteral">"includeN"</span>, <span class="keyword">true</span>);
00799   <span class="keywordflow">if</span> (done &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> done;
00800   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#c27">checkQuant_name</a>(<span class="stringliteral">"includeN"</span>, name);
00801   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
00802 
00803   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_type != Quantity::NUM) {  
00804     std::string errText;
00805     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00806     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"includeN"</span>, errText);
00807     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00808   }
00809   done=<a class="code" href="classcatalog_access_1_1_catalog.html#c9">doSelN</a>(name, index, 3, listVal); <span class="comment">// 3 to set bit 0 to 1.</span>
00810   <span class="keywordflow">return</span> done;
00811 }
00812 
00813 <span class="comment">/**********************************************************************/</span>
00814 <span class="comment">// set quantity member and apply (if different and quantity is selected)</span>
<a name="l00815"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a63">00815</a> <span class="keywordtype">int</span> Catalog::setRejectNaN(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">bool</span> rejectNaN) {
00816 
00817   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"setRejectNaN"</span>;
00818   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#c24">checkImport</a>(origin, <span class="keyword">true</span>);
00819   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00820   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#c27">checkQuant_name</a>(origin, name);
00821   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
00822   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_type != Quantity::NUM) {  
00823     std::string errText;
00824     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00825     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
00826     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00827   }
00828   <span class="comment">// if same boolean: do nothing</span>
00829   <span class="keywordflow">if</span> (rejectNaN == <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_rejectNaN) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00830   <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_rejectNaN=rejectNaN;
00831 
00832   <span class="comment">/* if no data: exit */</span>
00833   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00834 
00835   std::vector&lt;bool&gt; isSelected;
00836   <a class="code" href="classcatalog_access_1_1_catalog.html#c2">existCriteria</a>(&amp;isSelected);
00837   <span class="keywordflow">if</span> (isSelected.at(index+1)) {
00838     <span class="comment">// apply the selection with new behaviour on NaN</span>
00839 
00840     std::string text=<span class="stringliteral">"NaN values are now "</span>;
00841     <span class="keywordflow">if</span> (rejectNaN) text=text+<span class="stringliteral">" rejected (on "</span>;
00842     <span class="keywordflow">else</span> text=text+<span class="stringliteral">" accepted (on "</span>;
00843     text=text+name+ <span class="stringliteral">")"</span>;
00844     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, text);
00845     <span class="keywordtype">bool</span> check,
00846          cutOR=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_cutORed,
00847          miss=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_excludeList;
00848     <span class="keywordtype">double</span> precis=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_precision;
00849     <span class="keywordtype">int</span>  k,
00850          pos=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_index;
00851     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> test=<a class="code" href="classcatalog_access_1_1_catalog.html#c29">bitPosition</a>(index, &amp;k);
00852     <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
00853     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>; i++) {
00854 
00855       <span class="keywordflow">if</span> (!cutOR) <span class="comment">// usual case</span>
00856         check=<a class="code" href="classcatalog_access_1_1_catalog.html#c4">checkNUM</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[pos].at(i), index, miss, rejectNaN, precis);
00857       <span class="keywordflow">else</span>
00858         check=<a class="code" href="classcatalog_access_1_1_catalog.html#c5">checkNUMor</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[pos].at(i), index, rejectNaN, precis);
00859       <span class="keywordflow">if</span> (check)
00860         <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)|= test;
00861       <span class="keywordflow">else</span>
00862         <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00863       <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#c6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>++;
00864 
00865     }<span class="comment">// loop on rows</span>
00866 
00867   }
00868   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;  
00869 }
00870 <span class="comment">/**********************************************************************/</span>
00871 <span class="comment">// set quantity member and apply (if quantity has a non empty selection list)</span>
<a name="l00872"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a64">00872</a> <span class="keywordtype">int</span> Catalog::setMatchPercent(<span class="keyword">const</span> std::string name, <span class="keywordtype">double</span> percent) {
00873 
00874   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"setMatchPercent"</span>;
00875   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#c24">checkImport</a>(origin, <span class="keyword">true</span>);
00876   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00877   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#c27">checkQuant_name</a>(origin, name);
00878   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
00879   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_type != Quantity::NUM) {  
00880     std::string errText;
00881     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00882     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
00883     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00884   }
00885   std::ostringstream sortie;
00886   <span class="keywordflow">if</span> (percent &lt;= 100.*NearZero) {
00887     sortie &lt;&lt; <span class="stringliteral">"Percentage must be &gt; "</span> &lt;&lt; 100.*NearZero;
00888     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, sortie.str());
00889     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a32">BAD_SEL_LIM</a>;
00890   }
00891   <span class="comment">// if limit is the same: do nothing</span>
00892   percent/=100.;
00893   <span class="keywordflow">if</span> (percent == <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_precision) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00894   <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_precision=percent;
00895 
00896   <span class="comment">/* if no data: exit */</span>
00897   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00898   <span class="comment">/* if empty list: exit */</span>
00899   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_listValN.size() == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00900 
00901   std::vector&lt;bool&gt; isSelected;
00902   <a class="code" href="classcatalog_access_1_1_catalog.html#c2">existCriteria</a>(&amp;isSelected);
00903   <span class="comment">// quantity is selected since list is not empty</span>
00904   sortie &lt;&lt; <span class="stringliteral">"Relative precision for values in list (for "</span>&lt;&lt;name&lt;&lt; <span class="stringliteral">")"</span>
00905          &lt;&lt; <span class="stringliteral">" is: "</span> &lt;&lt; percent &lt;&lt; <span class="stringliteral">" (absolute precision around 0)"</span>;
00906   <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, sortie.str());
00907   <span class="keywordtype">bool</span> check,
00908        cutOR=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_cutORed,
00909        reject=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_rejectNaN,
00910        miss=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_excludeList;
00911   <span class="keywordtype">int</span>  k,
00912        pos=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_index;
00913   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> test=<a class="code" href="classcatalog_access_1_1_catalog.html#c29">bitPosition</a>(index, &amp;k);
00914   <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
00915   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>; i++) {
00916 
00917     <span class="keywordflow">if</span> (!cutOR) <span class="comment">// usual case</span>
00918       check=<a class="code" href="classcatalog_access_1_1_catalog.html#c4">checkNUM</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[pos].at(i), index, miss, reject, percent);
00919     <span class="keywordflow">else</span>
00920       check=<a class="code" href="classcatalog_access_1_1_catalog.html#c5">checkNUMor</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[pos].at(i), index, reject, percent);
00921     <span class="keywordflow">if</span> (check)
00922       <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)|= test;
00923     <span class="keywordflow">else</span>
00924       <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00925     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#c6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>++;
00926 
00927   }<span class="comment">// loop on rows</span>
00928 
00929   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;  
00930 }
00931 <span class="comment">/**********************************************************************/</span>
00932 <span class="comment">// set quantity member and apply (if quantity has a non empty selection list)</span>
<a name="l00933"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a65">00933</a> <span class="keywordtype">int</span> Catalog::setMatchEpsilon(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> step)
00934 {
00935   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"setMatchEpsilon"</span>;
00936   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#c24">checkImport</a>(origin, <span class="keyword">true</span>);
00937   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00938   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#c27">checkQuant_name</a>(origin, name);
00939   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
00940   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_type != Quantity::NUM) {  
00941     std::string errText;
00942     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00943     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
00944     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00945   }
00946   std::ostringstream sortie;
00947   <span class="keywordflow">if</span> (step == 0ul) {
00948     sortie &lt;&lt; <span class="stringliteral">"Number of epsilon must be &gt; 0"</span>;
00949     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, sortie.str());
00950     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a32">BAD_SEL_LIM</a>;
00951   }
00952   <span class="comment">// if limit is the same: do nothing</span>
00953   <span class="keywordtype">double</span> precis=step*std::numeric_limits&lt;double&gt;::epsilon();
00954   <span class="keywordflow">if</span> (precis == <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_precision) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00955   <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_precision=precis;
00956 
00957   <span class="comment">/* if no data: exit */</span>
00958   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00959   <span class="comment">/* if empty list: exit */</span>
00960   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_listValN.size() == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00961 
00962   std::vector&lt;bool&gt; isSelected;
00963   <a class="code" href="classcatalog_access_1_1_catalog.html#c2">existCriteria</a>(&amp;isSelected);
00964   <span class="comment">// quantity is selected since list is not empty</span>
00965   sortie &lt;&lt; <span class="stringliteral">"Relative precision for values in list (for "</span>&lt;&lt;name&lt;&lt; <span class="stringliteral">")"</span>
00966          &lt;&lt; <span class="stringliteral">" is: "</span> &lt;&lt; precis &lt;&lt; <span class="stringliteral">" (absolute precision around 0)"</span>;
00967   <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, sortie.str());
00968   <span class="keywordtype">bool</span> check,
00969        cutOR=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_cutORed,
00970        reject=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_rejectNaN,
00971        miss=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_excludeList;
00972   <span class="keywordtype">int</span>  k,
00973        pos=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_index;
00974   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> test=<a class="code" href="classcatalog_access_1_1_catalog.html#c29">bitPosition</a>(index, &amp;k);
00975   <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
00976   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>; i++) {
00977 
00978     <span class="keywordflow">if</span> (!cutOR) <span class="comment">// usual case</span>
00979       check=<a class="code" href="classcatalog_access_1_1_catalog.html#c4">checkNUM</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[pos].at(i), index, miss, reject, precis);
00980     <span class="keywordflow">else</span>
00981       check=<a class="code" href="classcatalog_access_1_1_catalog.html#c5">checkNUMor</a>(<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[pos].at(i), index, reject, precis);
00982     <span class="keywordflow">if</span> (check)
00983       <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)|= test;
00984     <span class="keywordflow">else</span>
00985       <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
00986     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#c6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>++;
00987 
00988   }<span class="comment">// loop on rows</span>
00989 
00990   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;  
00991 }
00992 
00993 <span class="comment">/**********************************************************************/</span>
00994 <span class="comment">// check if given value is within interval cut</span>
<a name="l00995"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a66">00995</a> <span class="keywordtype">int</span> Catalog::checkValWithinCut(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">double</span> value,
00996                                <span class="keywordtype">bool</span> *cutLow, <span class="keywordtype">bool</span> *cutUp,<span class="keywordtype">int</span> *checkResult) {
00997 
00998   *cutLow=<span class="keyword">false</span>;
00999   *cutUp=<span class="keyword">false</span>;
01000   *checkResult=0;
01001   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"checkValWithinCut"</span>;
01002   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#c24">checkImport</a>(origin, <span class="keyword">true</span>);
01003   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
01004   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#c27">checkQuant_name</a>(origin, name);
01005   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
01006   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_type != Quantity::NUM) {  
01007     std::string errText;
01008     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
01009     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
01010     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
01011   }  
01012 
01013   <span class="keywordtype">double</span> myLimit, r=value;
01014   myLimit=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_lowerCut;
01015   <span class="keywordflow">if</span> (fabs(value) &gt; NearZero)
01016     r+=value*<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_precision;
01017   <span class="keywordflow">else</span>
01018     r+=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_precision;
01019   <span class="keywordflow">if</span> (myLimit &lt; <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) {
01020     *cutLow=<span class="keyword">true</span>;
01021     <span class="keywordflow">if</span> (r &lt; myLimit) *checkResult=-2;
01022     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value &lt; myLimit) *checkResult=-1;
01023   }
01024   r=value;
01025   myLimit=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_upperCut;
01026   <span class="keywordflow">if</span> (fabs(value) &gt; NearZero)
01027     r-=value*<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_precision;
01028   <span class="keywordflow">else</span>
01029     r-=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_precision;
01030   <span class="keywordflow">if</span> (myLimit &lt; <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>) {
01031     *cutUp=<span class="keyword">true</span>;
01032     <span class="keywordflow">if</span> (r &gt; myLimit) *checkResult=2;
01033     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value &gt; myLimit) *checkResult=1;
01034   }
01035 
01036   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;  
01037 }
01038 
01039 
01040 <span class="comment">/**********************************************************************/</span>
01041 <span class="comment">// select rows depending on the given string list for existing index</span>
<a name="l01042"></a><a class="code" href="classcatalog_access_1_1_catalog.html#c8">01042</a> <span class="keywordtype">int</span> Catalog::doSelS(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">int</span> code,
01043                     <span class="keyword">const</span> std::vector&lt;std::string&gt; &amp;list, <span class="keyword">const</span> <span class="keywordtype">bool</span> exact) {
01044 
01045   std::ostringstream sortie;
01046   <span class="keywordtype">bool</span> miss;
01047   <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_cutORed=!exact;
01048   <span class="keywordflow">if</span> (code &amp; 1) {
01049     <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_excludeList=<span class="keyword">false</span>;
01050     miss=<span class="keyword">false</span>;
01051     sortie &lt;&lt; <span class="stringliteral">"Include rows"</span>;
01052   }
01053   <span class="keywordflow">else</span> {
01054     <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_excludeList=<span class="keyword">true</span>;
01055     miss=<span class="keyword">true</span>;
01056     sortie &lt;&lt; <span class="stringliteral">"Exclude rows"</span>;
01057   }
01058   <span class="keywordtype">int</span> listSize=list.size();
01059   <span class="keywordflow">if</span> ((!listSize) &amp;&amp; (!<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_listValS.size())) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01060   <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_listValS.clear();
01061   <span class="keywordtype">int</span> j;
01062   int (*pfunc)(int)=tolower; <span class="comment">// function used by transform</span>
01063   std::vector&lt;std::string&gt; myList;
01064   std::string mot;
01065   <span class="keywordflow">for</span> (j=0; j&lt;listSize; j++) {
01066     mot=list.at(j);
01067     <a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_listValS.push_back(mot);
01068     <span class="keywordflow">if</span> (!exact) transform(mot.begin(), mot.end(), mot.begin(), pfunc);
01069     myList.push_back(mot);
01070   }
01071 <span class="preprocessor">  #ifdef DEBUG_CAT</span>
01072 <span class="preprocessor"></span>  <span class="keywordflow">for</span> (j=0; j&lt;listSize; j++) std::cout &lt;&lt; myList[j] &lt;&lt; <span class="stringliteral">"|"</span>;
01073   std::cout &lt;&lt;<span class="stringliteral">"caseless="</span>&lt;&lt; exact &lt;&lt; std::endl;
01074 <span class="preprocessor">  #endif</span>
01075 <span class="preprocessor"></span>
01076   <span class="comment">/* if no data: exit */</span>
01077   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a> == 0) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01078 
01079   std::vector&lt;bool&gt; isSelected;
01080   <span class="keywordtype">bool</span> check=<a class="code" href="classcatalog_access_1_1_catalog.html#c2">existCriteria</a>(&amp;isSelected);
01081   <span class="keywordtype">int</span>  k;
01082   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> test=<a class="code" href="classcatalog_access_1_1_catalog.html#c29">bitPosition</a>(index, &amp;k);
01083   <span class="keywordflow">if</span> (listSize == 0) {
01084     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, <span class="stringliteral">"Disabling list selection (on "</span>+name+<span class="stringliteral">")"</span>);
01085     <span class="keywordflow">if</span> (!check) {
01086       <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a> &gt; 0) {
01087         listSize=<a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>.size(); <span class="comment">// to avoid compiler Warning</span>
01088         <span class="keywordflow">for</span> (j=0; j&lt;listSize; j++) <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[j].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>, 0);
01089       }
01090       <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
01091       <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, <span class="stringliteral">"All rows unselected"</span>);
01092     }
01093     <span class="keywordflow">else</span> {
01094       <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
01095       <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>; i++) {
01096         <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
01097         <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#c6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>++;
01098       }
01099     }
01100     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01101   }
01102 
01103   sortie &lt;&lt; <span class="stringliteral">" with \""</span> &lt;&lt; name &lt;&lt;<span class="stringliteral">"\" string in list ("</span>
01104          &lt;&lt; listSize &lt;&lt; <span class="stringliteral">" elements, "</span>;
01105   <span class="keywordflow">if</span> (exact) sortie &lt;&lt; <span class="stringliteral">"exact match)"</span>; <span class="keywordflow">else</span> sortie &lt;&lt; <span class="stringliteral">"caseless match)"</span>; 
01106   <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(1, sortie.str());
01107   <span class="keywordtype">int</span>  pos=<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>[index].m_index;
01108   <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
01109   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>; i++) {
01110     mot=<a class="code" href="classcatalog_access_1_1_catalog.html#o12">m_strings</a>[pos].at(i);
01111     <span class="keywordflow">if</span> (!exact) transform(mot.begin(), mot.end(), mot.begin(), pfunc);
01112     check=miss;
01113     <span class="keywordflow">for</span> (j=0; j&lt;listSize; j++) {
01114       <span class="keywordflow">if</span> (mot == myList[j]) {check=!miss; <span class="keywordflow">break</span>;}
01115     }
01116     <span class="comment">// setting required bit</span>
01117     <span class="keywordflow">if</span> (check)
01118       <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)|= test;
01119     <span class="keywordflow">else</span>
01120       <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[k].at(i)&amp;= (Max_Test-test);
01121     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#c6">rowSelect</a>(i, isSelected) == <span class="keyword">true</span>) <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>++;
01122   }<span class="comment">// loop on rows</span>
01123 
01124   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01125 }
01126 <span class="comment">/**********************************************************************/</span>
01127 <span class="comment">// exclude all rows which have string value in the given list</span>
<a name="l01128"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a58">01128</a> <span class="keywordtype">int</span> Catalog::excludeS(<span class="keyword">const</span> std::string name,
01129                       <span class="keyword">const</span> std::vector&lt;std::string&gt; &amp;list, <span class="keyword">const</span> <span class="keywordtype">bool</span> exact) {
01130 
01131   <span class="keywordtype">int</span> done=<a class="code" href="classcatalog_access_1_1_catalog.html#c24">checkImport</a>(<span class="stringliteral">"excludeS"</span>, <span class="keyword">true</span>);
01132   <span class="keywordflow">if</span> (done &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> done;
01133   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#c27">checkQuant_name</a>(<span class="stringliteral">"excludeS"</span>, name);
01134   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
01135 
01136   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_type != Quantity::STRING) {  
01137     std::string errText;
01138     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of STRING type"</span>;
01139     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"excludeS"</span>, errText);
01140     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
01141   }
01142   done=<a class="code" href="classcatalog_access_1_1_catalog.html#c8">doSelS</a>(name, index, 0, list, exact);
01143   <span class="keywordflow">return</span> done;
01144 }
01145 <span class="comment">/**********************************************************************/</span>
01146 <span class="comment">// only include rows which have string value in the given list</span>
<a name="l01147"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a59">01147</a> <span class="keywordtype">int</span> Catalog::useOnlyS(<span class="keyword">const</span> std::string name,
01148                       <span class="keyword">const</span> std::vector&lt;std::string&gt; &amp;list, <span class="keyword">const</span> <span class="keywordtype">bool</span> exact) {
01149 
01150   <span class="keywordtype">int</span> done=<a class="code" href="classcatalog_access_1_1_catalog.html#c24">checkImport</a>(<span class="stringliteral">"useOnlyS"</span>, <span class="keyword">true</span>);
01151   <span class="keywordflow">if</span> (done &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> done;
01152   <span class="keywordtype">int</span> index=<a class="code" href="classcatalog_access_1_1_catalog.html#c27">checkQuant_name</a>(<span class="stringliteral">"useOnlyS"</span>, name);
01153   <span class="keywordflow">if</span> (index &lt; 0) <span class="keywordflow">return</span> index;
01154 
01155   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o10">m_quantities</a>.at(index).m_type != Quantity::STRING) {  
01156     std::string errText;
01157     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of STRING type"</span>;
01158     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"useOnlyS"</span>, errText);
01159     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
01160   }
01161   done=<a class="code" href="classcatalog_access_1_1_catalog.html#c8">doSelS</a>(name, index, 1, list, exact);
01162   <span class="keywordflow">return</span> done;
01163 }
01164 
01165 
01166 <span class="comment">/**********************************************************************/</span>
01167 <span class="comment">// erase all non-selected rows from memory</span>
<a name="l01168"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a67">01168</a> <span class="keywordtype">int</span> Catalog::eraseNonSelected() {
01169 
01170   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"eraseNonSelected"</span>;
01171   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a> &lt;= 0) {
01172     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"catalog is empty"</span>);
01173     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>; 
01174   }
01175   <span class="comment">// test below avoid deleting NOTHING</span>
01176   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a> == <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>) {
01177     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"all rows selected, nothing done"</span>);
01178     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>; 
01179   }
01180   <span class="comment">// log if ALL is deleted</span>
01181   std::string text;
01182   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a> == 0) {
01183     text=<span class="stringliteral">"no row selected, calling deleteContent()"</span>;
01184     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(2, text);
01185     <a class="code" href="classcatalog_access_1_1_catalog.html#a23">deleteContent</a>();
01186     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01187   }
01188   <span class="keywordflow">try</span> {
01189     <span class="keywordtype">long</span> i, tot=0;
01190     <span class="keywordtype">int</span> j;
01191     <span class="keywordtype">int</span> sizeS=<a class="code" href="classcatalog_access_1_1_catalog.html#o12">m_strings</a>.size();
01192     <span class="keywordtype">int</span> sizeN=<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>.size();
01193     <span class="keywordtype">int</span> vecSize=<a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>.size();
01194     <span class="comment">// to speed-up, will not change (avoid reading size in loop)</span>
01195 
01196     std::vector&lt;std::vector&lt;double&gt; &gt; myNum;
01197     myNum.resize(sizeN);
01198     <span class="keywordflow">for</span> (j=0; j&lt;sizeN; j++) myNum[j].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>, 0.0);
01199     std::vector&lt;std::vector&lt;std::string&gt; &gt; myStr;
01200     myStr.resize(sizeS);
01201     <span class="keywordflow">for</span> (j=0; j&lt;sizeS; j++) myStr[j].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>, <span class="stringliteral">""</span>);
01202     std::vector&lt;std::vector&lt;unsigned long&gt; &gt; myBits;
01203     myBits.resize(vecSize);
01204     <span class="keywordflow">for</span> (j=0; j&lt;vecSize; j++) myBits[j].assign(<a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>, 0ul);
01205     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>; i++) {
01206       <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[0].at(i) &amp; 1) {
01207         <span class="keywordflow">for</span> (j=0; j&lt;sizeN; j++) myNum[j].at(tot)=<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[j].at(i);
01208         <span class="keywordflow">for</span> (j=0; j&lt;sizeS; j++) myStr[j].at(tot)=<a class="code" href="classcatalog_access_1_1_catalog.html#o12">m_strings</a>[j].at(i);
01209         <span class="keywordflow">for</span> (j=0; j&lt;vecSize; j++) myBits[j].at(tot)=<a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[j].at(i);
01210         <span class="keywordflow">if</span> (++tot == <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>) <span class="keywordflow">break</span>; <span class="comment">// to speed up</span>
01211       }
01212     }
01213     <span class="keywordflow">for</span> (j=0; j&lt;sizeN; j++) {
01214       <a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[j].insert(<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[j].begin(),
01215                              myNum[j].begin(), myNum[j].end());
01216       myNum[j].clear();
01217     }
01218     myNum.clear();
01219     <span class="keywordflow">for</span> (j=0; j&lt;sizeS; j++) {
01220       <a class="code" href="classcatalog_access_1_1_catalog.html#o12">m_strings</a>[j].insert(<a class="code" href="classcatalog_access_1_1_catalog.html#o12">m_strings</a>[j].begin(),
01221                           myStr[j].begin(), myStr[j].end());
01222       myStr[j].clear();
01223     }
01224     myStr.clear();
01225     <span class="keywordflow">for</span> (j=0; j&lt;vecSize; j++)  {
01226       <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[j].insert(<a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[j].begin(),
01227                                 myBits[j].begin(), myBits[j].end());
01228       myBits[j].clear();
01229     }
01230     myBits.clear();
01231 <span class="comment">/* if (!keepCriteria) {</span>
01232 <span class="comment">    for (j=0; j&lt;vecSize; j++) m_rowIsSelected[j].assign(m_numSelRows, 0);</span>
01233 <span class="comment">    vecSize=m_quantities.size();</span>
01234 <span class="comment">    for (i=0; i&lt;vecSize; i++) {</span>
01235 <span class="comment">      m_quantities.at(i).m_listValS.clear();</span>
01236 <span class="comment">      m_quantities.at(i).m_lowerCut=NO_SEL_CUT;</span>
01237 <span class="comment">      m_quantities.at(i).m_upperCut=NO_SEL_CUT;</span>
01238 <span class="comment">      m_quantities.at(i).m_listValN.clear();</span>
01239 <span class="comment">    }</span>
01240 <span class="comment">    m_selRegion=false;</span>
01241 <span class="comment">*/</span>
01242 <span class="comment">/*  THIS METHOD IS VERY VERY LONG </span>
01243 <span class="comment">    std::vector&lt; std::vector&lt;std::string&gt;::iterator &gt; stringIter;</span>
01244 <span class="comment">    std::vector&lt; std::vector&lt;double&gt;::iterator &gt; doubleIter;</span>
01245 <span class="comment">    for (j=0; j&lt;sizeS; j++) stringIter.push_back(m_strings[j].begin());</span>
01246 <span class="comment">    for (j=0; j&lt;sizeN; j++) doubleIter.push_back(m_numericals[j].begin());</span>
01247 <span class="comment">    if (keepCriteria) {</span>
01248 <span class="comment"></span>
01249 <span class="comment">      std::vector&lt; std::vector&lt;unsigned long&gt;::iterator &gt; myIter;</span>
01250 <span class="comment">      for (j=0; j&lt;vecSize; j++) myIter.push_back(m_rowIsSelected[j].begin());</span>
01251 <span class="comment">      for (i=0; i&lt;m_numRows; i++) {</span>
01252 <span class="comment">        if (!(*myIter[0] &amp; 1)) {</span>
01253 <span class="comment">          for (j=0; j&lt;sizeS; j++) m_strings[j].erase(stringIter[j]);</span>
01254 <span class="comment">          for (j=0; j&lt;sizeN; j++) m_numericals[j].erase(doubleIter[j]);</span>
01255 <span class="comment">          for (j=0; j&lt;vecSize; j++) m_rowIsSelected[j].erase(myIter[j]);</span>
01256 <span class="comment">        }</span>
01257 <span class="comment">        else {</span>
01258 <span class="comment">          for (j=0; j&lt;sizeS; j++) stringIter.at(j)++;</span>
01259 <span class="comment">          for (j=0; j&lt;sizeN; j++) doubleIter.at(j)++;</span>
01260 <span class="comment">          for (j=0; j&lt;vecSize; j++) myIter.at(j)++;</span>
01261 <span class="comment">        }</span>
01262 <span class="comment">      }</span>
01263 <span class="comment">      stringIter.clear();</span>
01264 <span class="comment">      doubleIter.clear();</span>
01265 <span class="comment">      myIter.clear();</span>
01266 <span class="comment">*/</span>
01267   }
01268   <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;prob) {
01269     text=<span class="stringliteral">"EXCEPTION erasing m_strings, m_numericals or m_rowIsSelected: "</span>;
01270     text=text+prob.what();
01271     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, text);
01272     <span class="keywordflow">throw</span>;
01273   }
01274   std::ostringstream sortie;
01275   sortie &lt;&lt; <a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>-<a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a> &lt;&lt; <span class="stringliteral">" row(s) deleted"</span>;
01276   <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, sortie.str());
01277   <a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>=<a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>;
01278   <span class="comment">//if (!keepCriteria) m_numSelRows=0;</span>
01279   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01280 }
01281 <span class="comment">/**********************************************************************/</span>
01282 <span class="comment">// erase all selected rows from memory</span>
<a name="l01283"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a68">01283</a> <span class="keywordtype">int</span> Catalog::eraseSelected() {
01284 
01285   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"eraseSelected"</span>;
01286   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a> &lt;= 0) {
01287     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"catalog is empty"</span>);
01288     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>; 
01289   }
01290   <span class="comment">// test below avoid deleting NOTHING</span>
01291   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a> == 0) {
01292     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"no row selected, nothing done"</span>);
01293     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>; 
01294   }
01295   <span class="comment">// log if ALL is deleted</span>
01296   std::string text;
01297   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a> == <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>) {
01298     text=<span class="stringliteral">"all rows selected, calling deleteContent()"</span>;
01299     <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(2, text);
01300     <a class="code" href="classcatalog_access_1_1_catalog.html#a23">deleteContent</a>();
01301     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01302   }
01303   <span class="keywordflow">try</span> {
01304     <span class="keywordtype">long</span> i, tot=0,
01305          numRows=<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>-<a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>;
01306     <span class="keywordtype">int</span> j;
01307     <span class="keywordtype">int</span> sizeS=<a class="code" href="classcatalog_access_1_1_catalog.html#o12">m_strings</a>.size();
01308     <span class="keywordtype">int</span> sizeN=<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>.size();
01309     <span class="keywordtype">int</span> vecSize=<a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>.size();
01310     <span class="comment">// to speed-up, will not change (avoid reading size in loop)</span>
01311 
01312     std::vector&lt;std::vector&lt;double&gt; &gt; myNum;
01313     myNum.resize(sizeN);
01314     <span class="keywordflow">for</span> (j=0; j&lt;sizeN; j++) myNum[j].assign(numRows, 0.0);
01315     std::vector&lt;std::vector&lt;std::string&gt; &gt; myStr;
01316     myStr.resize(sizeS);
01317     <span class="keywordflow">for</span> (j=0; j&lt;sizeS; j++) myStr[j].assign(numRows, <span class="stringliteral">""</span>);
01318     std::vector&lt;std::vector&lt;unsigned long&gt; &gt; myBits;
01319     myBits.resize(vecSize);
01320     <span class="keywordflow">for</span> (j=0; j&lt;vecSize; j++) myBits[j].assign(numRows, 0ul);
01321     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>; i++) {
01322       <span class="keywordflow">if</span> (!(<a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[0].at(i) &amp; 1)) {
01323         <span class="keywordflow">for</span> (j=0; j&lt;sizeN; j++) myNum[j].at(tot)=<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[j].at(i);
01324         <span class="keywordflow">for</span> (j=0; j&lt;sizeS; j++) myStr[j].at(tot)=<a class="code" href="classcatalog_access_1_1_catalog.html#o12">m_strings</a>[j].at(i);
01325         <span class="keywordflow">for</span> (j=0; j&lt;vecSize; j++) myBits[j].at(tot)=<a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[j].at(i);
01326         <span class="keywordflow">if</span> (++tot == numRows) <span class="keywordflow">break</span>; <span class="comment">// to speed up</span>
01327       }
01328     }
01329     <span class="keywordflow">for</span> (j=0; j&lt;sizeN; j++) {
01330       <a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[j].insert(<a class="code" href="classcatalog_access_1_1_catalog.html#o13">m_numericals</a>[j].begin(),
01331                              myNum[j].begin(), myNum[j].end());
01332       myNum[j].clear();
01333     }
01334     myNum.clear();
01335     <span class="keywordflow">for</span> (j=0; j&lt;sizeS; j++) {
01336       <a class="code" href="classcatalog_access_1_1_catalog.html#o12">m_strings</a>[j].insert(<a class="code" href="classcatalog_access_1_1_catalog.html#o12">m_strings</a>[j].begin(),
01337                           myStr[j].begin(), myStr[j].end());
01338       myStr[j].clear();
01339     }
01340     myStr.clear();
01341     <span class="keywordflow">for</span> (j=0; j&lt;vecSize; j++)  {
01342       <a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[j].insert(<a class="code" href="classcatalog_access_1_1_catalog.html#o16">m_rowIsSelected</a>[j].begin(),
01343                                 myBits[j].begin(), myBits[j].end());
01344       myBits[j].clear();
01345     }
01346     myBits.clear();
01347 <span class="comment">/* if (!keepCriteria) {</span>
01348 <span class="comment">    for (j=0; j&lt;vecSize; j++) m_rowIsSelected[j].assign(numRows, 0);</span>
01349 <span class="comment">    vecSize=m_quantities.size();</span>
01350 <span class="comment">    for (i=0; i&lt;vecSize; i++) {</span>
01351 <span class="comment">      m_quantities.at(i).m_listValS.clear();</span>
01352 <span class="comment">      m_quantities.at(i).m_lowerCut=NO_SEL_CUT;</span>
01353 <span class="comment">      m_quantities.at(i).m_upperCut=NO_SEL_CUT;</span>
01354 <span class="comment">      m_quantities.at(i).m_listValN.clear();</span>
01355 <span class="comment">    }</span>
01356 <span class="comment">    m_selRegion=false;</span>
01357 <span class="comment">*/</span>
01358   }
01359   <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;prob) {
01360     text=<span class="stringliteral">"EXCEPTION erasing m_strings, m_numericals or m_rowIsSelected: "</span>;
01361     text=text+prob.what();
01362     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, text);
01363     <span class="keywordflow">throw</span>;
01364   }
01365   std::ostringstream sortie;
01366   sortie &lt;&lt; <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a> &lt;&lt; <span class="stringliteral">" row(s) deleted"</span>;
01367   <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, sortie.str());
01368   <a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>=<a class="code" href="classcatalog_access_1_1_catalog.html#o15">m_numRows</a>-<a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>;
01369   <a class="code" href="classcatalog_access_1_1_catalog.html#o25">m_numSelRows</a>=0;
01370   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01371 }
01372 
01373 } <span class="comment">// namespace catalogAccess</span>
</pre></div><hr><address style="align: right;"><small>Generated on Wed Jul 13 10:50:51 2005 for catalogAccess by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
