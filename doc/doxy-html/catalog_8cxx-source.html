<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>catalogAccess: catalog.cxx Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>catalog.cxx</h1><a href="catalog_8cxx.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00014 <span class="preprocessor">#include "<a class="code" href="catalog_8h.html">catalog.h</a>"</span>
00015 
<a name="l00016"></a><a class="code" href="namespacecatalog_access.html">00016</a> <span class="keyword">namespace </span>catalogAccess {
00017   <span class="keyword">using</span> <span class="keyword">namespace </span>tip;
00018 <span class="comment">/**********************************************************************/</span>
00019 <span class="comment">/*  DEFINING CLASS CONSTANTS                                          */</span>
00020 <span class="comment">/**********************************************************************/</span>
00021 
00022 <span class="comment">// available mirror sites for VizieR (from CDS)</span>
<a name="l00023"></a><a class="code" href="classcatalog_access_1_1_catalog.html#v0">00023</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *Catalog::s_CatalogURL[<a class="code" href="catalog_8h.html#a2">MAX_URL</a>]={
00024       <span class="stringliteral">"cds   fr vizier.u-strasbg.fr/"</span>,    <span class="comment">//CDS - Strasbourg, France</span>
00025       <span class="stringliteral">"cfa   us vizier.cfa.harvard.edu/"</span>, <span class="comment">//CFA - Harvard, USA</span>
00026       <span class="stringliteral">"cadc  ca vizier.hia.nrc.ca/"</span>,      <span class="comment">//CADC - Canada</span>
00027       <span class="stringliteral">"adac  jp vizier.nao.ac.jp/"</span>,       <span class="comment">//ADAC - Tokyo, Japan</span>
00028       <span class="stringliteral">"ukirt hawaii www.ukirt.jach.hawaii.edu/"</span>, <span class="comment">//JAC - Hawaii, USA</span>
00029       <span class="stringliteral">"cambridge uk archive.ast.cam.ac.uk/"</span>,
00030       <span class="stringliteral">"iucaa in urania.iucaa.ernet.in/"</span>,  <span class="comment">//IUCAA - Pune, India</span>
00031       <span class="stringliteral">"moscow ru www.inasan.rssi.ru/"</span>,    <span class="comment">//INASAN - Russia (DOES IT WORK ?)</span>
00032       <span class="stringliteral">"bejing cn data.bao.ac.cn/"</span>         <span class="comment">//Bejing Obs. - China</span>
00033       };
00034 
00035 <span class="comment">// information on catalog size laste updated on: JAN 2005</span>
<a name="l00036"></a><a class="code" href="classcatalog_access_1_1_catalog.html#v1">00036</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *Catalog::s_CatalogList[2*<a class="code" href="catalog_8h.html#a0">MAX_CAT</a>]={
00037       <span class="stringliteral">"EGRET3 sources"</span>, <span class="stringliteral">"J/ApJS/123/79/3eg"</span>,    <span class="comment">//   271 rows (20 columns)</span>
00038       <span class="stringliteral">"EGRET3 fluxes"</span>,  <span class="stringliteral">"J/ApJS/123/79/fluxes"</span>, <span class="comment">//  5245 rows (10 columns)</span>
00039       <span class="stringliteral">"EGRET3 periods"</span>, <span class="stringliteral">"J/ApJS/123/79/table1"</span>, <span class="comment">//   169 rows ( 6 columns)</span>
00040       <span class="stringliteral">"ROSAT 1RXS"</span>,     <span class="stringliteral">"IX/10A/1rxs"</span>,          <span class="comment">// 18806 rows (28 columns)</span>
00041       <span class="stringliteral">"Veron (11th) quasar"</span>, <span class="stringliteral">"VII/235/table1"</span>,  <span class="comment">// 48921 rows (21 columns)</span>
00042       <span class="stringliteral">"Veron (11th) BL Lac"</span>, <span class="stringliteral">"VII/235/table2"</span>,  <span class="comment">//   876 rows (21 columns)</span>
00043       <span class="stringliteral">"Veron (11th) AGN"</span>,    <span class="stringliteral">"VII/235/table3"</span>,  <span class="comment">// 15069 rows (21 columns)</span>
00044       <span class="stringliteral">"WGACAT of ROSAT"</span>,     <span class="stringliteral">"IX/31/wgacat"</span>,    <span class="comment">// 88621 rows (101 columns)</span>
00045       <span class="stringliteral">"ROSAT faint sources"</span>, <span class="stringliteral">"IX/29/rass_fsc"</span>,  <span class="comment">//105924 rows (30 columns)</span>
00046       <span class="stringliteral">"Green galactic SNR"</span>,  <span class="stringliteral">"VII/227/snrs"</span>     <span class="comment">//   231 rows (14 columns)</span>
00047       };
00048 
00049 
<a name="l00050"></a><a class="code" href="classcatalog_access_1_1_catalog.html#v2">00050</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *Catalog::s_CatalogGeneric[<a class="code" href="catalog_8h.html#a0">MAX_CAT</a>][<a class="code" href="catalog_8h.html#a1">MAX_GEN</a>]={
00051      {<span class="stringliteral">"3EG"</span>, <span class="stringliteral">"RAJ2000"</span>, <span class="stringliteral">"DEJ2000"</span>, <span class="stringliteral">"theta95"</span>, <span class="stringliteral">"GLON"</span>, <span class="stringliteral">"GLAT"</span>},
00052      {<span class="stringliteral">"3EG"</span>, <span class="stringliteral">""</span>, <span class="stringliteral">""</span>, <span class="stringliteral">""</span>, <span class="stringliteral">""</span>, <span class="stringliteral">""</span>},
00053      {<span class="stringliteral">""</span>,    <span class="stringliteral">"+"</span>, <span class="stringliteral">"+"</span>, <span class="stringliteral">""</span>, <span class="stringliteral">"GLON"</span>, <span class="stringliteral">"GLAT"</span>},
00054      {<span class="stringliteral">"1RXS"</span>, <span class="stringliteral">"RAJ2000"</span>, <span class="stringliteral">"DEJ2000"</span>, <span class="stringliteral">"PosErr"</span>, <span class="stringliteral">"+"</span>, <span class="stringliteral">"+"</span>},
00055      {<span class="stringliteral">"Name"</span>, <span class="stringliteral">"+"</span>, <span class="stringliteral">"+"</span>, <span class="stringliteral">""</span>, <span class="stringliteral">"+"</span>, <span class="stringliteral">"+"</span>},   <span class="comment">// original format of RA/DEC</span>
00056      {<span class="stringliteral">"Name"</span>, <span class="stringliteral">"+"</span>, <span class="stringliteral">"+"</span>, <span class="stringliteral">""</span>, <span class="stringliteral">"+"</span>, <span class="stringliteral">"+"</span>},   <span class="comment">// is in sexagesimal</span>
00057      {<span class="stringliteral">"Name"</span>, <span class="stringliteral">"+"</span>, <span class="stringliteral">"+"</span>, <span class="stringliteral">""</span>, <span class="stringliteral">"+"</span>, <span class="stringliteral">"+"</span>},   <span class="comment">// ==&gt; need to be added in decimal</span>
00058      {<span class="stringliteral">"1WGA"</span>, <span class="stringliteral">"RAJ2000"</span>, <span class="stringliteral">"DEJ2000"</span>, <span class="stringliteral">"ErrorRad"</span>, <span class="stringliteral">"GLON"</span>, <span class="stringliteral">"GLAT"</span>},
00059      {<span class="stringliteral">"1RXS"</span>, <span class="stringliteral">"RAJ2000"</span>, <span class="stringliteral">"DEJ2000"</span>, <span class="stringliteral">"PosErr"</span>, <span class="stringliteral">"+"</span>, <span class="stringliteral">"+"</span>},
00060      {<span class="stringliteral">"SNR"</span>,  <span class="stringliteral">"+"</span>, <span class="stringliteral">"+"</span>, <span class="stringliteral">""</span>, <span class="stringliteral">"+"</span>, <span class="stringliteral">"+"</span>}   <span class="comment">// RA/DEC is in sexagesimal</span>
00061 };
00062 
00063 
00064 <span class="comment">/**********************************************************************/</span>
00065 <span class="comment">// return true if at least one criteria or selection region exist</span>
<a name="l00066"></a><a class="code" href="classcatalog_access_1_1_catalog.html#d2">00066</a> <span class="keywordtype">bool</span> Catalog::existCriteria(std::vector&lt;bool&gt; *quantSel) {
00067 
00068   <span class="keywordtype">bool</span> all=<span class="keyword">false</span>;
00069   std::vector&lt;Quantity&gt;::const_iterator itQ;
00070   quantSel-&gt;clear();
00071   <span class="keywordflow">try</span> {
00072     <span class="keywordflow">if</span> (!<a class="code" href="classcatalog_access_1_1_catalog.html#r19">m_selRegion</a>) quantSel-&gt;push_back(<span class="keyword">false</span>);
00073     <span class="keywordflow">else</span> { all=<span class="keyword">true</span>;  quantSel-&gt;push_back(<span class="keyword">true</span>); }
00074     <span class="keywordflow">for</span> (itQ=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.begin(); itQ != <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.end(); itQ++) {
00075 
00076       <span class="keywordflow">if</span> (itQ-&gt;m_type == Quantity::STRING) {
00077         <span class="keywordflow">if</span> (itQ-&gt;m_listValS.size() &gt; 0) {
00078           all=<span class="keyword">true</span>;
00079           quantSel-&gt;push_back(<span class="keyword">true</span>);
00080         }
00081         <span class="keywordflow">else</span> quantSel-&gt;push_back(<span class="keyword">false</span>);
00082       }
00083 
00084       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (itQ-&gt;m_type == Quantity::NUM) {
00085         <span class="keywordflow">if</span> ( (itQ-&gt;m_lowerCut &lt; <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>)||(itQ-&gt;m_upperCut &lt; <a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>)
00086             || (itQ-&gt;m_listValN.size() &gt; 0) ) {
00087           all=<span class="keyword">true</span>;
00088           quantSel-&gt;push_back(<span class="keyword">true</span>);
00089         }
00090         <span class="keywordflow">else</span> quantSel-&gt;push_back(<span class="keyword">false</span>);
00091       }
00092 
00093       <span class="keywordflow">else</span> quantSel-&gt;push_back(<span class="keyword">false</span>);
00094       <span class="comment">// VECTOR quantity are selected by the quantities in m_vectorQs</span>
00095 
00096     }<span class="comment">// loop on quantities</span>
00097   }
00098   <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;err) {
00099     std::string errText=std::string(<span class="stringliteral">"EXCEPTION on boolean vector: "</span>)+err.what();
00100     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(<span class="stringliteral">"private existCriteria"</span>, errText);
00101     <span class="keywordflow">throw</span>;
00102   }
00103   <span class="keywordflow">return</span> all;
00104 }
00105 
00106 <span class="comment">/**********************************************************************/</span>
00107 <span class="comment">// erase m_strings, m_numericals but keep catalog definition</span>
<a name="l00108"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a23">00108</a> <span class="keywordtype">void</span> Catalog::deleteContent() {
00109 
00110   <span class="keywordtype">int</span> vecSize, i;
00111   <a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>=0;
00112   <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00113   vecSize=<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>.size();
00114   <span class="keywordflow">if</span> (vecSize &gt; 0 ) {
00115     <span class="keywordflow">for</span> (i=0; i&lt;vecSize; i++) <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[i].clear();
00116     <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>.clear();
00117   }
00118   vecSize=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>.size();
00119   <span class="keywordflow">if</span> (vecSize &gt; 0 ) {
00120     <span class="keywordflow">for</span> (i=0; i&lt;vecSize; i++) <a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[i].clear();
00121     <a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>.clear();
00122   }
00123   vecSize=<a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>.size();
00124   <span class="keywordflow">if</span> (vecSize &gt; 0 ) {
00125     <span class="keywordflow">for</span> (i=0; i&lt;vecSize; i++) <a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>[i].clear();
00126     <a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>.clear();
00127   }
00128 }
00129 <span class="comment">/**********************************************************************/</span>
00130 <span class="comment">// erase catalog definition (private method)</span>
<a name="l00131"></a><a class="code" href="classcatalog_access_1_1_catalog.html#d0">00131</a> <span class="keywordtype">void</span> Catalog::deleteDescription() {
00132 
00133   <a class="code" href="classcatalog_access_1_1_catalog.html#r0">m_code</a>=<span class="stringliteral">""</span>;
00134   <a class="code" href="classcatalog_access_1_1_catalog.html#r1">m_URL</a> =<span class="stringliteral">""</span>;
00135   <a class="code" href="classcatalog_access_1_1_catalog.html#r2">m_catName</a>   =<span class="stringliteral">""</span>;
00136   <a class="code" href="classcatalog_access_1_1_catalog.html#r3">m_catRef</a>    =<span class="stringliteral">""</span>;
00137   <a class="code" href="classcatalog_access_1_1_catalog.html#r4">m_tableName</a> =<span class="stringliteral">""</span>;
00138   <a class="code" href="classcatalog_access_1_1_catalog.html#r5">m_tableRef</a>  =<span class="stringliteral">""</span>;
00139 
00140   <a class="code" href="classcatalog_access_1_1_catalog.html#r6">m_filename</a>  =<span class="stringliteral">""</span>;
00141   <a class="code" href="classcatalog_access_1_1_catalog.html#r7">m_filePos</a>   =0;
00142   <a class="code" href="classcatalog_access_1_1_catalog.html#r8">m_posErrSys</a> = -1.0;
00143   <a class="code" href="classcatalog_access_1_1_catalog.html#r9">m_posErrFactor</a>=1.0;  <span class="comment">// "deg" by default</span>
00144   <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.clear();
00145   <a class="code" href="classcatalog_access_1_1_catalog.html#r11">m_loadQuantity</a>.clear();
00146 
00147   <a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>   =<a class="code" href="namespacecatalog_access.html#a37a16">IMPORT_NEED</a>;
00148   <a class="code" href="classcatalog_access_1_1_catalog.html#r14">m_numOriRows</a>=0;
00149   <a class="code" href="classcatalog_access_1_1_catalog.html#r17">m_selection</a>=<span class="stringliteral">""</span>;
00150   <a class="code" href="classcatalog_access_1_1_catalog.html#r18">m_criteriaORed</a>=<span class="keyword">false</span>;
00151   <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=0;
00152   <a class="code" href="classcatalog_access_1_1_catalog.html#r26">m_indexErr</a>= -1;
00153   <a class="code" href="classcatalog_access_1_1_catalog.html#r27">m_indexRA</a> = -1;
00154   <a class="code" href="classcatalog_access_1_1_catalog.html#r28">m_indexDEC</a>= -1;
00155   <a class="code" href="classcatalog_access_1_1_catalog.html#r19">m_selRegion</a>=<span class="keyword">false</span>;
00156   <a class="code" href="classcatalog_access_1_1_catalog.html#r29">m_selEllipse</a>.clear();
00157 }
00158 <span class="comment">/**********************************************************************/</span>
00159 <span class="comment">// erase elements in m_quantities according to m_loadQuantity,</span>
00160 <span class="comment">// deleteContent() MUST be done before</span>
<a name="l00161"></a><a class="code" href="classcatalog_access_1_1_catalog.html#d1">00161</a> <span class="keywordtype">void</span> Catalog::deleteQuantities() {
00162 
00163   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxSize=<a class="code" href="classcatalog_access_1_1_catalog.html#r11">m_loadQuantity</a>.size();
00164   <span class="keywordtype">int</span>  nbA=0, nbD=0;
00165 
00166   <span class="keywordflow">if</span> (maxSize != <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.size()) {
00167     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(<span class="stringliteral">"deleteQuantities"</span>,
00168              <span class="stringliteral">"problem in code, this error should not occur"</span>);
00169     <span class="keywordflow">return</span>;
00170   }
00171   <span class="comment">/* these vectors can be set if import was succesful with 0 row */</span>
00172   <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>.clear();
00173   <a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>.clear();
00174   <a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>.clear();
00175 <span class="comment">//std::cout &lt;&lt; "Initial number of COL = " &lt;&lt; maxSize &lt;&lt; std::endl;</span>
00176   std::vector&lt;Quantity&gt;::iterator quantIter;
00177   quantIter=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.begin();
00178   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;maxSize; i++) {
00179     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r11">m_loadQuantity</a>[i]) {<span class="comment">/* change the index in 2D tables */</span>
00180       <span class="keywordflow">if</span> (quantIter-&gt;m_type == Quantity::STRING) quantIter-&gt;m_index=nbA++;
00181       <span class="keywordflow">else</span> quantIter-&gt;m_index=nbD++;
00182       quantIter++;
00183     }
00184     <span class="keywordflow">else</span> <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.erase(quantIter);
00185   }<span class="comment">/* loop on quantities */</span>
00186   <span class="comment">/* now that index have changed, update the index shortcuts */</span>
00187   <span class="keywordflow">for</span> (nbA=0; nbA&lt;<a class="code" href="catalog_8h.html#a0">MAX_CAT</a>; nbA++) {
00188     <span class="keywordflow">if</span> (Catalog::s_CatalogList[2*nbA+1] == <a class="code" href="classcatalog_access_1_1_catalog.html#r4">m_tableName</a>) <span class="keywordflow">break</span>;
00189   }
00190   <a class="code" href="classcatalog_access_1_1_catalog.html#d11">setGeneric</a>(nbA);
00191 }
00192 <span class="comment">/**********************************************************************/</span>
00193 <span class="comment">// Copy constructor needed to allocate arrays in copy</span>
<a name="l00194"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a2">00194</a> Catalog::Catalog(<span class="keyword">const</span> <a class="code" href="classcatalog_access_1_1_catalog.html">Catalog</a> &amp; myCat) {
00195 
00196 <span class="preprocessor">  #ifdef DEBUG_CAT</span>
00197 <span class="preprocessor"></span>  std::cout &lt;&lt; <span class="stringliteral">"!! DEBUG Catalog COPY constructor on: "</span>
00198             &lt;&lt; myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r4">m_tableName</a> &lt;&lt; std::endl;
00199 <span class="preprocessor">  #endif  </span>
00200 <span class="preprocessor"></span>  std::string errText;
00201   <span class="comment">// copying values</span>
00202   <a class="code" href="classcatalog_access_1_1_catalog.html#r0">m_code</a>=myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r0">m_code</a>;
00203   <a class="code" href="classcatalog_access_1_1_catalog.html#r1">m_URL</a> =myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r1">m_URL</a>;
00204   <a class="code" href="classcatalog_access_1_1_catalog.html#r2">m_catName</a>   =myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r2">m_catName</a>;
00205   <a class="code" href="classcatalog_access_1_1_catalog.html#r3">m_catRef</a>    =myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r3">m_catRef</a>;
00206   <a class="code" href="classcatalog_access_1_1_catalog.html#r4">m_tableName</a> =myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r4">m_tableName</a>;
00207   <a class="code" href="classcatalog_access_1_1_catalog.html#r5">m_tableRef</a>  =myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r5">m_tableRef</a>;
00208 
00209   <a class="code" href="classcatalog_access_1_1_catalog.html#r6">m_filename</a>   =myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r6">m_filename</a>;
00210   <a class="code" href="classcatalog_access_1_1_catalog.html#r7">m_filePos</a>    =myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r7">m_filePos</a>;
00211   <a class="code" href="classcatalog_access_1_1_catalog.html#r8">m_posErrSys</a>=myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r8">m_posErrSys</a>;
00212   <a class="code" href="classcatalog_access_1_1_catalog.html#r9">m_posErrFactor</a>=myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r9">m_posErrFactor</a>;
00213 
00214   <a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>   =myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>;
00215   <a class="code" href="classcatalog_access_1_1_catalog.html#r14">m_numOriRows</a>=myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r14">m_numOriRows</a>;
00216   <a class="code" href="classcatalog_access_1_1_catalog.html#r17">m_selection</a> =myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r17">m_selection</a>;
00217   <a class="code" href="classcatalog_access_1_1_catalog.html#r18">m_criteriaORed</a>=myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r18">m_criteriaORed</a>;
00218   <span class="comment">// following three data members needed for efficient selection</span>
00219   <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>=myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>;
00220   <a class="code" href="classcatalog_access_1_1_catalog.html#r26">m_indexErr</a>  =myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r26">m_indexErr</a>;
00221   <a class="code" href="classcatalog_access_1_1_catalog.html#r27">m_indexRA</a>   =myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r27">m_indexRA</a>;
00222   <a class="code" href="classcatalog_access_1_1_catalog.html#r28">m_indexDEC</a>  =myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r28">m_indexDEC</a>;
00223 
00224   <span class="comment">// copying elliptical region definition</span>
00225   <a class="code" href="classcatalog_access_1_1_catalog.html#r19">m_selRegion</a>=myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r19">m_selRegion</a>;
00226   <a class="code" href="classcatalog_access_1_1_catalog.html#r20">m_selEllipseCentRA_deg</a> =myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r20">m_selEllipseCentRA_deg</a>;
00227   <a class="code" href="classcatalog_access_1_1_catalog.html#r21">m_selEllipseCentDEC_deg</a>=myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r21">m_selEllipseCentDEC_deg</a>;
00228   <a class="code" href="classcatalog_access_1_1_catalog.html#r22">m_selEllipseMinAxis_deg</a>=myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r22">m_selEllipseMinAxis_deg</a>;
00229   <a class="code" href="classcatalog_access_1_1_catalog.html#r23">m_selEllipseMajAxis_deg</a>=myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r23">m_selEllipseMajAxis_deg</a>;
00230   <a class="code" href="classcatalog_access_1_1_catalog.html#r24">m_selEllipseRot_deg</a>=myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r24">m_selEllipseRot_deg</a>;
00231 
00232   <span class="comment">// copying vectors</span>
00233 <span class="comment">//try {</span>
00234   <span class="keywordtype">long</span> i;
00235   <span class="keywordtype">int</span> vecSize, j;
00236   <span class="comment">// following data member m_selEllipse[] needed for efficient selection</span>
00237   <span class="keywordflow">try</span> {
00238     vecSize=myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r29">m_selEllipse</a>.size(); <span class="comment">// size is only 7</span>
00239     <span class="keywordflow">for</span> (j=0; j&lt;vecSize; j++) <a class="code" href="classcatalog_access_1_1_catalog.html#r29">m_selEllipse</a>.push_back(myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r29">m_selEllipse</a>.at(j));
00240   }
00241   <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;err) {
00242     errText=std::string(<span class="stringliteral">"EXCEPTION on m_selEllipse[]: "</span>)+err.what();
00243     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(<span class="stringliteral">"Catalog copy constructor"</span>, errText);
00244     <span class="keywordflow">throw</span>;
00245   }
00246   <span class="comment">// following data member m_loadQuantity[] needed for importSelected()</span>
00247   <span class="keywordflow">try</span> {
00248     vecSize=myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r11">m_loadQuantity</a>.size();
00249     <a class="code" href="classcatalog_access_1_1_catalog.html#r11">m_loadQuantity</a>.reserve(vecSize);  <span class="comment">// pre-allocate the memory </span>
00250     <span class="keywordflow">for</span> (j=0; j&lt;vecSize; j++)
00251       <a class="code" href="classcatalog_access_1_1_catalog.html#r11">m_loadQuantity</a>.push_back(myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r11">m_loadQuantity</a>.at(j));
00252   }
00253   <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;err) {
00254     errText=std::string(<span class="stringliteral">"EXCEPTION on m_loadQuantity[]: "</span>)+err.what();
00255     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(<span class="stringliteral">"Catalog copy constructor"</span>, errText);
00256     <span class="keywordflow">throw</span>;
00257   }
00258   <span class="keywordflow">try</span> {
00259     std::vector&lt;Quantity&gt;::const_iterator itQ;
00260     <span class="keywordflow">for</span> (itQ=myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.begin(); itQ!=myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.end(); itQ++)
00261       <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.push_back(*itQ);
00262   }
00263   <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;err) {
00264     errText=std::string(<span class="stringliteral">"EXCEPTION on m_quantities[]: "</span>)+err.what();
00265     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(<span class="stringliteral">"Catalog copy constructor"</span>, errText);
00266     <span class="keywordflow">throw</span>;
00267   }
00268   <span class="comment">// suppose that each column has same number of rows</span>
00269   vecSize=myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>.size();
00270   <span class="keywordflow">if</span> (vecSize &gt; 0 ) {
00271     <span class="keywordflow">try</span> {
00272       <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>.resize(vecSize);
00273       <span class="keywordflow">for</span> (j=0; j&lt;vecSize; j++) {
00274         <span class="comment">// pre-allocate the memory for each vector</span>
00275         <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[j].reserve(<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>);
00276         <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++)
00277           <a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[j].push_back(myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[j].at(i));
00278       }
00279     }
00280     <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;err) {
00281       errText=std::string(<span class="stringliteral">"EXCEPTION on m_rowIsSelected[][]: "</span>)+err.what();
00282       <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(<span class="stringliteral">"Catalog copy constructor"</span>, errText);
00283       <span class="keywordflow">throw</span>;
00284     }
00285   }
00286   vecSize=myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>.size();
00287   <span class="keywordflow">if</span> (vecSize &gt; 0 ) {
00288     <span class="keywordflow">try</span> {
00289       <a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>.resize(vecSize);
00290       <span class="keywordflow">for</span> (j=0; j&lt;vecSize; j++) {
00291         <span class="comment">// pre-allocate the memory for each vector</span>
00292         <a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>[j].reserve(<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>);
00293         <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++)
00294           <a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>[j].push_back(myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>[j].at(i));
00295       }
00296     }
00297     <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;err) {
00298       errText=std::string(<span class="stringliteral">"EXCEPTION on m_strings[][]: "</span>)+err.what();
00299       <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(<span class="stringliteral">"Catalog copy constructor"</span>, errText);
00300       <span class="keywordflow">throw</span>;
00301     }
00302   }
00303   vecSize=myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>.size();
00304   <span class="keywordflow">if</span> (vecSize &gt; 0 ) {
00305     <span class="keywordflow">try</span> {
00306       <a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>.resize(vecSize);
00307       <span class="keywordflow">for</span> (j=0; j&lt;vecSize; j++) {
00308         <span class="comment">// pre-allocate the memory for each vector</span>
00309         <a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[j].reserve(<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>);
00310         <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++)
00311           <a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[j].push_back(myCat.<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[j].at(i));
00312       }
00313     }
00314     <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;err) {
00315       errText=std::string(<span class="stringliteral">"EXCEPTION on m_numericals[][]: "</span>)+err.what();
00316       <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(<span class="stringliteral">"Catalog copy constructor"</span>, errText);
00317       <span class="keywordflow">throw</span>;
00318     }
00319   }
00320 <span class="comment">/* line is commented on purpose to TEMINATE the program on EXCEPTION */</span>
00321 <span class="comment">//} catch (...) { printErr("Catalog copy constructor", ""); }</span>
00322 }
00323 
00324 
00325 <span class="comment">/**********************************************************************/</span>
00326 <span class="comment">/*  METHODS giving GENERAL INFORMATION                                */</span>
00327 <span class="comment">/**********************************************************************/</span>
00328 <span class="comment">// return a list of all supported catalog names</span>
<a name="l00329"></a><a class="code" href="classcatalog_access_1_1_catalog.html#e0">00329</a> <span class="keywordtype">void</span> Catalog::getCatList(std::vector&lt;std::string&gt; *names, <span class="keyword">const</span> <span class="keywordtype">bool</span> isCode) {
00330 
00331   names-&gt;clear();
00332 <span class="preprocessor">  #ifdef DEBUG_CAT</span>
00333 <span class="preprocessor"></span>  std::cout &lt;&lt; <span class="stringliteral">"!! DEBUG number of known catalogs: "</span> &lt;&lt; <a class="code" href="catalog_8h.html#a0">MAX_CAT</a>
00334             &lt;&lt; std::endl;
00335 <span class="preprocessor">  #endif</span>
00336 <span class="preprocessor"></span>  std::string text;
00337   <span class="keywordtype">int</span> j=1;
00338   <span class="keywordflow">if</span> (isCode) j=0;
00339   <span class="keywordflow">try</span> {
00340     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="catalog_8h.html#a0">MAX_CAT</a>; i++) {
00341       text=Catalog::s_CatalogList[2*i+j]; <span class="comment">/* convert C string to C++ string */</span>
00342       names-&gt;push_back(text);
00343     }
00344   }
00345   <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;prob) {
00346     text=std::string(<span class="stringliteral">"EXCEPTION filling names: "</span>)+prob.what();
00347     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(<span class="stringliteral">"getCatList"</span>, text);
00348     <span class="keywordflow">throw</span>;
00349   }
00350 }
00351 <span class="comment">/**********************************************************************/</span>
00352 <span class="comment">// return a list of all supported web site names</span>
<a name="l00353"></a><a class="code" href="classcatalog_access_1_1_catalog.html#e1">00353</a> <span class="keywordtype">void</span> Catalog::getWebList(std::vector&lt;std::string&gt; *names, <span class="keyword">const</span> <span class="keywordtype">bool</span> isCode) {
00354 
00355   names-&gt;clear();
00356 <span class="preprocessor">  #ifdef DEBUG_CAT</span>
00357 <span class="preprocessor"></span>  std::cout &lt;&lt; <span class="stringliteral">"!! DEBUG number of web sites: "</span> &lt;&lt; <a class="code" href="catalog_8h.html#a2">MAX_URL</a>
00358             &lt;&lt; std::endl;
00359 <span class="preprocessor">  #endif</span>
00360 <span class="preprocessor"></span>  std::string text;
00361   <span class="keywordflow">try</span> {
00362     std::string s;
00363     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos;
00364     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="catalog_8h.html#a2">MAX_URL</a>; i++) {
00365       s=Catalog::s_CatalogURL[i]; <span class="comment">/* convert C string to C++ string */</span>
00366       <span class="keywordflow">if</span> (isCode) {
00367         pos=s.find(<span class="charliteral">' '</span>);
00368         <span class="keywordflow">if</span> (pos == std::string::npos) text=<span class="stringliteral">""</span>;
00369         <span class="keywordflow">else</span> text=s.substr(0, pos);
00370       }
00371       <span class="keywordflow">else</span> {
00372         pos=s.rfind(<span class="charliteral">' '</span>);
00373         <span class="keywordflow">if</span> (pos == std::string::npos) text=s;
00374         <span class="keywordflow">else</span> text=s.substr(pos+1, s.length()-pos);
00375       }
00376       names-&gt;push_back(text);
00377     }
00378   }
00379   <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;prob) {
00380     text=std::string(<span class="stringliteral">"EXCEPTION filling names: "</span>)+prob.what();
00381     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(<span class="stringliteral">"getWebList"</span>, text);
00382     <span class="keywordflow">throw</span>;
00383   }
00384 }
00385 
00386 <span class="comment">/**********************************************************************/</span>
00387 <span class="comment">// to know the maximal number of rows in the file</span>
<a name="l00388"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a3">00388</a> <span class="keywordtype">int</span> Catalog::getMaxNumRows(<span class="keywordtype">long</span> *nrows, <span class="keyword">const</span> std::string &amp;fileName,
00389                            <span class="keyword">const</span> std::string ext) {
00390 
00391   <span class="keywordtype">int</span> i, err;
00392   std::string text, origin=<span class="stringliteral">"getMaxNumRows"</span>;
00393   *nrows=0;
00394   err=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(origin, <span class="keyword">false</span>);
00395   <span class="keywordflow">if</span> (err &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> err;
00396 
00397   <a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>=0;
00398   i=fileName.length();
00399   <span class="keywordflow">if</span> (i == 0) {
00400     text=<span class="stringliteral">": FILENAME is EMPTY"</span>;
00401     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, text);
00402     err=<a class="code" href="namespacecatalog_access.html#a37a18">BAD_FILENAME</a>;
00403     <a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>=err;
00404     <span class="keywordflow">return</span> err;
00405   }
00406   std::fstream myFile (fileName.c_str(), std::ios::in);
00407   <span class="comment">// file can be opened ?</span>
00408   <span class="keywordflow">if</span> ( !myFile.is_open() ) {
00409     text=<span class="stringliteral">": FILENAME \""</span>+fileName+<span class="stringliteral">"\" cannot be opened"</span>;
00410     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, text);
00411     err=<a class="code" href="namespacecatalog_access.html#a37a18">BAD_FILENAME</a>;
00412     <a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>=err;
00413     <span class="keywordflow">return</span> err;
00414   }
00415 <span class="comment">/*  DIR *testDir=opendir(fileName.c_str());</span>
00416 <span class="comment">  if (testDir != NULL) {</span>
00417 <span class="comment">    closedir(testDir);</span>
00418 <span class="comment">    text=": FILENAME \""+fileName+"\" is a directory";</span>
00419 <span class="comment">    printErr(origin, text);</span>
00420 <span class="comment">    err=BAD_FILETYPE;</span>
00421 <span class="comment">    m_numRows=err;</span>
00422 <span class="comment">    return err;</span>
00423 <span class="comment">  }*/</span>
00424   myFile.close();
00425   std::ostringstream sortie;
00426   <span class="keywordtype">bool</span>  myTest;
00427   <span class="keyword">const</span> Extension *myEXT = 0;
00428   <span class="comment">// cannot use readTable because FITS IMAGE returns also error 1</span>
00429   <span class="keywordflow">try</span> {
00430     myEXT=IFileSvc::instance().readExtension(fileName, ext);
00431   }
00432   <span class="keywordflow">catch</span> (<span class="keyword">const</span> TipException &amp;x) {
00433     err=x.code();
00434     <span class="keywordflow">if</span> (err == 1) {
00435       <span class="comment">// This non-cfitsio error number means the file does not exist</span>
00436       <span class="comment">// or is not a table, or is not in either Root nor Fits format. </span>
00437       err=<a class="code" href="namespacecatalog_access.html#a37a20">BAD_FITS</a>;
00438 <span class="comment">/*      printWarn(origin, "FILENAME is NOT fits");*/</span>
00439     }
00440     <span class="keywordflow">else</span> {
00441       <span class="comment">// Other errors come from cfitsio, but apply to a file</span>
00442       <span class="comment">// which is in FITS format but has some sort of format error.</span>
00443       sortie &lt;&lt; <span class="stringliteral">": FILENAME is FITS, but cfitsio returned error="</span> &lt;&lt; err;
00444       <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, sortie.str());
00445       err=<a class="code" href="namespacecatalog_access.html#a37a20">BAD_FITS</a>;
00446       <a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>=err;
00447       <span class="keyword">delete</span> myEXT;
00448       <span class="keywordflow">return</span> err;
00449     }
00450   }
00451   <span class="keywordflow">if</span> (err == <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>) myTest=myEXT-&gt;isTable();
00452   <span class="keyword">delete</span> myEXT;
00453   <span class="keywordflow">if</span> (err == <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>) {
00454  
00455     <span class="keywordflow">if</span> (!myTest) {
00456       text=<span class="stringliteral">": FILENAME is FITS, but NOT a TABLE"</span>;
00457       <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, text);
00458       err=<a class="code" href="namespacecatalog_access.html#a37a20">BAD_FITS</a>;
00459       <a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>=err;
00460       <span class="keywordflow">return</span> err;
00461     }
00462     <span class="keyword">const</span> Table *myDOL = 0;
00463     <span class="keywordflow">try</span> {
00464       myDOL=IFileSvc::instance().readTable(fileName, ext);
00465       *nrows=myDOL-&gt;getNumRecords();
00466     }
00467     <span class="keywordflow">catch</span> (<span class="keyword">const</span> TipException &amp;x) {
00468       sortie &lt;&lt; <span class="stringliteral">": FITS is TABLE, but cfitsio returned error="</span> &lt;&lt; err;
00469       <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, sortie.str());
00470       err=<a class="code" href="namespacecatalog_access.html#a37a20">BAD_FITS</a>;
00471       <a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>=err;
00472       <span class="keyword">delete</span> myDOL;
00473       <span class="keywordflow">return</span> err;
00474     }
00475     <span class="keyword">delete</span> myDOL;
00476 
00477   }
00478   <span class="keywordflow">else</span> { <span class="comment">// (err == BAD_FITS)</span>
00479 
00480     err=<a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00481     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> tot=0ul; <span class="comment">// number of lines read</span>
00482     <span class="keywordtype">bool</span> testCR=<span class="keyword">false</span>; <span class="comment">// true if lines ends with CR (on windows)</span>
00483     <span class="keywordtype">int</span> what=0;        <span class="comment">// 0 for unkwown, &gt;0 for csv, &lt;0 to tsv</span>
00484                        <span class="comment">// fabs()=1 for standard, =2 for meta QUERY</span>
00485 
00486     myFile.open(fileName.c_str(), std::ios::in);
00487     err=<a class="code" href="classcatalog_access_1_1_catalog.html#d16">analyze_head</a>(&amp;tot, &amp;what, &amp;testCR, &amp;myFile);
00488     <span class="keywordflow">if</span> (!tot) {
00489       text=<span class="stringliteral">": FILENAME \""</span>+fileName+<span class="stringliteral">"\" is fits without extension[] specified"</span>;
00490       <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, text);
00491       <span class="keywordflow">if</span> (err == <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>) err=<a class="code" href="namespacecatalog_access.html#a37a18">BAD_FILENAME</a>;
00492       <span class="comment">// in case, for strange reason, file.good() fails at first time</span>
00493     }
00494     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (err &lt; <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>) {
00495       sortie &lt;&lt; <span class="stringliteral">": FILENAME \""</span> &lt;&lt; fileName &lt;&lt; <span class="stringliteral">"\" is empty or "</span>
00496              &lt;&lt; <span class="stringliteral">"has unknown structure (stopped step "</span> &lt;&lt; -1*err &lt;&lt; <span class="stringliteral">")"</span>;
00497       <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, sortie.str());
00498       sortie.str(<span class="stringliteral">""</span>); <span class="comment">// Will empty the string.</span>
00499       <span class="keywordflow">if</span> (err == 0) err=<a class="code" href="namespacecatalog_access.html#a37a18">BAD_FILENAME</a>; <span class="comment">/* nothing is read */</span>
00500       <span class="keywordflow">else</span> err=<a class="code" href="namespacecatalog_access.html#a37a19">BAD_FILETYPE</a>; <span class="comment">/* can search if catalog name exist */</span>
00501     }
00502     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (what == 2) {
00503       sortie &lt;&lt; <span class="stringliteral">"closing input META file ("</span> &lt;&lt; <a class="code" href="classcatalog_access_1_1_catalog.html#r14">m_numOriRows</a>;
00504       sortie &lt;&lt; <span class="stringliteral">" rows in whole CDS catalog)"</span>;
00505       <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, sortie.str());
00506     }
00507     <span class="keywordflow">else</span> {
00508       <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> refRow=0ul;
00509       <span class="keywordtype">long</span> maxRows=0l;
00510       <span class="comment">// get columns description and units, data</span>
00511       err=<a class="code" href="classcatalog_access_1_1_catalog.html#d17">analyze_body</a>(&amp;tot, &amp;what, testCR, <span class="keyword">true</span>, &amp;myFile, &amp;maxRows);
00512       <span class="comment">// only possible error: found &lt; 4</span>
00513       <span class="keywordflow">if</span> (err == <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>) {
00514         <span class="comment">// decription is read until separation line starting with ---</span>
00515         <span class="keywordtype">char</span> line[<a class="code" href="catalog_8h.html#a3">MAX_LINE</a>];
00516         <span class="keywordtype">int</span>  posC,
00517              maxLine=<a class="code" href="catalog_8h.html#a3">MAX_LINE</a>-1; <span class="comment">// to avoid computation each line</span>
00518         refRow=tot+1;
00519         <span class="keywordflow">while</span> ( myFile.good() ) {
00520           myFile.getline(line, <a class="code" href="catalog_8h.html#a3">MAX_LINE</a>);
00521           tot++;
00522           i=strlen(line);
00523           <span class="keywordflow">if</span> (i &lt; 2) <span class="keywordflow">break</span>; <span class="comment">// in any case, stop on empty string contrary to</span>
00524                             <span class="comment">//  load() which continues, skipping lines</span>
00525           <span class="comment">// string max size is MAX_LINE-1;</span>
00526           <span class="keywordflow">if</span> (i &gt;= maxLine) {
00527             sortie &lt;&lt; <span class="stringliteral">"line #"</span> &lt;&lt; tot &lt;&lt; <span class="stringliteral">" exceeds maximal size ("</span>
00528                    &lt;&lt; <a class="code" href="catalog_8h.html#a3">MAX_LINE</a> &lt;&lt; <span class="stringliteral">")"</span>;
00529             <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, sortie.str());
00530             sortie.str(<span class="stringliteral">""</span>); <span class="comment">// Will empty the string.</span>
00531             err=<a class="code" href="namespacecatalog_access.html#a37a21">BAD_FILELINE</a>;
00532             <span class="keywordflow">break</span>;
00533           }
00534           <span class="comment">//if (testCR) line[--i]='\0';</span>
00535           posC=strncmp(line, <span class="stringliteral">"#Table"</span>, 6);
00536           <span class="keywordflow">if</span> (posC == 0) {
00537             <span class="comment">// should not happen, normally preceded by empty lines</span>
00538             sortie &lt;&lt; <span class="stringliteral">"line #"</span> &lt;&lt; tot &lt;&lt; <span class="stringliteral">": second table start (not read)"</span>;
00539             <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, sortie.str());
00540             sortie.str(<span class="stringliteral">""</span>); <span class="comment">// Will empty the string.</span>
00541             err=<a class="code" href="namespacecatalog_access.html#a37a24">BAD_ROW</a>;
00542             <span class="keywordflow">break</span>;
00543           }
00544         }
00545         <span class="keywordflow">if</span> (err == <a class="code" href="namespacecatalog_access.html#a37a24">BAD_ROW</a>) err=<a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00546       }<span class="comment">// analyze_body() is OK</span>
00547  
00548       <span class="keywordflow">if</span> ((err &lt; IS_OK) &amp;&amp; (err &gt;= -3)) {
00549         sortie &lt;&lt; <span class="stringliteral">": FILENAME \""</span> &lt;&lt; fileName
00550             &lt;&lt; <span class="stringliteral">"\" has unknown type (stopped step "</span> &lt;&lt; 5-1*err &lt;&lt; <span class="stringliteral">")"</span>;
00551         <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, sortie.str());
00552         sortie.str(<span class="stringliteral">""</span>); <span class="comment">// Will empty the string.</span>
00553         err=<a class="code" href="namespacecatalog_access.html#a37a19">BAD_FILETYPE</a>;
00554       }
00555       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (err == <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>) *nrows=tot-refRow;
00556       sortie &lt;&lt; <span class="stringliteral">"closing input text file: "</span> &lt;&lt; tot &lt;&lt; <span class="stringliteral">" lines read"</span>;
00557       <a class="code" href="namespacecatalog_access.html#a36">printLog</a>(0, sortie.str());
00558     }<span class="comment">// analyze_head() is OK</span>
00559     myFile.close();
00560 
00561   }<span class="comment">// file is read</span>
00562 
00563   <a class="code" href="classcatalog_access_1_1_catalog.html#d0">deleteDescription</a>();
00564   <span class="keywordflow">return</span> err;
00565 }
00566 <span class="comment">/**********************************************************************/</span>
00567 <span class="comment">// to know the maximal number of rows in the CDS catalog</span>
<a name="l00568"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a4">00568</a> <span class="keywordtype">int</span> Catalog::getMaxNumRowsWeb(<span class="keywordtype">long</span> *nrows, <span class="keyword">const</span> std::string catName,
00569                               <span class="keyword">const</span> std::string urlCode) {
00570 
00571   <span class="keywordtype">int</span> i, err;
00572   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos;
00573   std::string web, text, origin=<span class="stringliteral">"getMaxNumRowsWeb"</span>;
00574   *nrows=0;
00575   err=<a class="code" href="namespacecatalog_access.html#a37a22">BAD_URL</a>;
00576   <span class="keywordflow">if</span> (urlCode.length() == 0) {
00577     text=<span class="stringliteral">": CODE for URL (web http address) is empty"</span>;
00578     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, text);
00579     <span class="keywordflow">return</span> err;
00580   }
00581   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="catalog_8h.html#a2">MAX_URL</a>; i++) {
00582     text=Catalog::s_CatalogURL[i]; <span class="comment">/* convert C string to C++ string */</span>
00583     pos=text.find(<span class="charliteral">' '</span>);
00584     <span class="keywordflow">if</span> (pos == std::string::npos) <span class="keywordflow">continue</span>;
00585     <span class="keywordflow">if</span> (text.substr(0, pos) == urlCode) <span class="keywordflow">break</span>;
00586   }
00587   <span class="keywordflow">if</span> (i == <a class="code" href="catalog_8h.html#a2">MAX_URL</a>) {
00588     text=<span class="stringliteral">": CODE for URL (web http address) do not exist"</span>;
00589     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, text);
00590     <span class="keywordflow">return</span> err;
00591   }
00592   pos=text.rfind(<span class="charliteral">' '</span>);
00593   <span class="keywordflow">if</span> (pos == std::string::npos) web=text;
00594   <span class="keywordflow">else</span> web=text.substr(pos+1, text.length()-pos);
00595 
00596   <span class="keywordtype">int</span> iCat=<a class="code" href="classcatalog_access_1_1_catalog.html#d25">checkCatName</a>(origin, catName);
00597   <span class="keywordflow">if</span> (iCat &lt; 0) <span class="keywordflow">return</span> iCat;
00598 
00599 <span class="comment">/* IS IT REALLY NEEDED ?</span>
00600 <span class="comment">  err=checkImport(origin, false);</span>
00601 <span class="comment">  if (err &lt; IS_VOID) return err;</span>
00602 <span class="comment">*/</span>
00603 <span class="comment">/* now, ASCII query must be created</span>
00604 <span class="comment">  and sent, using CDS package to given URL</span>
00605 <span class="comment">*/</span>
00606   err=-9;
00607   text=<span class="stringliteral">"Web query not implemented"</span>;
00608   <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, text);
00609 
00610   <span class="keywordflow">return</span> err;
00611 }
00612 
00613 
00614 <span class="comment">/**********************************************************************/</span>
00615 <span class="comment">/*  ACCESSING Catalog DEFINITION                                      */</span>
00616 <span class="comment">/**********************************************************************/</span>
00617 <span class="comment">// get the 3 definition strings</span>
<a name="l00618"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a15">00618</a> <span class="keywordtype">void</span> Catalog::getCatalogTitles(std::vector&lt;std::string&gt; *titles) {
00619 
00620   <span class="keywordtype">int</span> nb=titles-&gt;size();
00621   <span class="keywordflow">if</span> (nb == 0) titles-&gt;push_back(<a class="code" href="classcatalog_access_1_1_catalog.html#r0">m_code</a>);
00622   <span class="keywordflow">else</span> (*titles)[0]=<a class="code" href="classcatalog_access_1_1_catalog.html#r0">m_code</a>;
00623   <span class="keywordflow">if</span> (nb &gt; 1) (*titles)[1]=<a class="code" href="classcatalog_access_1_1_catalog.html#r1">m_URL</a>;       <span class="keywordflow">else</span> <span class="keywordflow">return</span>;
00624   <span class="keywordflow">if</span> (nb &gt; 2) (*titles)[2]=<a class="code" href="classcatalog_access_1_1_catalog.html#r2">m_catName</a>;   <span class="keywordflow">else</span> <span class="keywordflow">return</span>;
00625   <span class="keywordflow">if</span> (nb &gt; 3) (*titles)[3]=<a class="code" href="classcatalog_access_1_1_catalog.html#r3">m_catRef</a>;    <span class="keywordflow">else</span> <span class="keywordflow">return</span>;
00626   <span class="keywordflow">if</span> (nb &gt; 4) (*titles)[4]=<a class="code" href="classcatalog_access_1_1_catalog.html#r4">m_tableName</a>; <span class="keywordflow">else</span> <span class="keywordflow">return</span>;
00627   <span class="keywordflow">if</span> (nb &gt; 5) (*titles)[5]=<a class="code" href="classcatalog_access_1_1_catalog.html#r5">m_tableRef</a>;  <span class="keywordflow">else</span> <span class="keywordflow">return</span>;
00628 }
00629 
00630 <span class="comment">/**********************************************************************/</span>
00631 <span class="comment">// get an iterator on the quantities</span>
00632 
00633 
00634 <span class="comment">/**********************************************************************/</span>
00635 <span class="comment">// get a copy of the quantity vector</span>
<a name="l00636"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a16">00636</a> <span class="keywordtype">int</span> Catalog::getQuantityDescription(std::vector&lt;Quantity&gt; *myQuantities) {
00637 
00638   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(<span class="stringliteral">"getQuantityDescription"</span>, <span class="keyword">true</span>);
00639   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) {
00640     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"getQuantityDescription"</span>, <span class="stringliteral">"returning unchanged vector."</span>);
00641     <span class="keywordflow">return</span> quantSize;
00642   }
00643   *myQuantities=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>;
00644   <span class="keywordflow">return</span> quantSize;
00645 }
00646 
00647 <span class="comment">/**********************************************************************/</span>
00648 <span class="comment">// get only Quantity member name</span>
<a name="l00649"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a17">00649</a> <span class="keywordtype">int</span> Catalog::getQuantityNames(std::vector&lt;std::string&gt; *names) {
00650 
00651   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"getQuantityNames"</span>;
00652   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(origin, <span class="keyword">true</span>);
00653   names-&gt;clear();
00654   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) {
00655     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"returning empty vector."</span>);
00656     <span class="keywordflow">return</span> quantSize;
00657   }
00658   <span class="keywordflow">try</span> {
00659     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;quantSize; i++)
00660       names-&gt;push_back(<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(i).m_name);
00661   }
00662   <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;err) {
00663     std::string errText;
00664     errText=std::string(<span class="stringliteral">"EXCEPTION on names: "</span>)+err.what();
00665     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, errText);
00666     <span class="keywordflow">throw</span>;
00667   }
00668   <span class="keywordflow">return</span> quantSize;
00669 }
00670 <span class="comment">/**********************************************************************/</span>
00671 <span class="comment">// get only Quantity member unit</span>
<a name="l00672"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a18">00672</a> <span class="keywordtype">int</span> Catalog::getQuantityUnits(std::vector&lt;std::string&gt; *units) {
00673 
00674   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"getQuantityUnits"</span>;
00675   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(origin, <span class="keyword">true</span>);
00676   units-&gt;clear();
00677   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) {
00678     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"returning empty vector."</span>);
00679     <span class="keywordflow">return</span> quantSize;
00680   } 
00681   <span class="keywordflow">try</span> {
00682     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;quantSize; i++)
00683       units-&gt;push_back(<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(i).m_unit);
00684   }
00685   <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;err) {
00686     std::string errText;
00687     errText=std::string(<span class="stringliteral">"EXCEPTION on units: "</span>)+err.what();
00688     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, errText);
00689     <span class="keywordflow">throw</span>;
00690   }
00691   <span class="keywordflow">return</span> quantSize;
00692 }
00693 <span class="comment">/**********************************************************************/</span>
00694 <span class="comment">// get only Quantity member ucd</span>
<a name="l00695"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a19">00695</a> <span class="keywordtype">int</span> Catalog::getQuantityUCDs (std::vector&lt;std::string&gt; *ucds) {
00696 
00697   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"getQuantityUCDs"</span>;
00698   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(origin, <span class="keyword">true</span>);
00699   ucds-&gt;clear();
00700   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) {
00701     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"returning empty vector."</span>);
00702     <span class="keywordflow">return</span> quantSize;
00703   } 
00704   <span class="keywordflow">try</span> {
00705     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;quantSize; i++)
00706       ucds-&gt;push_back(<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(i).m_ucd);
00707   }
00708   <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;err) {
00709     std::string errText;
00710     errText=std::string(<span class="stringliteral">"EXCEPTION on ucds: "</span>)+err.what();
00711     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, errText);
00712     <span class="keywordflow">throw</span>;
00713   }
00714   <span class="keywordflow">return</span> quantSize;
00715 }
00716 <span class="comment">/**********************************************************************/</span>
00717 <span class="comment">// get only Quantity member type</span>
<a name="l00718"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a20">00718</a> <span class="keywordtype">int</span> Catalog::getQuantityTypes(std::vector&lt;Quantity::QuantityType&gt; *types) {
00719 
00720   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"getQuantityTypes"</span>;
00721   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(origin, <span class="keyword">true</span>);
00722   types-&gt;clear();
00723   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) {
00724     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"returning empty vector."</span>);
00725     <span class="keywordflow">return</span> quantSize;
00726   } 
00727   <span class="keywordflow">try</span> {
00728     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;quantSize; i++)
00729       types-&gt;push_back(<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(i).m_type);
00730   }
00731   <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;err) {
00732     std::string errText;
00733     errText=std::string(<span class="stringliteral">"EXCEPTION on types: "</span>)+err.what();
00734     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, errText);
00735     <span class="keywordflow">throw</span>;
00736   }
00737   <span class="keywordflow">return</span> quantSize;
00738 }
00739 
00740 <span class="comment">/**********************************************************************/</span>
00741 <span class="comment">// get the member "statErrName" of given quantity "name"</span>
<a name="l00742"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a21">00742</a> <span class="keywordtype">int</span> Catalog::getStatErrorName(<span class="keyword">const</span> std::string name,
00743                               std::string *statErrName) {
00744 
00745   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(<span class="stringliteral">"getStatErrorName"</span>, <span class="keyword">true</span>);
00746   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00747   quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(<span class="stringliteral">"getStatErrorName"</span>, name);
00748   <span class="keywordflow">if</span> (quantSize &lt; 0) <span class="keywordflow">return</span> quantSize;
00749   *statErrName=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(quantSize).m_statError;
00750   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00751 }
00752 <span class="comment">/**********************************************************************/</span>
00753 <span class="comment">// get the member "sysErrName" of given quantity "name"</span>
<a name="l00754"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a22">00754</a> <span class="keywordtype">int</span> Catalog::getSysErrorName(<span class="keyword">const</span> std::string name,
00755                              std::string *sysErrName) {
00756 
00757   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(<span class="stringliteral">"getSysErrorName"</span>, <span class="keyword">true</span>);
00758   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> quantSize;
00759   quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(<span class="stringliteral">"getSysErrorName"</span>, name);
00760   <span class="keywordflow">if</span> (quantSize &lt; 0) <span class="keywordflow">return</span> quantSize;
00761   *sysErrName=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(quantSize).m_sysError;
00762   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00763 }
00764   
00765 <span class="comment">/**********************************************************************/</span>
00766 <span class="comment">// get the list of names of the quantities which form the given vector "name"</span>
00767 
00768 
00769 
00770 <span class="comment">/**********************************************************************/</span>
00771 <span class="comment">/*  ACCESSING ALL Catalog CONTENTS in MEMORY (IGNORING SELECTION)     */</span>
00772 <span class="comment">/**********************************************************************/</span>
00773 <span class="comment">// get the number of rows in the catalog</span>
<a name="l00774"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a24">00774</a> <span class="keywordtype">void</span> Catalog::getNumRows(<span class="keywordtype">long</span> *nrows) {
00775 
00776   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> &lt; 0) *nrows=0;
00777   <span class="keywordflow">else</span> *nrows=<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>;
00778 }
00779 
00780 <span class="comment">/**********************************************************************/</span>
00781 <span class="comment">// get the value of given string quantity in given row</span>
<a name="l00782"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a25">00782</a> <span class="keywordtype">int</span> Catalog::getSValue(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">long</span> row,
00783                        std::string *stringVal) {
00784 
00785   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"getSValue"</span>;
00786   <span class="keywordtype">int</span> num=<a class="code" href="classcatalog_access_1_1_catalog.html#d26">checkSize_row</a>(origin, row);
00787   <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
00788   num=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
00789   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
00790   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_type != Quantity::STRING) {
00791     std::string errText;
00792     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of STRING type"</span>;
00793     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
00794     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00795   }
00796   num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_index;
00797 <span class="preprocessor">  #ifdef DEBUG_CAT</span>
00798 <span class="preprocessor"></span>    std::cout &lt;&lt; <span class="stringliteral">"!! DEBUG STRING index = "</span> &lt;&lt; num &lt;&lt; std::endl;
00799 <span class="preprocessor">  #endif</span>
00800 <span class="preprocessor"></span>  *stringVal=<a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>[num].at(row);
00801   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00802 }
00803 <span class="comment">/**********************************************************************/</span>
00804 <span class="comment">// get the value of given numerical quantity in given row</span>
<a name="l00805"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a26">00805</a> <span class="keywordtype">int</span> Catalog::getNValue(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">long</span> row,
00806                        <span class="keywordtype">double</span> *realVal) {
00807 
00808   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"getNValue"</span>;
00809   <span class="keywordtype">int</span> num=<a class="code" href="classcatalog_access_1_1_catalog.html#d26">checkSize_row</a>(origin, row);
00810   <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
00811   num=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
00812   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
00813   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_type != Quantity::NUM) {  
00814     std::string errText;
00815     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00816     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
00817     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00818   }
00819   num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_index;
00820 <span class="preprocessor">  #ifdef DEBUG_CAT</span>
00821 <span class="preprocessor"></span>    std::cout &lt;&lt; <span class="stringliteral">"!! DEBUG NUM index = "</span> &lt;&lt; num &lt;&lt; std::endl;
00822 <span class="preprocessor">  #endif</span>
00823 <span class="preprocessor"></span>  *realVal=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(row);
00824   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00825 }
00826 
00827 <span class="comment">/**********************************************************************/</span>
00828 <span class="comment">// get the values of given vector quantity in given row</span>
00829 
00830 <span class="comment">/**********************************************************************/</span>
00831 <span class="comment">// get the value of the statistical error of given quantity in given row</span>
<a name="l00832"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a27">00832</a> <span class="keywordtype">int</span> Catalog::getStatError(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">long</span> row,
00833                           <span class="keywordtype">double</span> *realValStat) {
00834 
00835   *realValStat = -1.0;
00836   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"getStatError"</span>;
00837   <span class="keywordtype">int</span> num=<a class="code" href="classcatalog_access_1_1_catalog.html#d26">checkSize_row</a>(origin, row);
00838   <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
00839   num=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
00840   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
00841   std::string statName=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_statError;
00842   <span class="keywordflow">if</span> (statName.empty()) {;
00843     statName=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") has no statistical error"</span>;
00844     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, statName);
00845     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a27">NO_QUANT_ERR</a>;
00846   }
00847   num=checkQuant_name(origin, statName);
00848   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
00849   num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_index;
00850 <span class="preprocessor">  #ifdef DEBUG_CAT</span>
00851 <span class="preprocessor"></span>    std::cout &lt;&lt; <span class="stringliteral">"!! DEBUG NUM STAT index = "</span> &lt;&lt; num &lt;&lt; std::endl;
00852 <span class="preprocessor">  #endif</span>
00853 <span class="preprocessor"></span>  *realValStat=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(row);
00854   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00855 }
00856 <span class="comment">/**********************************************************************/</span>
00857 <span class="comment">// get the value of the systematic error of given quantity in given row</span>
<a name="l00858"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a28">00858</a>   <span class="keywordtype">int</span> Catalog::getSysError(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">long</span> row,
00859                            <span class="keywordtype">double</span> *realValSys) {
00860 
00861   *realValSys = -1.0;
00862   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"getSysError"</span>;
00863   <span class="keywordtype">int</span> num=<a class="code" href="classcatalog_access_1_1_catalog.html#d26">checkSize_row</a>(origin, row);
00864   <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
00865   num=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
00866   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
00867   std::string sysName=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_sysError;
00868   <span class="keywordflow">if</span> (sysName.empty()) {
00869     sysName=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") has no systematic error"</span>;
00870     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, sysName);
00871     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a27">NO_QUANT_ERR</a>;
00872   }
00873   num=checkQuant_name(origin, sysName);
00874   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
00875   num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_index;
00876 <span class="preprocessor">  #ifdef DEBUG_CAT</span>
00877 <span class="preprocessor"></span>    std::cout &lt;&lt; <span class="stringliteral">"!! DEBUG NUM SYS. index = "</span> &lt;&lt; num &lt;&lt; std::endl;
00878 <span class="preprocessor">  #endif</span>
00879 <span class="preprocessor"></span>  *realValSys=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(row);
00880   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00881 }
00882 
00883 <span class="comment">/**********************************************************************/</span>
00884 <span class="comment">// get the values of the statistical error of given vector in given row</span>
00885 
00886 <span class="comment">/**********************************************************************/</span>
00887 <span class="comment">// get the values of the systematic error of given vector in given row</span>
00888 
00889 
00890 <span class="comment">/**********************************************************************/</span>
00891 <span class="comment">// for string quantity: the list of different values assumed</span>
<a name="l00892"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a29">00892</a> <span class="keywordtype">int</span> Catalog::getSValues(<span class="keyword">const</span> std::string name,
00893                         std::vector&lt;std::string&gt; *values) {
00894 
00895   values-&gt;clear();
00896   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"getSValues"</span>;
00897   <span class="keywordtype">int</span> num=<a class="code" href="classcatalog_access_1_1_catalog.html#d26">checkSize_row</a>(origin, 0);
00898   <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
00899   num=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
00900   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
00901   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_type != Quantity::STRING) {
00902     std::string errText;
00903     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of STRING type"</span>;
00904     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
00905     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00906   }
00907   num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_index;
00908   std::string text;
00909   <span class="keywordflow">try</span> {
00910     values-&gt;assign(1, <a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>[num].at(0));
00911     <span class="keywordtype">long</span> i, j, max;
00912     <span class="keywordflow">for</span> (i=1; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
00913       text=<a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>[num].at(i);
00914       max=values-&gt;size();
00915       <span class="keywordflow">for</span> (j=0; j&lt;max; j++) <span class="keywordflow">if</span> (values-&gt;at(j) == text) <span class="keywordflow">break</span>;
00916       <span class="keywordflow">if</span> (j == max) values-&gt;push_back(text);
00917     }
00918   }
00919   <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;err) {
00920     text=std::string(<span class="stringliteral">"EXCEPTION on values: "</span>)+err.what();
00921     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, text);
00922     <span class="keywordflow">throw</span>;
00923   }
00924   <span class="keywordflow">return</span> values-&gt;size();
00925 }
00926 
00927 <span class="comment">/**********************************************************************/</span>
00928 <span class="comment">// for numerical quantity: the minimum value in the catalog</span>
<a name="l00929"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a30">00929</a> <span class="keywordtype">int</span> Catalog::minVal(<span class="keyword">const</span> std::string name, <span class="keywordtype">double</span> *realVal) {
00930 
00931   *realVal=<a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>;
00932   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"minVal"</span>;
00933   <span class="keywordtype">int</span> num=<a class="code" href="classcatalog_access_1_1_catalog.html#d26">checkSize_row</a>(origin, 0);
00934   <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
00935   num=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
00936   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
00937   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_type != Quantity::NUM) {
00938     std::string errText;
00939     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00940     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
00941     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00942   }
00943   num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_index;
00944   <span class="keywordtype">long</span> i=0;
00945   <span class="keywordtype">double</span> r;
00946   <span class="keywordflow">do</span> { *realVal=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(i);
00947 <span class="comment">/*  std::cout &lt;&lt; "NaN == NaN ? " &lt;&lt; (*realVal == m_numericals[num].at(0))</span>
00948 <span class="comment">            &lt;&lt; std::endl;*/</span>
00949   }
00950 <span class="preprocessor">#ifdef WIN32</span>
00951 <span class="preprocessor"></span>  <span class="keywordflow">while</span> ((_isnan(*realVal)) &amp;&amp; (++i &lt; <a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>));
00952 <span class="preprocessor">#else</span>
00953 <span class="preprocessor"></span>  <span class="keywordflow">while</span> ((std::isnan(*realVal)) &amp;&amp; (++i &lt; <a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>));
00954 <span class="preprocessor">#endif</span>
00955 <span class="preprocessor"></span>  <span class="keywordflow">for</span> (; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
00956     r=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(i);
00957     <span class="keywordflow">if</span> (r &lt; *realVal) *realVal=r;
00958   }
00959   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00960 }
00961 <span class="comment">/**********************************************************************/</span>
00962 <span class="comment">// for numerical quantity: the maximum value in the catalog</span>
<a name="l00963"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a31">00963</a> <span class="keywordtype">int</span> Catalog::maxVal(<span class="keyword">const</span> std::string name, <span class="keywordtype">double</span> *realVal) {
00964 
00965   *realVal=<a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>;
00966   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"maxVal"</span>;
00967   <span class="keywordtype">int</span> num=<a class="code" href="classcatalog_access_1_1_catalog.html#d26">checkSize_row</a>(origin, 0);
00968   <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
00969   num=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
00970   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
00971   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_type != Quantity::NUM) {
00972     std::string errText;
00973     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
00974     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
00975     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
00976   }
00977   num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_index;
00978   <span class="keywordtype">long</span> i=0;
00979   <span class="keywordtype">double</span> r;
00980   <span class="keywordflow">do</span> { *realVal=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(i); }
00981 <span class="preprocessor">#ifdef WIN32</span>
00982 <span class="preprocessor"></span>  <span class="keywordflow">while</span> ((_isnan(*realVal)) &amp;&amp; (++i &lt; <a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>));
00983 <span class="preprocessor">#else</span>
00984 <span class="preprocessor"></span>  <span class="keywordflow">while</span> ((std::isnan(*realVal)) &amp;&amp; (++i &lt; <a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>));
00985 <span class="preprocessor">#endif</span>
00986 <span class="preprocessor"></span>  <span class="keywordflow">for</span> (; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) {
00987     r=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(i);
00988     <span class="keywordflow">if</span> (r &gt; *realVal) *realVal=r;
00989   }
00990   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
00991 }
00992 
00993 
00994 <span class="comment">/**********************************************************************/</span>
00995 <span class="comment">/*  ACCESSING the Catalog CONTENTS with in-memory SELECTION CRITERIA  */</span>
00996 <span class="comment">/**********************************************************************/</span>
00997 <span class="comment">// get the number of selected rows in the catalog</span>
<a name="l00998"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a32">00998</a> <span class="keywordtype">void</span> Catalog::getNumSelRows(<span class="keywordtype">long</span> *nrows) {
00999 
01000  *nrows=<a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>;
01001 }
01002 
01003 <span class="comment">/**********************************************************************/</span>
01004 <span class="comment">// get the value of given string quantity in given selected row</span>
<a name="l01005"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a33">01005</a> <span class="keywordtype">int</span> Catalog::getSelSValue(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">long</span> srow,
01006                           std::string *stringVal) {
01007 
01008   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"getSelSValue"</span>;
01009   <span class="keywordtype">int</span> num=<a class="code" href="classcatalog_access_1_1_catalog.html#d28">checkSel_row</a>(origin, srow);
01010   <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
01011   <span class="comment">// above test avoid searching for srow when no row is selected</span>
01012   num=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
01013   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
01014   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_type != Quantity::STRING) {
01015     std::string errText;
01016     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of STRING type"</span>;
01017     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
01018     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
01019   }
01020   num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_index;
01021   <span class="keywordtype">long</span> tot=0;
01022   <span class="comment">// first bit indicates global selection</span>
01023   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(i) &amp; 1) {
01024     <span class="keywordflow">if</span> (tot == srow) { *stringVal=<a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>[num].at(i); <span class="keywordflow">break</span>; }
01025     tot++;
01026     <span class="comment">//if (tot == m_numSelRows) break; should not happen</span>
01027   }
01028   <span class="keywordflow">if</span> (tot &lt; <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01029   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>; <span class="comment">// should not happen</span>
01030 }
01031 <span class="comment">/**********************************************************************/</span>
01032 <span class="comment">// get the value of given numerical quantity in given selected row</span>
<a name="l01033"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a34">01033</a> <span class="keywordtype">int</span> Catalog::getSelNValue(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">long</span> srow,
01034                           <span class="keywordtype">double</span> *realVal) {
01035 
01036   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"getSelNValue"</span>;
01037   <span class="keywordtype">int</span> num=<a class="code" href="classcatalog_access_1_1_catalog.html#d28">checkSel_row</a>(origin, srow);
01038   <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
01039   <span class="comment">// above test avoid searching for srow when no row is selected</span>
01040   num=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
01041   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
01042   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_type != Quantity::NUM) {  
01043     std::string errText;
01044     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
01045     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
01046     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
01047   }
01048   num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_index;
01049   <span class="keywordtype">long</span> tot=0;
01050   <span class="comment">// first bit indicates global selection</span>
01051   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(i) &amp; 1) {
01052     <span class="keywordflow">if</span> (tot == srow) { *realVal=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(i); <span class="keywordflow">break</span>; }
01053     tot++;
01054     <span class="comment">//if (tot == m_numSelRows) break; should not happen</span>
01055   }
01056   <span class="keywordflow">if</span> (tot &lt; <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01057   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>; <span class="comment">// should not happen</span>
01058 }
01059 
01060 <span class="comment">/**********************************************************************/</span>
01061 <span class="comment">// get the values of given vector quantity in given selected row</span>
01062 
01063 <span class="comment">/**********************************************************************/</span>
01064 <span class="comment">// get value of the statistical error of given quantity in given selected row</span>
<a name="l01065"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a35">01065</a> <span class="keywordtype">int</span> Catalog::getSelStatError(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">long</span> srow,
01066                              <span class="keywordtype">double</span> *realValStat) {
01067 
01068   *realValStat = -1.0;
01069   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"getSelStatError"</span>;
01070   <span class="keywordtype">int</span> num=<a class="code" href="classcatalog_access_1_1_catalog.html#d28">checkSel_row</a>(origin, srow);
01071   <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
01072   <span class="comment">// above test avoid searching for srow when no row is selected</span>
01073   num=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
01074   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
01075   std::string statName=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_statError;
01076   <span class="keywordflow">if</span> (statName.empty()) {;
01077     statName=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") has no statistical error"</span>;
01078     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, statName);
01079     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a27">NO_QUANT_ERR</a>;
01080   }
01081   num=checkQuant_name(origin, statName);
01082   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
01083   num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_index;
01084 <span class="preprocessor">  #ifdef DEBUG_CAT</span>
01085 <span class="preprocessor"></span>    std::cout &lt;&lt; <span class="stringliteral">"!! DEBUG NUM STAT index = "</span> &lt;&lt; num &lt;&lt; std::endl;
01086 <span class="preprocessor">  #endif</span>
01087 <span class="preprocessor"></span>  <span class="keywordtype">long</span> tot=0;
01088   <span class="comment">// first bit indicates global selection</span>
01089   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(i) &amp; 1) {
01090     <span class="keywordflow">if</span> (tot == srow) { *realValStat=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(i); <span class="keywordflow">break</span>; }
01091     tot++;
01092   }
01093   <span class="keywordflow">if</span> (tot &lt; <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01094   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>; <span class="comment">// should not happen</span>
01095 }
01096 <span class="comment">/**********************************************************************/</span>
01097 <span class="comment">// get value of the systematic error of given quantity in given selected row</span>
<a name="l01098"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a36">01098</a> <span class="keywordtype">int</span> Catalog::getSelSysError(<span class="keyword">const</span> std::string name, <span class="keyword">const</span> <span class="keywordtype">long</span> srow,
01099                              <span class="keywordtype">double</span> *realValSys) {
01100 
01101   *realValSys = -1.0;
01102   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"getSelSysError"</span>;
01103   <span class="keywordtype">int</span> num=<a class="code" href="classcatalog_access_1_1_catalog.html#d28">checkSel_row</a>(origin, srow);
01104   <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
01105   <span class="comment">// above test avoid searching for srow when no row is selected</span>
01106   num=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
01107   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
01108   std::string sysName=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_sysError;
01109   <span class="keywordflow">if</span> (sysName.empty()) {;
01110     sysName=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") has no systematic error"</span>;
01111     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, sysName);
01112     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a27">NO_QUANT_ERR</a>;
01113   }
01114   num=checkQuant_name(origin, sysName);
01115   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
01116   num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_index;
01117 <span class="preprocessor">  #ifdef DEBUG_CAT</span>
01118 <span class="preprocessor"></span>    std::cout &lt;&lt; <span class="stringliteral">"!! DEBUG NUM SYS. index = "</span> &lt;&lt; num &lt;&lt; std::endl;
01119 <span class="preprocessor">  #endif</span>
01120 <span class="preprocessor"></span>  <span class="keywordtype">long</span> tot=0;
01121   <span class="comment">// first bit indicates global selection</span>
01122   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(i) &amp; 1) {
01123     <span class="keywordflow">if</span> (tot == srow) { *realValSys=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(i); <span class="keywordflow">break</span>; }
01124     tot++;
01125   }
01126   <span class="keywordflow">if</span> (tot &lt; <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01127   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>; <span class="comment">// should not happen</span>
01128 }
01129 <span class="comment">/**********************************************************************/</span>
01130 <span class="comment">// get the values of the statistical error of given vector in given selected row</span>
01131 
01132 <span class="comment">/**********************************************************************/</span>
01133 <span class="comment">// get the values of the systematic error of given vector in given selected row</span>
01134 
01135 
01136 <span class="comment">/**********************************************************************/</span>
01137 <span class="comment">// for string quantity: the list of different selected values assumed</span>
<a name="l01138"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a37">01138</a> <span class="keywordtype">int</span> Catalog::getSelSValues(<span class="keyword">const</span> std::string name,
01139                            std::vector&lt;std::string&gt; *values) {
01140 
01141   values-&gt;clear();
01142   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"getSelSValues"</span>;
01143   <span class="keywordtype">int</span> num=<a class="code" href="classcatalog_access_1_1_catalog.html#d28">checkSel_row</a>(origin, 0);
01144   <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
01145   <span class="comment">// above test avoid searching when no row is selected</span>
01146   num=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
01147   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
01148   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_type != Quantity::STRING) {
01149     std::string errText;
01150     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of STRING type"</span>;
01151     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
01152     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
01153   }
01154   num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_index;
01155   std::string text;
01156   <span class="keywordflow">try</span> {
01157     <span class="keywordtype">long</span> j, max=0, tot=0;
01158     <span class="comment">// first bit indicates global selection</span>
01159     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(i) &amp; 1) {
01160       text=<a class="code" href="classcatalog_access_1_1_catalog.html#r12">m_strings</a>[num].at(i);
01161       <span class="keywordflow">if</span> (max == 0) {values-&gt;assign(1, text); max++;}
01162       <span class="keywordflow">else</span> {
01163         <span class="keywordflow">for</span> (j=0; j&lt;max; j++) <span class="keywordflow">if</span> (values-&gt;at(j) == text) <span class="keywordflow">break</span>;
01164         <span class="keywordflow">if</span> (j == max) {values-&gt;push_back(text); max++;}
01165       }
01166       <span class="keywordflow">if</span> (++tot == <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>) <span class="keywordflow">break</span>; <span class="comment">// to speed up</span>
01167     }
01168   }
01169   <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;err) {
01170     text=std::string(<span class="stringliteral">"EXCEPTION on values: "</span>)+err.what();
01171     <a class="code" href="namespacecatalog_access.html#a34">printErr</a>(origin, text);
01172     <span class="keywordflow">throw</span>;
01173   }
01174   <span class="keywordflow">return</span> values-&gt;size();
01175 }
01176 
01177 <span class="comment">/**********************************************************************/</span>
01178 <span class="comment">// for numerical quantity: the minimum value in the selected rows</span>
<a name="l01179"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a38">01179</a> <span class="keywordtype">int</span> Catalog::minSelVal(<span class="keyword">const</span> std::string name, <span class="keywordtype">double</span> *realVal) {
01180 
01181   *realVal=<a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>;
01182   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"minSelVal"</span>;
01183   <span class="keywordtype">int</span> num=<a class="code" href="classcatalog_access_1_1_catalog.html#d28">checkSel_row</a>(origin, 0);
01184   <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
01185   <span class="comment">// above test avoid searching when no row is selected</span>
01186   num=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
01187   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
01188   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_type != Quantity::NUM) {
01189     std::string errText;
01190     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
01191     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
01192     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
01193   }
01194   num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_index;
01195 
01196   <span class="keywordtype">long</span> i, tot=0;
01197   <span class="keywordtype">double</span> r;
01198   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(i) &amp; 1) {
01199     *realVal=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(i);
01200 <span class="preprocessor">#ifdef WIN32</span>
01201 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!_isnan(*realVal)) <span class="keywordflow">break</span>;
01202 <span class="preprocessor">#else</span>
01203 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!std::isnan(*realVal)) <span class="keywordflow">break</span>;
01204 <span class="preprocessor">#endif</span>
01205 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (++tot == <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>) <span class="keywordflow">break</span>; <span class="comment">// to speed up</span>
01206   }
01207   <span class="keywordflow">if</span> (tot == <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01208   <span class="comment">// stop when selection contains only NaN</span>
01209   <span class="keywordflow">for</span> (; i&lt;m_numRows; i++) <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(i) &amp; 1) {
01210     r=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(i);
01211     <span class="keywordflow">if</span> (r &lt; *realVal) *realVal=r;
01212     <span class="keywordflow">if</span> (++tot == <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>) <span class="keywordflow">break</span>; <span class="comment">// to speed up</span>
01213   }
01214   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01215 }
01216 <span class="comment">/**********************************************************************/</span>
01217 <span class="comment">// for numerical quantity: the maximum value in the selected rows</span>
<a name="l01218"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a39">01218</a> <span class="keywordtype">int</span> Catalog::maxSelVal(<span class="keyword">const</span> std::string name, <span class="keywordtype">double</span> *realVal) {
01219 
01220   *realVal=<a class="code" href="quantity_8h.html#a0">NO_SEL_CUT</a>;
01221   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"maxSelVal"</span>;
01222   <span class="keywordtype">int</span> num=<a class="code" href="classcatalog_access_1_1_catalog.html#d28">checkSel_row</a>(origin, 0);
01223   <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
01224   <span class="comment">// above test avoid searching when no row is selected</span>
01225   num=<a class="code" href="classcatalog_access_1_1_catalog.html#d27">checkQuant_name</a>(origin, name);
01226   <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
01227   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_type != Quantity::NUM) {
01228     std::string errText;
01229     errText=<span class="stringliteral">"given Quantity name ("</span>+name+<span class="stringliteral">") is not of NUM type"</span>;
01230     <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, errText);
01231     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a26">BAD_QUANT_TYPE</a>;
01232   }
01233   num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>.at(num).m_index;
01234 
01235   <span class="keywordtype">long</span> i, tot=0;
01236   <span class="keywordtype">double</span> r;
01237   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; i++) <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(i) &amp; 1) {
01238     *realVal=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(i);
01239 <span class="preprocessor">#ifdef WIN32</span>
01240 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!_isnan(*realVal)) <span class="keywordflow">break</span>;
01241 <span class="preprocessor">#else</span>
01242 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!std::isnan(*realVal)) <span class="keywordflow">break</span>;
01243 <span class="preprocessor">#endif</span>
01244 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (++tot == <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>) <span class="keywordflow">break</span>; <span class="comment">// to speed up</span>
01245   }
01246   <span class="keywordflow">if</span> (tot == <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01247   <span class="comment">// stop when selection contains only NaN</span>
01248   <span class="keywordflow">for</span> (; i&lt;m_numRows; i++) <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(i) &amp; 1) {
01249     r=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(i);
01250     <span class="keywordflow">if</span> (r &gt; *realVal) *realVal=r;
01251     <span class="keywordflow">if</span> (++tot == <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>) <span class="keywordflow">break</span>; <span class="comment">// to speed up</span>
01252   }
01253   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01254 }
01255 
01256 
01257 <span class="comment">/**********************************************************************/</span>
01258 <span class="comment">/*  ACCESSING the Catalog GENERIC CONTENTS                            */</span>
01259 <span class="comment">/**********************************************************************/</span>
01260 <span class="comment">// access to generic quantity for RA  (degrees)</span>
<a name="l01261"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a40">01261</a> <span class="keywordtype">int</span> Catalog::ra_deg(<span class="keyword">const</span> <span class="keywordtype">long</span> row, <span class="keywordtype">double</span> *realVal, <span class="keyword">const</span> <span class="keywordtype">bool</span> inSelection) {
01262 
01263   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"ra_deg"</span>;
01264   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r27">m_indexRA</a> &lt; 0) {
01265     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> &lt; 0)
01266       <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"must first use one 'import' method"</span>);
01267     <span class="keywordflow">else</span>
01268       <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"missing generic RA position quantity"</span>);
01269     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a23">NO_RA_DEC</a>;
01270   }
01271   <span class="keywordtype">int</span> num;
01272   <span class="keywordflow">if</span> (!inSelection) {
01273     num=<a class="code" href="classcatalog_access_1_1_catalog.html#d26">checkSize_row</a>(origin, row);
01274     <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
01275     num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[<a class="code" href="classcatalog_access_1_1_catalog.html#r27">m_indexRA</a>].m_index;
01276     *realVal=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(row);
01277   }
01278   <span class="keywordflow">else</span> {
01279     num=<a class="code" href="classcatalog_access_1_1_catalog.html#d28">checkSel_row</a>(origin, row);
01280     <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
01281     <span class="keywordtype">long</span> tot=0;
01282     num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[<a class="code" href="classcatalog_access_1_1_catalog.html#r27">m_indexRA</a>].m_index;
01283     <span class="comment">// first bit indicates global selection</span>
01284     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> k=0; k&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; k++) <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(k) &amp; 1) {
01285       <span class="keywordflow">if</span> (tot == row) { *realVal=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(k); <span class="keywordflow">break</span>; }
01286       tot++;
01287     }
01288     <span class="keywordflow">if</span> (tot &gt;= <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>; <span class="comment">// should not happen</span>
01289   }
01290   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01291 }
01292 <span class="comment">/**********************************************************************/</span>
01293 <span class="comment">// access to generic quantity for DEC (degrees)</span>
<a name="l01294"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a41">01294</a> <span class="keywordtype">int</span> Catalog::dec_deg(<span class="keyword">const</span> <span class="keywordtype">long</span> row, <span class="keywordtype">double</span> *realVal, <span class="keyword">const</span> <span class="keywordtype">bool</span> inSelection) {
01295 
01296   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"dec_deg"</span>;
01297   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r28">m_indexDEC</a> &lt; 0) {
01298     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> &lt; 0)
01299       <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"must first use one 'import' method"</span>);
01300     <span class="keywordflow">else</span>
01301       <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"missing generic DEC position quantity"</span>);
01302     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a23">NO_RA_DEC</a>;
01303   }
01304   <span class="keywordtype">int</span> num;
01305   <span class="keywordflow">if</span> (!inSelection) {
01306     num=<a class="code" href="classcatalog_access_1_1_catalog.html#d26">checkSize_row</a>(origin, row);
01307     <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
01308     num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[<a class="code" href="classcatalog_access_1_1_catalog.html#r28">m_indexDEC</a>].m_index;
01309     *realVal=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(row);
01310   }
01311   <span class="keywordflow">else</span> {
01312     num=<a class="code" href="classcatalog_access_1_1_catalog.html#d28">checkSel_row</a>(origin, row);
01313     <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
01314     <span class="keywordtype">long</span> tot=0;
01315     num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[<a class="code" href="classcatalog_access_1_1_catalog.html#r28">m_indexDEC</a>].m_index;
01316     <span class="comment">// first bit indicates global selection</span>
01317     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> k=0; k&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; k++) <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(k) &amp; 1) {
01318       <span class="keywordflow">if</span> (tot == row) { *realVal=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(k); <span class="keywordflow">break</span>; }
01319       tot++;
01320     }
01321     <span class="keywordflow">if</span> (tot &gt;= <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>; <span class="comment">// should not happen</span>
01322   }
01323   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01324 }
01325 <span class="comment">/**********************************************************************/</span>
01326 <span class="comment">// access to generic quantity for position uncertainty (degrees)</span>
<a name="l01327"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a42">01327</a> <span class="keywordtype">int</span> Catalog::posError_deg(<span class="keyword">const</span> <span class="keywordtype">long</span> row, <span class="keywordtype">double</span> *realVal,
01328                           <span class="keyword">const</span> <span class="keywordtype">bool</span> inSelection) {
01329 
01330   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"posError_deg"</span>;
01331   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r26">m_indexErr</a> &lt; 0) {
01332     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> &lt; 0)
01333       <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"must first use one 'import' method"</span>);
01334     <span class="keywordflow">else</span>
01335       <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(origin, <span class="stringliteral">"missing generic position error quantity"</span>);
01336     <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a25">BAD_QUANT_NAME</a>;
01337   }
01338   <span class="keywordtype">int</span> num;
01339   <span class="keywordflow">if</span> (!inSelection) {
01340     num=<a class="code" href="classcatalog_access_1_1_catalog.html#d26">checkSize_row</a>(origin, row);
01341     <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
01342     num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[<a class="code" href="classcatalog_access_1_1_catalog.html#r26">m_indexErr</a>].m_index;
01343     *realVal=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(row)/<a class="code" href="classcatalog_access_1_1_catalog.html#r9">m_posErrFactor</a>;
01344   }
01345   <span class="keywordflow">else</span> {
01346     num=<a class="code" href="classcatalog_access_1_1_catalog.html#d28">checkSel_row</a>(origin, row);
01347     <span class="keywordflow">if</span> (num &lt;= <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> num;
01348     <span class="keywordtype">long</span> tot=0;
01349     num=<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[<a class="code" href="classcatalog_access_1_1_catalog.html#r26">m_indexErr</a>].m_index;
01350     <span class="comment">// first bit indicates global selection</span>
01351     <span class="keywordflow">for</span> (<span class="keywordtype">long</span> k=0; k&lt;<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a>; k++) <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r16">m_rowIsSelected</a>[0].at(k) &amp; 1) {
01352       <span class="keywordflow">if</span> (tot == row) {
01353         *realVal=<a class="code" href="classcatalog_access_1_1_catalog.html#r13">m_numericals</a>[num].at(k)/<a class="code" href="classcatalog_access_1_1_catalog.html#r9">m_posErrFactor</a>;
01354         <span class="keywordflow">break</span>;
01355       }
01356       tot++;
01357     }
01358     <span class="keywordflow">if</span> (tot &gt;= <a class="code" href="classcatalog_access_1_1_catalog.html#r25">m_numSelRows</a>) <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>; <span class="comment">// should not happen</span>
01359   }
01360   <span class="keywordflow">return</span> <a class="code" href="namespacecatalog_access.html#a37a13">IS_OK</a>;
01361 }
01362 
01363 <span class="comment">/**********************************************************************/</span>
01364 <span class="comment">// 6 methods returning the name of generic quantities</span>
<a name="l01365"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a43">01365</a> std::string Catalog::getNameRA() {
01366   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r27">m_indexRA</a> &lt; 0) {
01367     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> &lt; 0)
01368       <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"getNameRA"</span>, <span class="stringliteral">"must first use one 'import' method"</span>);
01369     <span class="keywordflow">else</span>
01370       <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"getNameRA"</span>, <span class="stringliteral">"missing generic RA position quantity"</span>);
01371     <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
01372   }
01373   <span class="keywordflow">return</span> <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[<a class="code" href="classcatalog_access_1_1_catalog.html#r27">m_indexRA</a>].m_name;
01374 }
<a name="l01375"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a44">01375</a> std::string Catalog::getNameDEC() {
01376   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r28">m_indexDEC</a> &lt; 0) {
01377     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> &lt; 0)
01378       <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"getNameDEC"</span>, <span class="stringliteral">"must first use one 'import' method"</span>);
01379     <span class="keywordflow">else</span>
01380       <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"getNameDEC"</span>, <span class="stringliteral">"missing generic DEC position quantity"</span>);
01381     <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
01382   }
01383   <span class="keywordflow">return</span> <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[<a class="code" href="classcatalog_access_1_1_catalog.html#r28">m_indexDEC</a>].m_name;
01384 }
<a name="l01385"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a45">01385</a> std::string Catalog::getNamePosErr() {
01386   <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r26">m_indexErr</a>&lt; 0) {
01387     <span class="keywordflow">if</span> (<a class="code" href="classcatalog_access_1_1_catalog.html#r15">m_numRows</a> &lt; 0)
01388       <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"getNamePosErr"</span>, <span class="stringliteral">"must first use one 'import' method"</span>);
01389     <span class="keywordflow">else</span>
01390       <a class="code" href="namespacecatalog_access.html#a35">printWarn</a>(<span class="stringliteral">"getNamePosErr"</span>, <span class="stringliteral">"missing generic position error quantity"</span>);
01391     <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
01392   }
01393   <span class="keywordflow">return</span> <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[<a class="code" href="classcatalog_access_1_1_catalog.html#r26">m_indexErr</a>].m_name;
01394 }
01395 
<a name="l01396"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a46">01396</a> std::string Catalog::getNameL() {
01397   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"getNameL"</span>;
01398   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(origin, <span class="keyword">true</span>);
01399   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
01400   <span class="keywordtype">int</span> i;
01401   <span class="keywordflow">for</span> (i=0; i&lt;quantSize; i++) {
01402     <span class="keywordflow">if</span> ((<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[i].m_isGeneric) &amp;&amp;
01403         (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[i].m_ucd == Catalog::s_genericL))
01404       <span class="keywordflow">return</span> <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[i].m_name;
01405   }
01406   <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
01407 }
<a name="l01408"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a47">01408</a> std::string Catalog::getNameB() {
01409   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"getNameB"</span>;
01410   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(origin, <span class="keyword">true</span>);
01411   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
01412   <span class="keywordtype">int</span> i;
01413   <span class="keywordflow">for</span> (i=0; i&lt;quantSize; i++) {
01414     <span class="keywordflow">if</span> ((<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[i].m_isGeneric) &amp;&amp;
01415         (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[i].m_ucd == Catalog::s_genericB))
01416       <span class="keywordflow">return</span> <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[i].m_name;
01417   }
01418   <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
01419 }
01420 
<a name="l01421"></a><a class="code" href="classcatalog_access_1_1_catalog.html#a48">01421</a> std::string Catalog::getNameObjName() {
01422   <span class="keyword">const</span> std::string origin=<span class="stringliteral">"getNameObjName"</span>;
01423   <span class="keywordtype">int</span> quantSize=<a class="code" href="classcatalog_access_1_1_catalog.html#d24">checkImport</a>(origin, <span class="keyword">true</span>);
01424   <span class="keywordflow">if</span> (quantSize &lt; <a class="code" href="namespacecatalog_access.html#a37a14">IS_VOID</a>) <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
01425   <span class="keywordtype">int</span> i;
01426   <span class="keywordflow">for</span> (i=0; i&lt;quantSize; i++) {
01427     <span class="keywordflow">if</span> ((<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[i].m_isGeneric) &amp;&amp;
01428         (<a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[i].m_type == Quantity::STRING))
01429       <span class="keywordflow">return</span> <a class="code" href="classcatalog_access_1_1_catalog.html#r10">m_quantities</a>[i].m_name;
01430   }
01431   <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
01432 }
01433 
01434 } <span class="comment">// namespace catalogAccess</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Wed Feb 1 14:22:19 2006 for catalogAccess by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
